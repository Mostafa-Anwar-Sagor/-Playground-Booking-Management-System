{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - PlaygroundHub</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --bg-card: #1e293b;
            --sidebar-bg: #0f172a;
            --accent: #6366f1;
            --accent-hover: #4f46e5;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --info: #3b82f6;
            --text-primary: #f8fafc;
            --text-secondary: #94a3b8;
            --text-muted: #64748b;
            --border: #334155;
            --sidebar-width: 280px;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Layout */
        .admin-container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: var(--sidebar-width);
            background: var(--sidebar-bg);
            border-right: 1px solid var(--border);
            position: fixed;
            top: 0;
            left: 0;
            height: 100vh;
            overflow-y: auto;
            z-index: 1000;
            display: flex;
            flex-direction: column;
        }

        .sidebar-header {
            padding: 24px;
            border-bottom: 1px solid var(--border);
        }

        .sidebar-logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--accent);
            text-decoration: none;
        }

        .sidebar-logo i {
            font-size: 1.5rem;
        }

        .sidebar-nav {
            padding: 16px 0;
            flex: 1;
        }

        .nav-section {
            margin-bottom: 8px;
        }

        .nav-section-title {
            padding: 12px 24px 8px;
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-muted);
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 24px;
            color: var(--text-secondary);
            text-decoration: none;
            cursor: pointer;
            transition: all 0.2s ease;
            border-left: 3px solid transparent;
            font-size: 0.9rem;
        }

        .nav-item:hover {
            background: rgba(99, 102, 241, 0.1);
            color: var(--text-primary);
        }

        .nav-item.active {
            background: rgba(99, 102, 241, 0.15);
            color: var(--accent);
            border-left-color: var(--accent);
        }

        .nav-item i {
            width: 20px;
            text-align: center;
            font-size: 1rem;
        }

        .nav-badge {
            margin-left: auto;
            background: var(--danger);
            color: white;
            font-size: 0.65rem;
            font-weight: 600;
            padding: 3px 8px;
            border-radius: 10px;
            min-width: 20px;
            text-align: center;
        }

        .sidebar-footer {
            padding: 16px 24px;
            border-top: 1px solid var(--border);
        }

        .admin-profile {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .admin-avatar {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            background: linear-gradient(135deg, var(--accent), #8b5cf6);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 1rem;
        }

        .admin-info {
            flex: 1;
        }

        .admin-name {
            font-weight: 600;
            font-size: 0.9rem;
        }

        .admin-role {
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: var(--sidebar-width);
            padding: 32px;
            background: var(--bg-primary);
            min-height: 100vh;
        }

        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 32px;
        }

        .page-title {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .page-subtitle {
            font-size: 0.9rem;
            color: var(--text-muted);
            margin-top: 4px;
        }

        .header-actions {
            display: flex;
            gap: 12px;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 24px;
            margin-bottom: 32px;
        }

        .stat-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 24px;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
        }

        .stat-card.blue::before { background: linear-gradient(90deg, #3b82f6, #60a5fa); }
        .stat-card.green::before { background: linear-gradient(90deg, #10b981, #34d399); }
        .stat-card.yellow::before { background: linear-gradient(90deg, #f59e0b, #fbbf24); }
        .stat-card.red::before { background: linear-gradient(90deg, #ef4444, #f87171); }
        .stat-card.purple::before { background: linear-gradient(90deg, #8b5cf6, #a78bfa); }

        .stat-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 16px;
        }

        .stat-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
        }

        .stat-card.blue .stat-icon { background: rgba(59, 130, 246, 0.2); color: #3b82f6; }
        .stat-card.green .stat-icon { background: rgba(16, 185, 129, 0.2); color: #10b981; }
        .stat-card.yellow .stat-icon { background: rgba(245, 158, 11, 0.2); color: #f59e0b; }
        .stat-card.red .stat-icon { background: rgba(239, 68, 68, 0.2); color: #ef4444; }
        .stat-card.purple .stat-icon { background: rgba(139, 92, 246, 0.2); color: #8b5cf6; }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .stat-label {
            color: var(--text-muted);
            font-size: 0.875rem;
        }

        /* Content Sections */
        .content-section {
            display: none;
        }

        .content-section.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Data Card */
        .data-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            overflow: hidden;
            margin-bottom: 24px;
        }

        .data-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 24px;
            border-bottom: 1px solid var(--border);
        }

        .data-card-title {
            font-size: 1.1rem;
            font-weight: 600;
        }

        /* Filters */
        .filters-row {
            display: flex;
            gap: 12px;
            padding: 16px 24px;
            background: rgba(0, 0, 0, 0.2);
            border-bottom: 1px solid var(--border);
            flex-wrap: wrap;
        }

        .filter-input {
            background: var(--bg-primary);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 10px 16px;
            color: var(--text-primary);
            font-size: 0.875rem;
            min-width: 180px;
            transition: all 0.2s;
        }

        .filter-input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .filter-input::placeholder {
            color: var(--text-muted);
        }

        /* Table */
        .data-table {
            width: 100%;
            border-collapse: collapse;
        }

        .data-table th,
        .data-table td {
            padding: 16px 24px;
            text-align: left;
        }

        .data-table th {
            background: rgba(0, 0, 0, 0.2);
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--text-muted);
            border-bottom: 1px solid var(--border);
        }

        .data-table td {
            border-bottom: 1px solid var(--border);
            font-size: 0.9rem;
        }

        .data-table tbody tr {
            transition: background 0.2s;
        }

        .data-table tbody tr:hover {
            background: rgba(99, 102, 241, 0.05);
        }

        .data-table tbody tr:last-child td {
            border-bottom: none;
        }

        /* User Info Cell */
        .user-cell {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            background: linear-gradient(135deg, var(--accent), #8b5cf6);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.9rem;
            flex-shrink: 0;
        }

        .user-details {
            min-width: 0;
        }

        .user-name {
            font-weight: 500;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .user-email {
            font-size: 0.8rem;
            color: var(--text-muted);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* Badges */
        .badge {
            display: inline-flex;
            align-items: center;
            padding: 5px 12px;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 500;
            text-transform: capitalize;
        }

        .badge-success { background: rgba(16, 185, 129, 0.15); color: #10b981; }
        .badge-warning { background: rgba(245, 158, 11, 0.15); color: #f59e0b; }
        .badge-danger { background: rgba(239, 68, 68, 0.15); color: #ef4444; }
        .badge-info { background: rgba(59, 130, 246, 0.15); color: #3b82f6; }
        .badge-purple { background: rgba(139, 92, 246, 0.15); color: #8b5cf6; }

        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            border: none;
            transition: all 0.2s;
            text-decoration: none;
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 0.8rem;
        }

        .btn-primary {
            background: var(--accent);
            color: white;
        }

        .btn-primary:hover {
            background: var(--accent-hover);
            transform: translateY(-1px);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-success:hover {
            background: #059669;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        .btn-outline {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-primary);
        }

        .btn-outline:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: var(--text-muted);
        }

        /* Action Buttons */
        .action-btns {
            display: flex;
            gap: 8px;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 48px 24px;
            color: var(--text-muted);
        }

        .empty-state i {
            font-size: 3rem;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        .empty-state p {
            margin-top: 8px;
        }

        /* Loading */
        .loading-cell {
            text-align: center;
            padding: 48px !important;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--border);
            border-top-color: var(--accent);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Toast Notifications */
        .toast-container {
            position: fixed;
            top: 24px;
            right: 24px;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .toast {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 16px 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            min-width: 300px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.4);
            animation: slideIn 0.3s ease;
        }

        .toast.success { border-left: 4px solid var(--success); }
        .toast.error { border-left: 4px solid var(--danger); }
        .toast.warning { border-left: 4px solid var(--warning); }

        .toast i {
            font-size: 1.25rem;
        }

        .toast.success i { color: var(--success); }
        .toast.error i { color: var(--danger); }
        .toast.warning i { color: var(--warning); }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* Receipt Link */
        .receipt-link {
            color: var(--accent);
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .receipt-link:hover {
            text-decoration: underline;
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s ease;
            }

            .sidebar.open {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
            }

            .mobile-toggle {
                display: flex !important;
            }
        }

        .mobile-toggle {
            display: none;
            position: fixed;
            top: 16px;
            left: 16px;
            z-index: 1001;
            background: var(--accent);
            border: none;
            border-radius: 8px;
            padding: 12px;
            color: white;
            cursor: pointer;
        }

        /* Overlay */
        .sidebar-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
        }

        .sidebar-overlay.active {
            display: block;
        }
    </style>
</head>
<body>
    <div class="admin-container">
        <!-- Mobile Toggle -->
        <button class="mobile-toggle" onclick="toggleSidebar()">
            <i class="fas fa-bars"></i>
        </button>

        <!-- Sidebar Overlay -->
        <div class="sidebar-overlay" id="sidebarOverlay" onclick="toggleSidebar()"></div>

        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="/" class="sidebar-logo">
                    <i class="fas fa-shield-alt"></i>
                    <span>Admin Panel</span>
                </a>
            </div>

            <nav class="sidebar-nav">
                <div class="nav-section">
                    <div class="nav-section-title">Dashboard</div>
                    <a class="nav-item active" data-section="overview" onclick="showSection('overview', this)">
                        <i class="fas fa-chart-pie"></i>
                        <span>Overview</span>
                    </a>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">Management</div>
                    <a class="nav-item" data-section="users" onclick="showSection('users', this)">
                        <i class="fas fa-users"></i>
                        <span>Users</span>
                    </a>
                    <a class="nav-item" data-section="playgrounds" onclick="showSection('playgrounds', this)">
                        <i class="fas fa-futbol"></i>
                        <span>Playgrounds</span>
                    </a>
                    <a class="nav-item" data-section="bookings" onclick="showSection('bookings', this)">
                        <i class="fas fa-calendar-check"></i>
                        <span>Bookings</span>
                    </a>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">Approvals</div>
                    <a class="nav-item" data-section="applications" onclick="showSection('applications', this)">
                        <i class="fas fa-user-plus"></i>
                        <span>Partner Applications</span>
                        <span class="nav-badge" id="badgeApps">0</span>
                    </a>
                    <a class="nav-item" data-section="payments" onclick="showSection('payments', this)">
                        <i class="fas fa-credit-card"></i>
                        <span>Payment Verification</span>
                        <span class="nav-badge" id="badgePayments">0</span>
                    </a>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">Account</div>
                    <a class="nav-item" href="/">
                        <i class="fas fa-home"></i>
                        <span>Back to Site</span>
                    </a>
                    <a class="nav-item" href="{% url 'accounts:logout' %}">
                        <i class="fas fa-sign-out-alt"></i>
                        <span>Logout</span>
                    </a>
                </div>
            </nav>

            <div class="sidebar-footer">
                <div class="admin-profile">
                    <div class="admin-avatar">
                        {% if request.user.first_name and request.user.last_name %}
                            {{ request.user.first_name|slice:":1"|upper }}{{ request.user.last_name|slice:":1"|upper }}
                        {% else %}
                            {{ request.user.email|slice:":2"|upper }}
                        {% endif %}
                    </div>
                    <div class="admin-info">
                        <div class="admin-name">{{ request.user.get_full_name|default:request.user.email }}</div>
                        <div class="admin-role">Administrator</div>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Overview Section -->
            <section id="section-overview" class="content-section active">
                <div class="page-header">
                    <div>
                        <h1 class="page-title">Dashboard Overview</h1>
                        <p class="page-subtitle">Welcome back! Here's what's happening today.</p>
                    </div>
                    <div class="header-actions">
                        <button class="btn btn-outline" onclick="loadAllData()">
                            <i class="fas fa-sync-alt"></i>
                            Refresh
                        </button>
                    </div>
                </div>

                <div class="stats-grid">
                    <div class="stat-card blue">
                        <div class="stat-header">
                            <div class="stat-icon"><i class="fas fa-users"></i></div>
                        </div>
                        <div class="stat-value" id="statUsers">-</div>
                        <div class="stat-label">Total Users</div>
                    </div>

                    <div class="stat-card green">
                        <div class="stat-header">
                            <div class="stat-icon"><i class="fas fa-futbol"></i></div>
                        </div>
                        <div class="stat-value" id="statPlaygrounds">-</div>
                        <div class="stat-label">Playgrounds</div>
                    </div>

                    <div class="stat-card yellow">
                        <div class="stat-header">
                            <div class="stat-icon"><i class="fas fa-calendar-check"></i></div>
                        </div>
                        <div class="stat-value" id="statBookings">-</div>
                        <div class="stat-label">Total Bookings</div>
                    </div>

                    <div class="stat-card purple">
                        <div class="stat-header">
                            <div class="stat-icon"><i class="fas fa-dollar-sign"></i></div>
                        </div>
                        <div class="stat-value" id="statRevenue">-</div>
                        <div class="stat-label">Total Revenue</div>
                    </div>
                </div>

                <div class="stats-grid">
                    <div class="stat-card yellow">
                        <div class="stat-header">
                            <div class="stat-icon"><i class="fas fa-user-clock"></i></div>
                        </div>
                        <div class="stat-value" id="statPendingApps">-</div>
                        <div class="stat-label">Pending Applications</div>
                    </div>

                    <div class="stat-card red">
                        <div class="stat-header">
                            <div class="stat-icon"><i class="fas fa-receipt"></i></div>
                        </div>
                        <div class="stat-value" id="statPendingPayments">-</div>
                        <div class="stat-label">Pending Payments</div>
                    </div>

                    <div class="stat-card blue">
                        <div class="stat-header">
                            <div class="stat-icon"><i class="fas fa-store"></i></div>
                        </div>
                        <div class="stat-value" id="statOwners">-</div>
                        <div class="stat-label">Active Owners</div>
                    </div>

                    <div class="stat-card green">
                        <div class="stat-header">
                            <div class="stat-icon"><i class="fas fa-chart-line"></i></div>
                        </div>
                        <div class="stat-value" id="statGrowth">-</div>
                        <div class="stat-label">Monthly Growth</div>
                    </div>
                </div>
            </section>

            <!-- Users Section -->
            <section id="section-users" class="content-section">
                <div class="page-header">
                    <div>
                        <h1 class="page-title">User Management</h1>
                        <p class="page-subtitle">Manage all registered users</p>
                    </div>
                </div>

                <div class="data-card">
                    <div class="filters-row">
                        <input type="text" class="filter-input" id="userSearch" placeholder="Search users..." onkeyup="debounce(loadUsers, 300)()">
                        <select class="filter-input" id="userTypeFilter" onchange="loadUsers()">
                            <option value="">All Types</option>
                            <option value="user">Customers</option>
                            <option value="owner">Owners</option>
                            <option value="admin">Admins</option>
                        </select>
                    </div>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>User</th>
                                <th>Type</th>
                                <th>Status</th>
                                <th>Joined</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="usersTable">
                            <tr><td colspan="5" class="loading-cell"><div class="spinner"></div></td></tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Playgrounds Section -->
            <section id="section-playgrounds" class="content-section">
                <div class="page-header">
                    <div>
                        <h1 class="page-title">Playground Management</h1>
                        <p class="page-subtitle">Manage all registered playgrounds</p>
                    </div>
                </div>

                <div class="data-card">
                    <div class="filters-row">
                        <select class="filter-input" id="pgStatusFilter" onchange="loadPlaygrounds()">
                            <option value="">All Status</option>
                            <option value="active">Active</option>
                            <option value="inactive">Inactive</option>
                            <option value="pending">Pending</option>
                        </select>
                    </div>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Playground</th>
                                <th>Owner</th>
                                <th>City</th>
                                <th>Status</th>
                                <th>Bookings</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="playgroundsTable">
                            <tr><td colspan="6" class="loading-cell"><div class="spinner"></div></td></tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Bookings Section -->
            <section id="section-bookings" class="content-section">
                <div class="page-header">
                    <div>
                        <h1 class="page-title">Booking Management</h1>
                        <p class="page-subtitle">View and manage all bookings</p>
                    </div>
                </div>

                <div class="data-card">
                    <div class="filters-row">
                        <select class="filter-input" id="bookingStatusFilter" onchange="loadBookings()">
                            <option value="">All Status</option>
                            <option value="pending">Pending</option>
                            <option value="confirmed">Confirmed</option>
                            <option value="completed">Completed</option>
                            <option value="cancelled">Cancelled</option>
                        </select>
                        <select class="filter-input" id="paymentStatusFilter" onchange="loadBookings()">
                            <option value="">All Payments</option>
                            <option value="pending">Pending</option>
                            <option value="paid">Paid</option>
                        </select>
                    </div>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Booking ID</th>
                                <th>User</th>
                                <th>Playground</th>
                                <th>Date & Time</th>
                                <th>Amount</th>
                                <th>Status</th>
                                <th>Payment</th>
                            </tr>
                        </thead>
                        <tbody id="bookingsTable">
                            <tr><td colspan="7" class="loading-cell"><div class="spinner"></div></td></tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Partner Applications Section -->
            <section id="section-applications" class="content-section">
                <div class="page-header">
                    <div>
                        <h1 class="page-title">Partner Applications</h1>
                        <p class="page-subtitle">Review and approve partner requests</p>
                    </div>
                </div>

                <div class="data-card">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Applicant</th>
                                <th>Business Name</th>
                                <th>Phone</th>
                                <th>Status</th>
                                <th>Applied On</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="applicationsTable">
                            <tr><td colspan="6" class="loading-cell"><div class="spinner"></div></td></tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Payment Verification Section -->
            <section id="section-payments" class="content-section">
                <div class="page-header">
                    <div>
                        <h1 class="page-title">Payment Verification</h1>
                        <p class="page-subtitle">Verify uploaded payment receipts</p>
                    </div>
                </div>

                <div class="data-card">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Booking</th>
                                <th>User</th>
                                <th>Playground</th>
                                <th>Amount</th>
                                <th>Receipt</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="paymentsTable">
                            <tr><td colspan="6" class="loading-cell"><div class="spinner"></div></td></tr>
                        </tbody>
                    </table>
                </div>
            </section>
        </main>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <script>
        // Debounce helper
        function debounce(func, wait) {
            let timeout;
            return function(...args) {
                clearTimeout(timeout);
                timeout = setTimeout(() => func.apply(this, args), wait);
            };
        }

        // ===== Navigation =====
        function showSection(sectionId, element) {
            // Update nav
            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
            if (element) element.classList.add('active');

            // Update sections
            document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
            document.getElementById('section-' + sectionId).classList.add('active');

            // Load data
            loadSectionData(sectionId);

            // Close mobile sidebar
            document.getElementById('sidebar').classList.remove('open');
            document.getElementById('sidebarOverlay').classList.remove('active');
        }

        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('open');
            document.getElementById('sidebarOverlay').classList.toggle('active');
        }

        function loadSectionData(section) {
            switch(section) {
                case 'overview': loadStats(); break;
                case 'users': loadUsers(); break;
                case 'playgrounds': loadPlaygrounds(); break;
                case 'bookings': loadBookings(); break;
                case 'applications': loadApplications(); break;
                case 'payments': loadPendingPayments(); break;
            }
        }

        function loadAllData() {
            loadStats();
            loadApplications();
            loadPendingPayments();
        }

        // ===== Load Statistics =====
        async function loadStats() {
            try {
                const response = await fetch('/admin-panel/api/stats/');
                if (!response.ok) throw new Error('Failed to fetch stats');
                const data = await response.json();

                document.getElementById('statUsers').textContent = data.users?.total || 0;
                document.getElementById('statOwners').textContent = data.users?.owners || 0;
                document.getElementById('statPlaygrounds').textContent = data.playgrounds?.total || 0;
                document.getElementById('statBookings').textContent = data.bookings?.total || 0;
                document.getElementById('statRevenue').textContent = '৳' + (data.payments?.total_revenue || 0).toLocaleString();
                document.getElementById('statPendingApps').textContent = data.applications?.pending || 0;
                document.getElementById('statPendingPayments').textContent = data.payments?.pending_verification || 0;
                
                const growth = data.payments?.revenue_growth || 0;
                document.getElementById('statGrowth').textContent = (growth >= 0 ? '+' : '') + growth.toFixed(1) + '%';

                // Update badges
                document.getElementById('badgeApps').textContent = data.applications?.pending || 0;
                document.getElementById('badgePayments').textContent = data.payments?.pending_verification || 0;
            } catch (e) {
                console.error('Error loading stats:', e);
                showToast('Error loading statistics', 'error');
            }
        }

        // ===== Load Users =====
        async function loadUsers() {
            const tbody = document.getElementById('usersTable');
            tbody.innerHTML = '<tr><td colspan="5" class="loading-cell"><div class="spinner"></div></td></tr>';

            try {
                const search = document.getElementById('userSearch').value;
                const type = document.getElementById('userTypeFilter').value;
                
                let url = '/admin-panel/api/users/?';
                if (search) url += `search=${encodeURIComponent(search)}&`;
                if (type) url += `type=${type}`;

                const response = await fetch(url);
                if (!response.ok) throw new Error('Failed to fetch users');
                const data = await response.json();

                if (!data.users || data.users.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="5"><div class="empty-state"><i class="fas fa-users"></i><p>No users found</p></div></td></tr>';
                    return;
                }

                tbody.innerHTML = data.users.map(user => `
                    <tr>
                        <td>
                            <div class="user-cell">
                                <div class="user-avatar">${(user.full_name || user.email || 'U')[0].toUpperCase()}</div>
                                <div class="user-details">
                                    <div class="user-name">${user.full_name || user.username || 'No Name'}</div>
                                    <div class="user-email">${user.email}</div>
                                </div>
                            </div>
                        </td>
                        <td><span class="badge ${user.user_type === 'admin' ? 'badge-danger' : user.user_type === 'owner' ? 'badge-success' : 'badge-info'}">${user.user_type}</span></td>
                        <td><span class="badge ${user.is_active ? 'badge-success' : 'badge-danger'}">${user.is_active ? 'Active' : 'Inactive'}</span></td>
                        <td>${new Date(user.date_joined).toLocaleDateString()}</td>
                        <td>
                            <div class="action-btns">
                                ${user.is_active 
                                    ? `<button class="btn btn-sm btn-danger" onclick="manageUser(${user.id}, 'deactivate')" title="Deactivate"><i class="fas fa-ban"></i></button>`
                                    : `<button class="btn btn-sm btn-success" onclick="manageUser(${user.id}, 'activate')" title="Activate"><i class="fas fa-check"></i></button>`
                                }
                            </div>
                        </td>
                    </tr>
                `).join('');
            } catch (e) {
                console.error('Error loading users:', e);
                tbody.innerHTML = '<tr><td colspan="5"><div class="empty-state"><i class="fas fa-exclamation-triangle"></i><p>Error loading users</p></div></td></tr>';
            }
        }

        // ===== Load Playgrounds =====
        async function loadPlaygrounds() {
            const tbody = document.getElementById('playgroundsTable');
            tbody.innerHTML = '<tr><td colspan="6" class="loading-cell"><div class="spinner"></div></td></tr>';

            try {
                const status = document.getElementById('pgStatusFilter').value;
                let url = '/admin-panel/api/playgrounds/';
                if (status) url += `?status=${status}`;

                const response = await fetch(url);
                if (!response.ok) throw new Error('Failed to fetch playgrounds');
                const data = await response.json();

                if (!data.playgrounds || data.playgrounds.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="6"><div class="empty-state"><i class="fas fa-futbol"></i><p>No playgrounds found</p></div></td></tr>';
                    return;
                }

                tbody.innerHTML = data.playgrounds.map(pg => `
                    <tr>
                        <td><strong>${pg.name}</strong></td>
                        <td>${pg.owner}</td>
                        <td>${pg.city || 'N/A'}</td>
                        <td><span class="badge ${pg.status === 'active' ? 'badge-success' : pg.status === 'pending' ? 'badge-warning' : 'badge-danger'}">${pg.status}</span></td>
                        <td>${pg.bookings}</td>
                        <td>
                            <div class="action-btns">
                                ${pg.status !== 'active' 
                                    ? `<button class="btn btn-sm btn-success" onclick="managePlayground(${pg.id}, 'activate')" title="Activate"><i class="fas fa-check"></i></button>`
                                    : `<button class="btn btn-sm btn-danger" onclick="managePlayground(${pg.id}, 'deactivate')" title="Deactivate"><i class="fas fa-ban"></i></button>`
                                }
                            </div>
                        </td>
                    </tr>
                `).join('');
            } catch (e) {
                console.error('Error loading playgrounds:', e);
                tbody.innerHTML = '<tr><td colspan="6"><div class="empty-state"><i class="fas fa-exclamation-triangle"></i><p>Error loading playgrounds</p></div></td></tr>';
            }
        }

        // ===== Load Bookings =====
        async function loadBookings() {
            const tbody = document.getElementById('bookingsTable');
            tbody.innerHTML = '<tr><td colspan="7" class="loading-cell"><div class="spinner"></div></td></tr>';

            try {
                const status = document.getElementById('bookingStatusFilter').value;
                const payment = document.getElementById('paymentStatusFilter').value;

                let url = '/admin-panel/api/bookings/?';
                if (status) url += `status=${status}&`;
                if (payment) url += `payment_status=${payment}`;

                const response = await fetch(url);
                if (!response.ok) throw new Error('Failed to fetch bookings');
                const data = await response.json();

                if (!data.bookings || data.bookings.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="7"><div class="empty-state"><i class="fas fa-calendar"></i><p>No bookings found</p></div></td></tr>';
                    return;
                }

                tbody.innerHTML = data.bookings.map(b => `
                    <tr>
                        <td><code style="color: var(--accent);">${b.booking_id}</code></td>
                        <td>${b.user}</td>
                        <td>${b.playground}</td>
                        <td>${b.date}<br><small style="color: var(--text-muted);">${b.time}</small></td>
                        <td><strong>৳${b.amount.toFixed(2)}</strong></td>
                        <td><span class="badge ${b.status === 'confirmed' ? 'badge-success' : b.status === 'pending' ? 'badge-warning' : b.status === 'completed' ? 'badge-info' : 'badge-danger'}">${b.status}</span></td>
                        <td><span class="badge ${b.payment_status === 'paid' ? 'badge-success' : 'badge-warning'}">${b.payment_status}</span></td>
                    </tr>
                `).join('');
            } catch (e) {
                console.error('Error loading bookings:', e);
                tbody.innerHTML = '<tr><td colspan="7"><div class="empty-state"><i class="fas fa-exclamation-triangle"></i><p>Error loading bookings</p></div></td></tr>';
            }
        }

        // ===== Load Partner Applications =====
        async function loadApplications() {
            const tbody = document.getElementById('applicationsTable');
            tbody.innerHTML = '<tr><td colspan="6" class="loading-cell"><div class="spinner"></div></td></tr>';

            try {
                const response = await fetch('/admin-panel/api/partner-applications/');
                if (!response.ok) throw new Error('Failed to fetch applications');
                const data = await response.json();

                if (!data.applications || data.applications.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="6"><div class="empty-state"><i class="fas fa-user-plus"></i><p>No applications found</p></div></td></tr>';
                    return;
                }

                tbody.innerHTML = data.applications.map(app => `
                    <tr>
                        <td>
                            <div class="user-cell">
                                <div class="user-avatar">${(app.user_name || app.user_email || 'U')[0].toUpperCase()}</div>
                                <div class="user-details">
                                    <div class="user-name">${app.user_name || 'No Name'}</div>
                                    <div class="user-email">${app.user_email}</div>
                                </div>
                            </div>
                        </td>
                        <td><strong>${app.business_name}</strong></td>
                        <td>${app.business_phone || 'N/A'}</td>
                        <td><span class="badge ${app.status === 'approved' ? 'badge-success' : app.status === 'rejected' ? 'badge-danger' : 'badge-warning'}">${app.status}</span></td>
                        <td>${new Date(app.created_at).toLocaleDateString()}</td>
                        <td>
                            ${app.status === 'pending' ? `
                                <div class="action-btns">
                                    <button class="btn btn-sm btn-success" onclick="handleApplication(${app.id}, 'approve')">
                                        <i class="fas fa-check"></i> Approve
                                    </button>
                                    <button class="btn btn-sm btn-danger" onclick="handleApplication(${app.id}, 'reject')">
                                        <i class="fas fa-times"></i> Reject
                                    </button>
                                </div>
                            ` : '<span style="color: var(--text-muted);">—</span>'}
                        </td>
                    </tr>
                `).join('');
            } catch (e) {
                console.error('Error loading applications:', e);
                tbody.innerHTML = '<tr><td colspan="6"><div class="empty-state"><i class="fas fa-exclamation-triangle"></i><p>Error loading applications</p></div></td></tr>';
            }
        }

        // ===== Load Pending Payments =====
        async function loadPendingPayments() {
            const tbody = document.getElementById('paymentsTable');
            tbody.innerHTML = '<tr><td colspan="6" class="loading-cell"><div class="spinner"></div></td></tr>';

            try {
                const response = await fetch('/admin-panel/api/payments/pending/');
                if (!response.ok) throw new Error('Failed to fetch payments');
                const data = await response.json();

                if (!data.payments || data.payments.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="6"><div class="empty-state"><i class="fas fa-check-circle"></i><p>No pending payments</p></div></td></tr>';
                    return;
                }

                tbody.innerHTML = data.payments.map(p => `
                    <tr>
                        <td><code style="color: var(--accent);">${p.booking_id}</code></td>
                        <td>${p.user}</td>
                        <td>${p.playground}</td>
                        <td><strong>৳${p.amount.toFixed(2)}</strong></td>
                        <td>
                            ${p.receipt_url 
                                ? `<a href="${p.receipt_url}" target="_blank" class="receipt-link"><i class="fas fa-image"></i> View Receipt</a>`
                                : '<span style="color: var(--text-muted);">No receipt</span>'
                            }
                        </td>
                        <td>
                            <div class="action-btns">
                                <button class="btn btn-sm btn-success" onclick="verifyPayment(${p.id}, 'verify')">
                                    <i class="fas fa-check"></i> Verify
                                </button>
                                <button class="btn btn-sm btn-danger" onclick="verifyPayment(${p.id}, 'reject')">
                                    <i class="fas fa-times"></i> Reject
                                </button>
                            </div>
                        </td>
                    </tr>
                `).join('');
            } catch (e) {
                console.error('Error loading payments:', e);
                tbody.innerHTML = '<tr><td colspan="6"><div class="empty-state"><i class="fas fa-exclamation-triangle"></i><p>Error loading payments</p></div></td></tr>';
            }
        }

        // ===== Action Handlers =====
        async function handleApplication(id, action) {
            try {
                const response = await fetch(`/admin-panel/api/partner-applications/${id}/`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': getCookie('csrftoken')
                    },
                    body: JSON.stringify({ action })
                });
                const data = await response.json();
                
                showToast(data.message || (action === 'approve' ? 'Application approved!' : 'Application rejected'), data.success ? 'success' : 'error');
                
                if (data.success) {
                    loadApplications();
                    loadStats();
                }
            } catch (e) {
                showToast('Error processing application', 'error');
            }
        }

        async function verifyPayment(id, action) {
            try {
                const response = await fetch('/admin-panel/api/payments/verify/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': getCookie('csrftoken')
                    },
                    body: JSON.stringify({ booking_id: id, action })
                });
                const data = await response.json();
                
                showToast(data.message || 'Payment processed', data.success ? 'success' : 'error');
                
                if (data.success) {
                    loadPendingPayments();
                    loadStats();
                }
            } catch (e) {
                showToast('Error processing payment', 'error');
            }
        }

        async function manageUser(id, action) {
            try {
                const response = await fetch('/admin-panel/api/users/manage/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': getCookie('csrftoken')
                    },
                    body: JSON.stringify({ user_id: id, action })
                });
                const data = await response.json();
                
                showToast(data.message || 'User updated', data.success ? 'success' : 'error');
                
                if (data.success) {
                    loadUsers();
                    loadStats();
                }
            } catch (e) {
                showToast('Error managing user', 'error');
            }
        }

        async function managePlayground(id, action) {
            try {
                const response = await fetch('/admin-panel/api/playgrounds/manage/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': getCookie('csrftoken')
                    },
                    body: JSON.stringify({ playground_id: id, action })
                });
                const data = await response.json();
                
                showToast(data.message || 'Playground updated', data.success ? 'success' : 'error');
                
                if (data.success) {
                    loadPlaygrounds();
                    loadStats();
                }
            } catch (e) {
                showToast('Error managing playground', 'error');
            }
        }

        // ===== Toast Notifications =====
        function showToast(message, type = 'success') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            
            const icon = type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'exclamation-triangle';
            toast.innerHTML = `<i class="fas fa-${icon}"></i><span>${message}</span>`;
            
            container.appendChild(toast);
            
            setTimeout(() => {
                toast.style.animation = 'slideIn 0.3s ease reverse';
                setTimeout(() => toast.remove(), 300);
            }, 4000);
        }

        // ===== CSRF Token =====
        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }

        // ===== Initialize =====
        document.addEventListener('DOMContentLoaded', function() {
            loadAllData();
        });
    </script>
</body>
</html>
