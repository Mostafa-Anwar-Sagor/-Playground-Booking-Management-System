{% extends 'base.html' %}
{% load static %}

{% block title %}Partner Applications Management - PlayGround{% endblock %}

{% block extra_head %}
<script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.min.js"></script>
<style>
    /* Professional Dark Theme - Using Global Variables */
    .partner-dashboard-container {
        padding: 2rem 0;
        min-height: 100vh;
    }

    /* CSS Variable Mapping for Legacy Support */
    .partner-applications-page {
        --primary-dark: var(--slate-700);
        --secondary-dark: var(--slate-600);
        --accent-dark: var(--slate-500);
        --glass-bg: var(--card-bg);
        --glass-border: var(--border-color);
        --text-primary: var(--text-primary);
        --text-secondary: var(--text-secondary);
    }

    .professional-header {
        text-align: center;
        margin-bottom: 3rem;
        padding: 2rem;
    }

    .professional-title {
        font-size: 3rem;
        font-weight: 900;
        background: linear-gradient(135deg, #ffffff 0%, #e5e7eb 50%, #d1d5db 100%);
        background-clip: text;
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        margin-bottom: 1rem;
        letter-spacing: -0.025em;
        line-height: 1.1;
    }

    .professional-subtitle {
        font-size: 1.125rem;
        color: var(--text-secondary);
        max-width: 48rem;
        margin: 0 auto 2rem;
        line-height: 1.6;
        font-weight: 500;
    }

    /* Premium Glass Cards */
    .premium-glass-card {
        background: var(--glass-bg);
        backdrop-filter: blur(20px);
        border: 1px solid var(--glass-border);
        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5), 
                    0 0 0 1px rgba(255, 255, 255, 0.05);
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .premium-glass-card:hover {
        transform: translateY(-8px);
        box-shadow: 0 35px 60px -12px rgba(0, 0, 0, 0.7), 
                    0 0 0 1px rgba(255, 255, 255, 0.1);
    }

    /* Navigation Tabs */
    .nav-tabs-container {
        display: flex;
        justify-content: center;
        gap: 1rem;
        margin-bottom: 3rem;
        flex-wrap: wrap;
    }

    .nav-tab {
        padding: 1rem 2rem;
        background: rgba(31, 41, 55, 0.8);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 1rem;
        color: var(--text-secondary);
        font-weight: 600;
        font-size: 0.95rem;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        backdrop-filter: blur(10px);
        cursor: pointer;
    }

    .nav-tab:hover {
        color: var(--text-primary);
        transform: translateY(-2px);
        box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.3);
        background: rgba(55, 65, 81, 0.8);
    }

    .nav-tab.active {
        background: linear-gradient(135deg, var(--primary-dark), var(--secondary-dark));
        color: var(--text-primary);
        border-color: rgba(255, 255, 255, 0.2);
        box-shadow: 0 10px 25px -5px rgba(75, 85, 99, 0.4);
    }

    /* Statistics Grid */
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 2rem;
        margin-bottom: 3rem;
    }

    .stat-card {
        background: var(--glass-bg);
        backdrop-filter: blur(20px);
        border: 1px solid var(--glass-border);
        border-radius: 1.5rem;
        padding: 2rem;
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        overflow: hidden;
    }

    .stat-card:hover {
        transform: translateY(-8px) scale(1.02);
        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.6);
        border-color: rgba(255, 255, 255, 0.2);
    }

    /* Premium Buttons */
    .premium-button {
        padding: 0.75rem 1.5rem;
        border-radius: 0.75rem;
        font-weight: 600;
        font-size: 0.95rem;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        border: none;
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
    }

    .btn-primary {
        background: linear-gradient(135deg, var(--primary-dark), var(--secondary-dark));
        color: white;
        box-shadow: 0 10px 25px -5px rgba(75, 85, 99, 0.4);
    }

    .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 15px 35px -5px rgba(75, 85, 99, 0.6);
    }

    /* Filter Section */
    .filter-section {
        background: var(--glass-bg);
        backdrop-filter: blur(20px);
        border: 1px solid var(--glass-border);
        border-radius: 1.5rem;
        padding: 2rem;
        margin-bottom: 2rem;
    }

    .filter-input, .filter-select {
        background: rgba(17, 24, 39, 0.8);
        border: 2px solid rgba(255, 255, 255, 0.1);
        color: white;
        border-radius: 0.75rem;
        padding: 0.875rem 1.25rem;
        width: 100%;
        transition: all 0.3s ease;
        font-size: 0.95rem;
    }

    .filter-input:focus, .filter-select:focus {
        background: rgba(17, 24, 39, 1);
        border-color: #6b7280;
        outline: none;
        box-shadow: 0 0 0 4px rgba(107, 114, 128, 0.1);
    }

    .filter-input::placeholder {
        color: rgba(255, 255, 255, 0.5);
    }

    /* Action Buttons */
    .action-btn {
        padding: 0.5rem 1rem;
        border-radius: 0.5rem;
        font-weight: 600;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        transition: all 0.3s ease;
        border: none;
        cursor: pointer;
    }

    .action-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
    }

    /* Status Badges */
    .status-pending {
        background: linear-gradient(135deg, #f59e0b, #d97706);
        color: white;
        padding: 0.5rem 1rem;
        border-radius: 1.25rem;
        font-weight: 600;
        font-size: 0.75rem;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        display: inline-flex;
        align-items: center;
        gap: 0.25rem;
    }

    .status-approved {
        background: linear-gradient(135deg, #10b981, #059669);
        color: white;
        padding: 0.5rem 1rem;
        border-radius: 1.25rem;
        font-weight: 600;
        font-size: 0.75rem;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        display: inline-flex;
        align-items: center;
        gap: 0.25rem;
    }

    .status-rejected {
        background: linear-gradient(135deg, #ef4444, #dc2626);
        color: white;
        padding: 0.5rem 1rem;
        border-radius: 1.25rem;
        font-weight: 600;
        font-size: 0.75rem;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        display: inline-flex;
        align-items: center;
        gap: 0.25rem;
    }

    /* Modern Table */
    .modern-table {
        background: var(--glass-bg);
        border-radius: 1.5rem;
        overflow: hidden;
        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        border: 1px solid var(--glass-border);
    }

    .modern-table th {
        background: linear-gradient(135deg, rgba(31, 41, 55, 0.95), rgba(55, 65, 81, 0.95));
        color: var(--text-primary);
        font-weight: 700;
        padding: 1.25rem;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        font-size: 0.875rem;
        border-bottom: 1px solid var(--glass-border);
    }

    .modern-table td {
        padding: 1.25rem;
        border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        color: var(--text-primary);
        vertical-align: top;
    }

    .modern-table tr:hover {
        background: rgba(255, 255, 255, 0.05);
    }

    /* Animation Classes */
    .fade-in-up {
        animation: fadeInUp 0.8s cubic-bezier(0.4, 0, 0.2, 1) forwards;
    }

    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(40px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    /* Responsive Design */
    @media (max-width: 768px) {
        .professional-title {
            font-size: 2.25rem;
        }
        
        .stats-grid {
            grid-template-columns: 1fr;
            gap: 1rem;
        }
        
        .nav-tabs-container {
            flex-direction: column;
            align-items: center;
        }
        
        .nav-tab {
            width: 100%;
            max-width: 300px;
            text-align: center;
        }
    }

    /* Loading States */
    .loading-spinner {
        border: 3px solid rgba(255, 255, 255, 0.1);
        border-top: 3px solid #6b7280;
        border-radius: 50%;
        width: 2.5rem;
        height: 2.5rem;
        animation: spin 1s linear infinite;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
</style>
{% endblock %}

{% block content %}
<div class="partner-dashboard-container partner-applications-page" x-data="partnerApplicationsManager()">>
    {% csrf_token %}
    
    <!-- Professional Header Section -->
    <div class="professional-header">
        <div class="inline-flex items-center justify-center w-20 h-20 bg-gray-700/30 rounded-full mb-6 shadow-xl">
            <i class="fas fa-handshake text-white text-2xl"></i>
        </div>
        <h1 class="professional-title">
            Partner Management Hub
        </h1>
        <p class="professional-subtitle">
            Advanced partner application management with real-time analytics, comprehensive owner tools, and professional workflow automation
        </p>
        
        <!-- Help Button -->
        <div class="mt-6">
            <button @click="showHelp = !showHelp" class="premium-button btn-primary">
                <i class="fas fa-question-circle"></i>
                <span x-text="showHelp ? 'Hide Help' : 'Show Keyboard Shortcuts'"></span>
            </button>
        </div>
        
        <!-- Help Panel -->
        <div x-show="showHelp" x-transition class="mt-6 premium-glass-card rounded-lg p-6 max-w-4xl mx-auto">
            <h4 class="text-xl font-bold text-white mb-4">‚å®Ô∏è Keyboard Shortcuts & Features</h4>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 text-sm">
                <div>
                    <h5 class="font-semibold text-gray-300 mb-2">Navigation</h5>
                    <div class="space-y-1">
                        <div class="flex justify-between">
                            <span class="text-gray-300">Applications Tab</span>
                            <span class="text-gray-400 font-mono">Ctrl + 1</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-300">Owners Tab</span>
                            <span class="text-gray-400 font-mono">Ctrl + 2</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-300">Analytics Tab</span>
                            <span class="text-gray-400 font-mono">Ctrl + 3</span>
                        </div>
                    </div>
                </div>
                <div>
                    <h5 class="font-semibold text-gray-300 mb-2">Features</h5>
                    <div class="space-y-1">
                        <div class="flex justify-between">
                            <span class="text-gray-300">Auto-refresh</span>
                            <span class="text-gray-400">Every 30s</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-300">Sound notifications</span>
                            <span class="text-gray-400">Enabled</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-300">Real-time updates</span>
                            <span class="text-gray-400">Live</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Navigation Tabs -->
    <div class="container mx-auto px-4">
        <div class="nav-tabs-container">
            <button @click="activeTab = 'applications'" :class="activeTab === 'applications' ? 'nav-tab active' : 'nav-tab'">
                <i class="fas fa-file-alt mr-2"></i>
                Applications Management
            </button>
            <button @click="activeTab = 'owners'" :class="activeTab === 'owners' ? 'nav-tab active' : 'nav-tab'">
                <i class="fas fa-users mr-2"></i>
                Active Owners
            </button>
            <button @click="activeTab = 'analytics'" :class="activeTab === 'analytics' ? 'nav-tab active' : 'nav-tab'">
                <i class="fas fa-chart-bar mr-2"></i>
                Analytics & Reports
            </button>
        </div>

        <!-- Statistics Cards -->
        <div class="stats-grid fade-in-up">
            <div class="stat-card">
                <div class="flex items-center justify-between">
                    <div>
                        <div class="text-4xl font-black text-white mb-2" x-text="stats.pending"></div>
                        <div class="text-orange-200 font-bold uppercase text-sm tracking-wider">Pending Review</div>
                        <div class="text-orange-300/60 text-xs mt-1">Awaiting approval</div>
                    </div>
                    <div class="w-20 h-20 bg-gradient-to-br from-orange-400 to-orange-600 rounded-2xl flex items-center justify-center shadow-lg">
                        <i class="fas fa-clock text-white text-2xl"></i>
                    </div>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="flex items-center justify-between">
                    <div>
                        <div class="text-4xl font-black text-white mb-2" x-text="stats.approved"></div>
                        <div class="text-green-200 font-bold uppercase text-sm tracking-wider">Active Partners</div>
                        <div class="text-green-300/60 text-xs mt-1">Verified owners</div>
                    </div>
                    <div class="w-20 h-20 bg-gradient-to-br from-green-400 to-green-600 rounded-2xl flex items-center justify-center shadow-lg">
                        <i class="fas fa-check-circle text-white text-2xl"></i>
                    </div>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="flex items-center justify-between">
                    <div>
                        <div class="text-4xl font-black text-white mb-2" x-text="stats.rejected"></div>
                        <div class="text-red-200 font-bold uppercase text-sm tracking-wider">Rejected</div>
                        <div class="text-red-300/60 text-xs mt-1">Not approved</div>
                    </div>
                    <div class="w-20 h-20 bg-gradient-to-br from-red-400 to-red-600 rounded-2xl flex items-center justify-center shadow-lg">
                        <i class="fas fa-times-circle text-white text-2xl"></i>
                    </div>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="flex items-center justify-between">
                    <div>
                        <div class="text-4xl font-black text-white mb-2" x-text="stats.total"></div>
                        <div class="text-blue-200 font-bold uppercase text-sm tracking-wider">Total Applications</div>
                        <div class="text-blue-300/60 text-xs mt-1">All submissions</div>
                    </div>
                    <div class="w-20 h-20 bg-gradient-to-br from-blue-400 to-blue-600 rounded-2xl flex items-center justify-center shadow-lg">
                        <i class="fas fa-users text-white text-2xl"></i>
                    </div>
                </div>
            </div>
        </div>

        <!-- Applications Tab Content -->
        <div x-show="activeTab === 'applications'" class="fade-in-up">
            <!-- Filter Section -->
            <div class="filter-section">
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                    <div>
                        <input type="text" 
                               placeholder="Search applications..." 
                               x-model="searchTerm"
                               @input="filterApplications()"
                               class="filter-input">
                    </div>
                    <div>
                        <select x-model="statusFilter" @change="filterApplications()" class="filter-select">
                            <option value="">All Status</option>
                            <option value="pending">Pending</option>
                            <option value="approved">Approved</option>
                            <option value="rejected">Rejected</option>
                        </select>
                    </div>
                    <div>
                        <input type="date" 
                               x-model="dateFilter"
                               @change="filterApplications()"
                               class="filter-input">
                    </div>
                    <div class="flex gap-2">
                        <button @click="exportData()" class="premium-button btn-primary flex-1">
                            <i class="fas fa-download"></i>
                            Export CSV
                        </button>
                        <button @click="refreshData()" class="premium-button btn-primary">
                            <i class="fas fa-sync-alt"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Applications Table -->
            <div class="modern-table w-full overflow-x-auto">
                <table class="w-full">
                    <thead>
                        <tr>
                            <th class="text-left">Partner Info</th>
                            <th class="text-left">Contact Details</th>
                            <th class="text-left">Playground Details</th>
                            <th class="text-left">Media Files</th>
                            <th class="text-left">Status</th>
                            <th class="text-left">Submitted</th>
                            <th class="text-center">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <template x-for="application in filteredApplications" :key="application.id">
                            <tr class="border-t border-gray-700/50 hover:bg-gray-800/30">
                                <td>
                                    <div class="flex items-center space-x-3">
                                        <div class="w-12 h-12 bg-gradient-to-br from-blue-500 to-purple-600 rounded-xl flex items-center justify-center">
                                            <span class="text-white font-bold text-lg" x-text="application.full_name.charAt(0).toUpperCase()"></span>
                                        </div>
                                        <div>
                                            <div class="text-white font-semibold" x-text="application.full_name"></div>
                                            <div class="text-gray-400 text-sm" x-text="application.email"></div>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <div class="text-sm">
                                        <div class="text-gray-300">üìû <span x-text="application.phone_number"></span></div>
                                        <div class="text-gray-400 mt-1">üìç <span x-text="application.address"></span></div>
                                    </div>
                                </td>
                                <td>
                                    <div class="text-sm">
                                        <div class="text-white font-medium" x-text="application.playground_name"></div>
                                        <div class="text-gray-400 mt-1" x-text="application.playground_address"></div>
                                        <div class="text-gray-500 text-xs mt-1">
                                            üìè <span x-text="application.playground_size"></span> | 
                                            üèÉ <span x-text="application.playground_type"></span>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <div class="flex flex-wrap gap-1">
                                        <template x-for="image in application.images" :key="image.id">
                                            <img :src="image.url" 
                                                 :alt="'Playground image'"
                                                 @click="viewMedia(image.url, 'image')"
                                                 class="w-10 h-10 rounded-lg object-cover cursor-pointer hover:scale-105 transition-transform">
                                        </template>
                                        <template x-for="video in application.videos" :key="video.id">
                                            <div @click="viewMedia(video.url, 'video')"
                                                 class="w-10 h-10 bg-red-600 rounded-lg flex items-center justify-center cursor-pointer hover:scale-105 transition-transform">
                                                <i class="fas fa-play text-white text-xs"></i>
                                            </div>
                                        </template>
                                    </div>
                                </td>
                                <td>
                                    <span :class="getStatusClass(application.status)" x-text="application.status.toUpperCase()"></span>
                                </td>
                                <td>
                                    <div class="text-sm text-gray-300" x-text="formatDate(application.created_at)"></div>
                                </td>
                                <td>
                                    <div class="flex space-x-2 justify-center">
                                        <button @click="viewApplication(application)" 
                                                class="action-btn bg-blue-600 hover:bg-blue-700 text-white">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        <template x-if="application.status === 'pending'">
                                            <div class="flex space-x-1">
                                                <button @click="approveApplication(application.id)" 
                                                        class="action-btn bg-green-600 hover:bg-green-700 text-white">
                                                    <i class="fas fa-check"></i>
                                                </button>
                                                <button @click="rejectApplication(application.id)" 
                                                        class="action-btn bg-red-600 hover:bg-red-700 text-white">
                                                    <i class="fas fa-times"></i>
                                                </button>
                                            </div>
                                        </template>
                                        <button @click="deleteApplication(application.id)" 
                                                class="action-btn bg-gray-600 hover:bg-gray-700 text-white">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        </template>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Owners Tab Content -->
        <div x-show="activeTab === 'owners'" class="fade-in-up">
            <div class="modern-table w-full overflow-x-auto">
                <table class="w-full">
                    <thead>
                        <tr>
                            <th class="text-left">Owner Details</th>
                            <th class="text-left">Playground Info</th>
                            <th class="text-left">Performance</th>
                            <th class="text-left">Status</th>
                            <th class="text-center">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <template x-for="owner in approvedOwners" :key="owner.id">
                            <tr class="border-t border-gray-700/50 hover:bg-gray-800/30">
                                <td>
                                    <div class="flex items-center space-x-3">
                                        <div class="w-12 h-12 bg-gradient-to-br from-green-500 to-blue-600 rounded-xl flex items-center justify-center">
                                            <span class="text-white font-bold text-lg" x-text="owner.full_name.charAt(0).toUpperCase()"></span>
                                        </div>
                                        <div>
                                            <div class="text-white font-semibold" x-text="owner.full_name"></div>
                                            <div class="text-gray-400 text-sm" x-text="owner.email"></div>
                                            <div class="text-gray-500 text-xs" x-text="owner.phone_number"></div>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <div class="text-sm">
                                        <div class="text-white font-medium" x-text="owner.playground_name"></div>
                                        <div class="text-gray-400 mt-1" x-text="owner.playground_address"></div>
                                        <div class="text-gray-500 text-xs mt-1">
                                            üìè <span x-text="owner.playground_size"></span> | 
                                            üèÉ <span x-text="owner.playground_type"></span>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <div class="text-sm">
                                        <div class="text-green-400">‚≠ê 4.8/5.0 Rating</div>
                                        <div class="text-gray-400 mt-1">üìä 128 Bookings</div>
                                        <div class="text-gray-500 text-xs mt-1">üí∞ $2,450 Revenue</div>
                                    </div>
                                </td>
                                <td>
                                    <span class="status-approved">
                                        <i class="fas fa-check-circle"></i>
                                        ACTIVE
                                    </span>
                                </td>
                                <td>
                                    <div class="flex space-x-2 justify-center">
                                        <button @click="viewOwnerDetails(owner)" 
                                                class="action-btn bg-blue-600 hover:bg-blue-700 text-white">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        <button @click="suspendOwner(owner.id)" 
                                                class="action-btn bg-orange-600 hover:bg-orange-700 text-white">
                                            <i class="fas fa-pause"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        </template>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Analytics Tab Content -->
        <div x-show="activeTab === 'analytics'" class="fade-in-up">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="premium-glass-card p-6 rounded-xl">
                    <h3 class="text-xl font-bold text-white mb-4">Application Trends</h3>
                    <canvas id="applicationChart" width="400" height="200"></canvas>
                </div>
                <div class="premium-glass-card p-6 rounded-xl">
                    <h3 class="text-xl font-bold text-white mb-4">Status Distribution</h3>
                    <canvas id="statusChart" width="400" height="200"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- Application Detail Modal -->
    <div x-show="showModal" 
         x-transition:enter="transition ease-out duration-300"
         x-transition:enter-start="opacity-0 scale-95"
         x-transition:enter-end="opacity-100 scale-100"
         x-transition:leave="transition ease-in duration-200"
         x-transition:leave-start="opacity-100 scale-100"
         x-transition:leave-end="opacity-0 scale-95"
         class="fixed inset-0 z-50 overflow-y-auto"
         @click.self="closeModal()">
        <div class="flex items-center justify-center min-h-screen px-4">
            <div class="fixed inset-0 bg-black/70 backdrop-blur-sm"></div>
            <div class="relative bg-gradient-to-br from-gray-900 to-gray-800 rounded-2xl border border-gray-700 max-w-4xl w-full max-h-[90vh] overflow-y-auto">
                <div class="p-8">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-2xl font-bold text-white">Application Details</h3>
                        <button @click="closeModal()" class="text-gray-400 hover:text-white transition-colors">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                    
                    <template x-if="selectedApplication">
                        <div class="space-y-6">
                            <!-- Personal Information -->
                            <div class="premium-glass-card p-6 rounded-xl">
                                <h4 class="text-lg font-semibold text-white mb-4">Personal Information</h4>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="text-gray-400 text-sm">Full Name</label>
                                        <div class="text-white font-medium" x-text="selectedApplication.full_name"></div>
                                    </div>
                                    <div>
                                        <label class="text-gray-400 text-sm">Email</label>
                                        <div class="text-white font-medium" x-text="selectedApplication.email"></div>
                                    </div>
                                    <div>
                                        <label class="text-gray-400 text-sm">Phone</label>
                                        <div class="text-white font-medium" x-text="selectedApplication.phone_number"></div>
                                    </div>
                                    <div>
                                        <label class="text-gray-400 text-sm">Address</label>
                                        <div class="text-white font-medium" x-text="selectedApplication.address"></div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Playground Information -->
                            <div class="premium-glass-card p-6 rounded-xl">
                                <h4 class="text-lg font-semibold text-white mb-4">Playground Information</h4>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="text-gray-400 text-sm">Playground Name</label>
                                        <div class="text-white font-medium" x-text="selectedApplication.playground_name"></div>
                                    </div>
                                    <div>
                                        <label class="text-gray-400 text-sm">Type</label>
                                        <div class="text-white font-medium" x-text="selectedApplication.playground_type"></div>
                                    </div>
                                    <div>
                                        <label class="text-gray-400 text-sm">Size</label>
                                        <div class="text-white font-medium" x-text="selectedApplication.playground_size"></div>
                                    </div>
                                    <div>
                                        <label class="text-gray-400 text-sm">Address</label>
                                        <div class="text-white font-medium" x-text="selectedApplication.playground_address"></div>
                                    </div>
                                </div>
                                <div class="mt-4">
                                    <label class="text-gray-400 text-sm">Description</label>
                                    <div class="text-white font-medium" x-text="selectedApplication.playground_description"></div>
                                </div>
                            </div>
                            
                            <!-- Media Gallery -->
                            <div class="premium-glass-card p-6 rounded-xl">
                                <h4 class="text-lg font-semibold text-white mb-4">Media Gallery</h4>
                                
                                <!-- Images -->
                                <div class="mb-6">
                                    <h5 class="text-gray-300 font-medium mb-3">Images</h5>
                                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                                        <template x-for="image in selectedApplication.images || []" :key="image.id">
                                            <img :src="image.url" 
                                                 :alt="'Playground image'"
                                                 @click="viewMedia(image.url, 'image')"
                                                 class="w-full h-24 rounded-lg object-cover cursor-pointer hover:scale-105 transition-transform">
                                        </template>
                                    </div>
                                </div>
                                
                                <!-- Videos -->
                                <div>
                                    <h5 class="text-gray-300 font-medium mb-3">Videos</h5>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <template x-for="video in selectedApplication.videos || []" :key="video.id">
                                            <div class="relative">
                                                <video :src="video.url" 
                                                       class="w-full h-40 rounded-lg object-cover"
                                                       controls
                                                       preload="metadata">
                                                </video>
                                            </div>
                                        </template>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Actions -->
                            <div class="flex space-x-4 pt-6">
                                <template x-if="selectedApplication.status === 'pending'">
                                    <div class="flex space-x-3 flex-1">
                                        <button @click="approveApplication(selectedApplication.id)" 
                                                class="premium-button btn-primary flex-1 bg-green-600 hover:bg-green-700">
                                            <i class="fas fa-check"></i>
                                            Approve Application
                                        </button>
                                        <button @click="rejectApplication(selectedApplication.id)" 
                                                class="premium-button btn-primary flex-1 bg-red-600 hover:bg-red-700">
                                            <i class="fas fa-times"></i>
                                            Reject Application
                                        </button>
                                    </div>
                                </template>
                                <button @click="closeModal()" 
                                        class="premium-button btn-primary bg-gray-600 hover:bg-gray-700">
                                    Close
                                </button>
                            </div>
                        </div>
                    </template>
                </div>
            </div>
        </div>
    </div>

    <!-- Media Viewer Modal -->
    <div x-show="showMediaModal" 
         x-transition:enter="transition ease-out duration-300"
         x-transition:enter-start="opacity-0"
         x-transition:enter-end="opacity-100"
         x-transition:leave="transition ease-in duration-200"
         x-transition:leave-start="opacity-100"
         x-transition:leave-end="opacity-0"
         class="fixed inset-0 z-50 flex items-center justify-center"
         @click.self="closeMediaModal()">
        <div class="fixed inset-0 bg-black/90 backdrop-blur-sm"></div>
        <div class="relative max-w-4xl max-h-[90vh] m-4">
            <button @click="closeMediaModal()" 
                    class="absolute top-4 right-4 z-10 text-white hover:text-gray-300 bg-black/50 rounded-full p-2">
                <i class="fas fa-times text-xl"></i>
            </button>
            
            <template x-if="currentMedia.type === 'image'">
                <img :src="currentMedia.url" 
                     class="max-w-full max-h-full rounded-lg shadow-2xl"
                     alt="Playground media">
            </template>
            
            <template x-if="currentMedia.type === 'video'">
                <video :src="currentMedia.url" 
                       class="max-w-full max-h-full rounded-lg shadow-2xl"
                       controls 
                       autoplay>
                </video>
            </template>
        </div>
    </div>
</div>

<script>
function partnerApplicationsManager() {
    return {
        activeTab: 'applications',
        showHelp: false,
        showModal: false,
        showMediaModal: false,
        selectedApplication: null,
        currentMedia: { url: '', type: '' },
        searchTerm: '',
        statusFilter: '',
        dateFilter: '',
        
        stats: {
            pending: 0,
            approved: 0,
            rejected: 0,
            total: 0
        },
        
        applications: [],
        filteredApplications: [],
        approvedOwners: [],
        
        init() {
            this.loadData();
            this.setupKeyboardShortcuts();
            this.startAutoRefresh();
            this.initCharts();
        },
        
        async loadData() {
            try {
                const response = await fetch('/api/partner-applications/', {
                    headers: {
                        'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
                        'Content-Type': 'application/json',
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                this.applications = data.applications || [];
                this.approvedOwners = data.approved_owners || [];
                this.updateStats();
                this.filterApplications();
                
                this.showNotification('Data loaded successfully', 'success');
            } catch (error) {
                console.error('Error loading data:', error);
                this.showNotification('Failed to load data, using sample data', 'warning');
                
                // Fallback to sample data
                this.loadSampleData();
            }
        },
        
        loadSampleData() {
            this.applications = [
                {
                    id: 1,
                    full_name: 'John Smith',
                    email: 'john@example.com',
                    phone_number: '+1234567890',
                    address: '123 Main St, City',
                    playground_name: 'Sports Arena',
                    playground_address: '456 Sports Ave',
                    playground_type: 'Football',
                    playground_size: '100x50m',
                    playground_description: 'Professional football field with modern facilities',
                    status: 'pending',
                    created_at: '2024-01-15T10:30:00Z',
                    images: [
                        { id: 1, url: '/static/img/playground-sample1.jpg' },
                        { id: 2, url: '/static/img/playground-sample2.jpg' }
                    ],
                    videos: [
                        { id: 1, url: '/static/video/playground-tour.mp4' }
                    ]
                },
                {
                    id: 2,
                    full_name: 'Sarah Johnson',
                    email: 'sarah@example.com',
                    phone_number: '+1987654321',
                    address: '789 Oak St, Town',
                    playground_name: 'Basketball Court',
                    playground_address: '321 Court Rd',
                    playground_type: 'Basketball',
                    playground_size: '28x15m',
                    playground_description: 'Indoor basketball court with professional lighting',
                    status: 'active',
                    created_at: '2024-01-10T14:20:00Z',
                    images: [
                        { id: 3, url: '/static/img/basketball-court.jpg' }
                    ],
                    videos: []
                },
                {
                    id: 3,
                    full_name: 'Mike Wilson',
                    email: 'mike@example.com',
                    phone_number: '+1555444333',
                    address: '456 Pine Ave, Village',
                    playground_name: 'Tennis Center',
                    playground_address: '789 Tennis Lane',
                    playground_type: 'Tennis',
                    playground_size: '23x11m',
                    playground_description: 'Professional tennis courts with clay surface',
                    status: 'rejected',
                    created_at: '2024-01-05T09:15:00Z',
                    images: [
                        { id: 4, url: '/static/img/tennis-court.jpg' }
                    ],
                    videos: []
                }
            ];
            
            this.approvedOwners = this.applications.filter(app => app.status === 'active' || app.status === 'approved');
            this.updateStats();
            this.filterApplications();
        },
        
        updateStats() {
            this.stats.pending = this.applications.filter(app => app.status === 'pending').length;
            this.stats.approved = this.applications.filter(app => app.status === 'approved').length;
            this.stats.rejected = this.applications.filter(app => app.status === 'rejected').length;
            this.stats.total = this.applications.length;
        },
        
        filterApplications() {
            this.filteredApplications = this.applications.filter(app => {
                const matchesSearch = !this.searchTerm || 
                    app.full_name.toLowerCase().includes(this.searchTerm.toLowerCase()) ||
                    app.email.toLowerCase().includes(this.searchTerm.toLowerCase()) ||
                    app.playground_name.toLowerCase().includes(this.searchTerm.toLowerCase());
                
                const matchesStatus = !this.statusFilter || app.status === this.statusFilter;
                
                const matchesDate = !this.dateFilter || 
                    new Date(app.created_at).toISOString().split('T')[0] === this.dateFilter;
                
                return matchesSearch && matchesStatus && matchesDate;
            });
        },
        
        async approveApplication(id) {
            if (!confirm('Are you sure you want to approve this application?')) return;
            
            try {
                const response = await fetch(`/api/partner-applications/${id}/approve/`, {
                    method: 'POST',
                    headers: {
                        'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
                        'Content-Type': 'application/json',
                    }
                });
                
                if (response.ok) {
                    const result = await response.json();
                    const application = this.applications.find(app => app.id === id);
                    if (application) {
                        application.status = 'active';
                        this.approvedOwners.push(application);
                    }
                    this.updateStats();
                    this.filterApplications();
                    
                    // Enhanced success message with playground activation info
                    let successMessage = 'Application approved successfully!';
                    if (result.playground_id) {
                        successMessage += ` Associated playground has been activated.`;
                    }
                    
                    this.showNotification(successMessage, 'success');
                    this.playSound('success');
                    this.closeModal();
                } else {
                    const errorData = await response.json();
                    throw new Error(errorData.message || 'Failed to approve application');
                }
            } catch (error) {
                console.error('Error approving application:', error);
                this.showNotification('Error approving application: ' + error.message, 'error');
            }
        },
        
        async rejectApplication(id) {
            if (!confirm('Are you sure you want to reject this application?')) return;
            
            try {
                const response = await fetch(`/api/partner-applications/${id}/reject/`, {
                    method: 'POST',
                    headers: {
                        'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
                        'Content-Type': 'application/json',
                    }
                });
                
                if (response.ok) {
                    const application = this.applications.find(app => app.id === id);
                    if (application) {
                        application.status = 'rejected';
                    }
                    this.updateStats();
                    this.filterApplications();
                    this.showNotification('Application rejected', 'warning');
                    this.closeModal();
                } else {
                    throw new Error('Failed to reject application');
                }
            } catch (error) {
                console.error('Error rejecting application:', error);
                this.showNotification('Error rejecting application', 'error');
            }
        },
        
        async deleteApplication(id) {
            if (!confirm('Are you sure you want to delete this application? This action cannot be undone.')) return;
            
            try {
                const response = await fetch(`/api/partner-applications/${id}/`, {
                    method: 'DELETE',
                    headers: {
                        'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
                    }
                });
                
                if (response.ok) {
                    this.applications = this.applications.filter(app => app.id !== id);
                    this.approvedOwners = this.approvedOwners.filter(owner => owner.id !== id);
                    this.updateStats();
                    this.filterApplications();
                    this.showNotification('Application deleted successfully', 'success');
                } else {
                    throw new Error('Failed to delete application');
                }
            } catch (error) {
                console.error('Error deleting application:', error);
                this.showNotification('Error deleting application', 'error');
            }
        },
        
        viewApplication(application) {
            this.selectedApplication = application;
            this.showModal = true;
        },
        
        viewOwnerDetails(owner) {
            this.selectedApplication = owner;
            this.showModal = true;
        },
        
        suspendOwner(id) {
            if (!confirm('Are you sure you want to suspend this owner?')) return;
            
            const owner = this.approvedOwners.find(o => o.id === id);
            if (owner) {
                owner.status = 'suspended';
                this.showNotification('Owner suspended successfully', 'warning');
            }
        },
        
        closeModal() {
            this.showModal = false;
            this.selectedApplication = null;
        },
        
        viewMedia(url, type) {
            this.currentMedia = { url, type };
            this.showMediaModal = true;
        },
        
        closeMediaModal() {
            this.showMediaModal = false;
            this.currentMedia = { url: '', type: '' };
        },
        
        formatDate(dateString) {
            return new Date(dateString).toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'short',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        },
        
        getStatusClass(status) {
            const classes = {
                pending: 'status-pending',
                active: 'status-approved',
                approved: 'status-approved',
                rejected: 'status-rejected'
            };
            return classes[status] || 'status-pending';
        },
        
        exportData() {
            const csvContent = this.generateCSV();
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `partner_applications_${new Date().toISOString().split('T')[0]}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
            this.showNotification('Data exported successfully!', 'success');
        },
        
        generateCSV() {
            const headers = ['Name', 'Email', 'Phone', 'Playground Name', 'Type', 'Status', 'Created Date'];
            const rows = this.applications.map(app => [
                app.full_name,
                app.email,
                app.phone_number,
                app.playground_name,
                app.playground_type,
                app.status,
                this.formatDate(app.created_at)
            ]);
            
            return [headers, ...rows].map(row => 
                row.map(field => `"${field}"`).join(',')
            ).join('\n');
        },
        
        async refreshData() {
            this.showNotification('Refreshing data...', 'info');
            await this.loadData();
        },
        
        startAutoRefresh() {
            setInterval(() => {
                this.loadData();
            }, 30000); // Refresh every 30 seconds
        },
        
        setupKeyboardShortcuts() {
            document.addEventListener('keydown', (e) => {
                if (e.ctrlKey) {
                    switch(e.key) {
                        case '1':
                            e.preventDefault();
                            this.activeTab = 'applications';
                            break;
                        case '2':
                            e.preventDefault();
                            this.activeTab = 'owners';
                            break;
                        case '3':
                            e.preventDefault();
                            this.activeTab = 'analytics';
                            break;
                    }
                }
                
                if (e.key === 'Escape') {
                    this.closeModal();
                    this.closeMediaModal();
                }
            });
        },
        
        initCharts() {
            setTimeout(() => {
                this.createApplicationChart();
                this.createStatusChart();
            }, 1000);
        },
        
        createApplicationChart() {
            const ctx = document.getElementById('applicationChart');
            if (!ctx) return;
            
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                    datasets: [{
                        label: 'Applications',
                        data: [12, 19, 8, 15, 25, 18],
                        borderColor: '#6366f1',
                        backgroundColor: 'rgba(99, 102, 241, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            labels: { color: 'white' }
                        }
                    },
                    scales: {
                        x: { 
                            ticks: { color: 'white' },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' }
                        },
                        y: { 
                            ticks: { color: 'white' },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' }
                        }
                    }
                }
            });
        },
        
        createStatusChart() {
            const ctx = document.getElementById('statusChart');
            if (!ctx) return;
            
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Pending', 'Approved', 'Rejected'],
                    datasets: [{
                        data: [this.stats.pending, this.stats.approved, this.stats.rejected],
                        backgroundColor: ['#f59e0b', '#10b981', '#ef4444'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            labels: { color: 'white' }
                        }
                    }
                }
            });
        },
        
        showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 z-50 p-4 rounded-lg text-white ${this.getNotificationClass(type)} transition-all duration-300 transform translate-x-full`;
            notification.innerHTML = `
                <div class="flex items-center space-x-2">
                    <i class="fas ${this.getNotificationIcon(type)}"></i>
                    <span>${message}</span>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.classList.remove('translate-x-full');
            }, 100);
            
            setTimeout(() => {
                notification.classList.add('translate-x-full');
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        },
        
        getNotificationClass(type) {
            const classes = {
                success: 'bg-green-600',
                error: 'bg-red-600',
                warning: 'bg-orange-600',
                info: 'bg-blue-600'
            };
            return classes[type] || classes.info;
        },
        
        getNotificationIcon(type) {
            const icons = {
                success: 'fa-check-circle',
                error: 'fa-exclamation-circle',
                warning: 'fa-exclamation-triangle',
                info: 'fa-info-circle'
            };
            return icons[type] || icons.info;
        },
        
        playSound(type) {
            if ('AudioContext' in window || 'webkitAudioContext' in window) {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                const frequency = type === 'success' ? 800 : 400;
                oscillator.frequency.setValueAtTime(frequency, audioContext.currentTime);
                oscillator.type = 'sine';
                
                gainNode.gain.setValueAtTime(0, audioContext.currentTime);
                gainNode.gain.linearRampToValueAtTime(0.1, audioContext.currentTime + 0.01);
                gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.3);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.3);
            }
        }
    }
}
</script>

{% endblock %}
