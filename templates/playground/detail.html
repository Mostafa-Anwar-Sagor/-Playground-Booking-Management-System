{% extends 'base.html' %}
{% load static %}

{% block title %}{{ playground.name }} | PlayGround Booking{% endblock %}

{% block extra_head %}
<style>
    .info-card {
        background: var(--card-bg);
        border: 1px solid var(--border-color);
        border-radius: 1rem;
        padding: 1.5rem;
        margin-bottom: 2rem;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    }
    
    /* Auto Slider Styles */
    .cover-slider {
        position: relative;
        width: 100%;
        height: 500px; /* Landscape height - much shorter for proper aspect ratio */
        border-radius: 1rem;
        overflow: hidden;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
        transition: all 0.3s ease;
    }
    
    .cover-slider:hover {
        box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3);
        transform: translateY(-2px);
    }
    
    .slider-container {
        position: relative;
        width: 100%;
        height: 100%;
    }
    
    .slide {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        opacity: 0;
        transition: opacity 1s ease-in-out;
    }
    
    .slide.active {
        opacity: 1;
    }
    
    .slide img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        object-position: center;
        transition: transform 0.3s ease;
    }
    
    .slide img:hover {
        transform: scale(1.02);
    }
    
    /* Add subtle gradient overlay for enhanced visual appeal */
    .slide::after {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(
            135deg,
            rgba(0, 0, 0, 0.1) 0%,
            rgba(0, 0, 0, 0.05) 30%,
            rgba(0, 0, 0, 0.02) 60%,
            rgba(0, 0, 0, 0.1) 100%
        );
        pointer-events: none;
        opacity: 0;
        transition: opacity 0.3s ease;
    }
    
    .slide:hover::after {
        opacity: 1;
    }
    
    .slider-controls {
        position: absolute;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        display: flex;
        gap: 8px;
        z-index: 10;
        padding: 8px 16px;
        background: rgba(0, 0, 0, 0.2);
        border-radius: 20px;
        backdrop-filter: blur(5px);
    }
    
    .slider-dot {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.5);
        cursor: pointer;
        transition: background 0.3s ease;
    }
    
    .slider-dot.active {
        background: white;
    }
    
    .slider-nav {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        background: rgba(0, 0, 0, 0.5);
        color: white;
        border: none;
        padding: 15px;
        cursor: pointer;
        font-size: 18px;
        transition: background 0.3s ease;
        z-index: 10;
    }
    
    .slider-nav:hover {
        background: rgba(0, 0, 0, 0.8);
    }
    
    .slider-nav.prev {
        left: 20px;
        border-radius: 0 5px 5px 0;
    }
    
    .slider-nav.next {
        right: 20px;
        border-radius: 5px 0 0 5px;
    }
    
    /* Google Maps Styles */
    .map-container {
        position: relative;
        width: 100%;
        height: 300px;
        border-radius: 10px;
        overflow: hidden;
        margin-top: 20px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    }
    
    .map-iframe {
        width: 100%;
        height: 100%;
        border: none;
    }
    
    .map-loading {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 10px;
    }
    
    .spinner {
        border: 3px solid #f3f3f4;
        border-top: 3px solid var(--primary-color);
        border-radius: 50%;
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
    
    /* Responsive Design */
    @media (max-width: 1024px) {
        .cover-slider {
            height: 650px; /* Increased from 550px */
        }
    }
    
    @media (max-width: 768px) {
        .cover-slider {
            height: 450px; /* Increased from 350px for better mobile experience */
        }
        
        .slider-nav {
            padding: 10px;
            font-size: 14px;
        }
        
        .slider-nav.prev {
            left: 10px;
        }
        
        .slider-nav.next {
            right: 10px;
        }
        
        .map-container {
            height: 250px;
        }
        
        .grid.grid-cols-1.lg\\:grid-cols-2 {
            grid-template-columns: 1fr;
        }
        
        .grid.grid-cols-2 {
            grid-template-columns: 1fr;
        }
    }
    
    @media (max-width: 480px) {
        .cover-slider {
            height: 380px; /* Increased from 300px for better small screen experience */
        }
        
        .info-card {
            padding: 1rem;
        }
        
        .detail-item {
            flex-direction: column;
            align-items: flex-start;
            gap: 5px;
        }
        
        .detail-label {
            min-width: auto;
            margin-right: 0;
        }
    }
    
    @media (max-width: 360px) {
        .cover-slider {
            height: 320px; /* New breakpoint for very small screens */
        }
        
        .slider-nav {
            padding: 8px;
            font-size: 12px;
        }
        
        .slider-dot {
            width: 10px;
            height: 10px;
        }
    }
    
    .detail-item {
        display: flex;
        align-items: center;
        padding: 0.75rem 0;
        border-bottom: 1px solid var(--border-color);
    }
    
    .detail-item:last-child {
        border-bottom: none;
    }

    /* Info Section Overlay for Better Text Visibility */
    .info-section {
        background: linear-gradient(145deg, rgba(26, 26, 46, 0.95) 0%, rgba(30, 30, 48, 0.92) 100%);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 16px;
        padding: 2rem;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4), 0 2px 16px rgba(255, 255, 255, 0.05) inset;
        color: #ffffff;
        position: relative;
        overflow: hidden;
    }

    .info-section::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(135deg, 
            rgba(0, 188, 212, 0.05) 0%, 
            rgba(76, 175, 80, 0.03) 50%, 
            rgba(63, 81, 181, 0.05) 100%);
        z-index: -1;
    }

    .info-section h1 {
        color: #ffffff !important;
        text-shadow: 0 2px 8px rgba(0, 0, 0, 0.8), 0 0 20px rgba(255, 255, 255, 0.3);
    }

    /* Status Badge Styling */
    .status-badge {
        padding: 0.5rem 1rem;
        border-radius: 20px;
        font-size: 0.875rem;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        border: 2px solid;
        background: linear-gradient(145deg, rgba(0, 0, 0, 0.7) 0%, rgba(0, 0, 0, 0.5) 100%);
        color: #ffffff;
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.8);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    }

    .status-active {
        border-color: #10b981;
        background: linear-gradient(145deg, #065f46 0%, #047857 100%);
        color: #d1fae5;
    }

    .status-inactive {
        border-color: #ef4444;
        background: linear-gradient(145deg, #7f1d1d 0%, #991b1b 100%);
        color: #fecaca;
    }

    .status-pending {
        border-color: #f59e0b;
        background: linear-gradient(145deg, #78350f 0%, #92400e 100%);
        color: #fef3c7;
    }
    
    .detail-label {
        font-weight: 600;
        color: var(--text-primary);
        min-width: 140px;
        margin-right: 1rem;
    }
    
    .detail-value {
        color: var(--text-secondary);
        flex: 1;
    }
    
    .amenity-tag {
        background: var(--primary-color);
        color: white;
        padding: 0.25rem 0.75rem;
        border-radius: 9999px;
        font-size: 0.875rem;
        margin: 0.25rem;
        display: inline-block;
    }
    
    .status-badge {
        padding: 0.5rem 1rem;
        border-radius: 9999px;
        font-weight: 600;
        font-size: 0.875rem;
        text-transform: uppercase;
    }
    
    .status-active {
        background: linear-gradient(135deg, #10b981, #059669);
        color: white;
    }
    
    .status-pending {
        background: linear-gradient(135deg, #f59e0b, #d97706);
        color: white;
    }
    
    .status-inactive {
        background: linear-gradient(135deg, #6b7280, #4b5563);
        color: white;
    }
    
    .image-gallery {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
        margin-top: 1rem;
    }
    
    .gallery-image {
        width: 100%;
        height: 150px;
        object-fit: cover;
        border-radius: 0.5rem;
        cursor: pointer;
        transition: transform 0.2s ease;
    }
    
    .gallery-image:hover {
        transform: scale(1.05);
    }
    
    .rating-stars {
        color: #fbbf24;
        margin-right: 0.5rem;
    }
    
    .contact-info {
        background: var(--primary-color);
        color: white;
        padding: 1rem;
        border-radius: 0.5rem;
        margin: 1rem 0;
    }
    
    .payment-method {
        background: #f3f4f6;
        border: 1px solid #d1d5db;
        padding: 0.75rem;
        border-radius: 0.5rem;
        margin: 0.5rem 0;
        text-align: center;
        transition: all 0.3s ease;
    }
    
    .payment-method:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        border-color: var(--primary-color);
    }
    
    /* Enhanced mobile responsiveness */
    @media (max-width: 640px) {
        .container {
            padding-left: 1rem;
            padding-right: 1rem;
        }
        
        .info-card {
            padding: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .grid.grid-cols-2 {
            grid-template-columns: 1fr;
            gap: 1rem;
        }
        
        .detail-item {
            padding: 0.5rem 0;
        }
        
        .detail-label {
            font-size: 0.875rem;
            min-width: auto;
            margin-bottom: 0.25rem;
        }
        
        .detail-value {
            font-size: 0.875rem;
        }
        
        .text-4xl {
            font-size: 1.875rem;
        }
        
        .text-2xl {
            font-size: 1.5rem;
        }
        
        .payment-method {
            padding: 0.5rem;
        }
        
        .contact-info {
            padding: 0.75rem;
            margin: 0.75rem 0;
        }
    }
    
    /* Loading states */
    .loading {
        opacity: 0.6;
        pointer-events: none;
    }
    
    .fade-in {
        animation: fadeIn 0.5s ease-in;
    }
    
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }
    
    /* Enhanced visual feedback */
    .btn {
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
    }
    
    .btn::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
        transition: left 0.5s ease;
    }
    
    .btn:hover::before {
        left: 100%;
    }
    
    /* Enhanced Image Modal Styles */
    #imageModal {
        backdrop-filter: blur(10px);
        transition: opacity 0.3s ease;
        opacity: 0;
        display: none;
    }
    
    #imageModal.hidden {
        display: none !important;
        opacity: 0 !important;
        visibility: hidden !important;
        pointer-events: none !important;
        z-index: -1 !important;
    }
    
    #imageModal.hidden * {
        display: none !important;
        visibility: hidden !important;
        pointer-events: none !important;
    }
    
    #imageModal:not(.hidden) {
        display: flex !important;
        opacity: 1;
        visibility: visible;
        pointer-events: auto;
        z-index: 9999;
    }
    
    /* Full Screen Modal Styles */
    .fullscreen-modal {
        width: 100vw !important;
        height: 100vh !important;
        background: #000 !important;
    }
    
    .fullscreen-modal img {
        max-width: 100vw;
        max-height: 100vh;
    }
    
    /* Professional Controls */
    .control-btn {
        background: rgba(0, 0, 0, 0.7);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        color: white;
        padding: 12px;
        border-radius: 12px;
        transition: all 0.3s ease;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .control-btn:hover {
        background: rgba(255, 255, 255, 0.2);
        border-color: rgba(255, 255, 255, 0.3);
        transform: scale(1.05);
    }
    
    .close-btn:hover {
        background: rgba(220, 53, 69, 0.8) !important;
        border-color: rgba(220, 53, 69, 1) !important;
    }
    
    .nav-btn {
        background: rgba(0, 0, 0, 0.8);
        backdrop-filter: blur(15px);
        border: 2px solid rgba(255, 255, 255, 0.2);
        color: white;
        padding: 16px;
        border-radius: 50%;
        transition: all 0.4s ease;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
        opacity: 0.8;
        position: relative;
        z-index: 30;
    }
    
    .nav-btn:hover {
        background: rgba(255, 255, 255, 0.15);
        border-color: rgba(255, 255, 255, 0.4);
        transform: scale(1.1);
        box-shadow: 0 12px 40px rgba(0, 0, 0, 0.7);
        opacity: 1;
    }
    
    .nav-btn-left:hover {
        transform: scale(1.1) translateX(-5px);
    }
    
    .nav-btn-right:hover {
        transform: scale(1.1) translateX(5px);
    }
    
    /* Always show nav buttons when multiple images */
    .nav-btn.show {
        opacity: 0.8;
        visibility: visible;
    }
    
    .nav-btn.show:hover {
        opacity: 1;
    }
    
    .zoom-btn {
        background: rgba(0, 0, 0, 0.6);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        color: white;
        padding: 8px;
        border-radius: 8px;
        transition: all 0.3s ease;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        min-width: 40px;
        min-height: 40px;
    }
    
    .zoom-btn:hover {
        background: rgba(255, 255, 255, 0.15);
        border-color: rgba(255, 255, 255, 0.3);
        transform: scale(1.05);
    }
    
    /* Loading Spinner */
    .loading-spinner {
        text-align: center;
    }
    
    .spinner-ring {
        display: inline-block;
        width: 64px;
        height: 64px;
        border: 3px solid rgba(255, 255, 255, 0.3);
        border-radius: 50%;
        border-top-color: #fff;
        animation: spin 1s ease-in-out infinite;
    }

    /* Modal image transitions */
    #modalImage {
        transition: opacity 0.3s ease, filter 0.3s ease, transform 0.3s ease;
    }

    /* Loading overlay transitions */
    #imageLoader {
        transition: opacity 0.3s ease;
    }
    
    @keyframes spin {
        to { transform: rotate(360deg); }
    }
    
    /* Thumbnail Strip */
    #thumbnailStrip {
        scrollbar-width: thin;
        scrollbar-color: rgba(255, 255, 255, 0.3) transparent;
    }
    
    #thumbnailStrip::-webkit-scrollbar {
        height: 4px;
    }
    
    #thumbnailStrip::-webkit-scrollbar-track {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 2px;
    }
    
    #thumbnailStrip::-webkit-scrollbar-thumb {
        background: rgba(255, 255, 255, 0.3);
        border-radius: 2px;
    }
    
    .thumbnail-item {
        flex-shrink: 0;
        width: 80px;
        height: 60px;
        border-radius: 8px;
        overflow: hidden;
        cursor: pointer;
        transition: all 0.3s ease;
        border: 2px solid transparent;
        position: relative;
    }
    
    .thumbnail-item:hover {
        transform: scale(1.1);
        border-color: rgba(255, 255, 255, 0.5);
    }
    
    .thumbnail-item.active {
        border-color: #00bcd4;
        box-shadow: 0 0 20px rgba(0, 188, 212, 0.5);
    }
    
    .thumbnail-item img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }
    
    /* Image Zoom States */
    .zoomed-in {
        cursor: grab !important;
    }
    
    .zoomed-in:active {
        cursor: grabbing !important;
    }
    
    .zoomed-out {
        cursor: zoom-in !important;
    }
    
    /* Default modal image cursor */
    #modalImage {
        cursor: zoom-in;
        user-select: none;
        -webkit-user-drag: none;
    }
    
    /* Responsive Design for Mobile */
    @media (max-width: 768px) {
        .control-btn {
            padding: 10px;
        }
        
        .nav-btn {
            padding: 12px;
        }
        
        .thumbnail-item {
            width: 60px;
            height: 45px;
        }
        
        #modalTitle {
            font-size: 18px;
        }
        
        #modalCaption {
            font-size: 16px;
        }
    }
    
    /* Keyboard Navigation Hints */
    .keyboard-hint {
        position: fixed;
        top: 50%;
        left: 20px;
        transform: translateY(-50%);
        background: rgba(0, 0, 0, 0.8);
        color: white;
        padding: 16px;
        border-radius: 12px;
        font-size: 14px;
        opacity: 0;
        transition: opacity 0.3s ease;
        pointer-events: none;
        z-index: 10000;
    }
    
    .keyboard-hint.show {
        opacity: 1;
    }

    /* Zoom Controls Container */
    .zoom-controls-container {
        display: flex;
    
        align-items: center;
        gap: 16px;
        margin-top: 16px;
        background: rgba(0, 0, 0, 0.8);
        border-radius: 50px;
        padding: 12px 24px;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    }
    
    /* Enhanced Gallery Grid */
    .enhanced-gallery-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 24px;
        margin-bottom: 32px;
    }
    
    .gallery-item {
        position: relative;
        background: linear-gradient(145deg, #2a2a3e, #1e1e30);
        border-radius: 20px;
        overflow: hidden;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .gallery-item:hover {
        transform: translateY(-8px) scale(1.02);
        box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
        border-color: var(--primary-color);
    }
    
    .gallery-item::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(45deg, transparent, rgba(26, 188, 156, 0.1), transparent);
        opacity: 0;
        transition: opacity 0.3s ease;
        z-index: 1;
        pointer-events: none;
    }
    
    .gallery-item:hover::before {
        opacity: 1;
    }
    
    .gallery-image-container {
        position: relative;
        width: 100%;
        height: 240px;
        overflow: hidden;
    }
    
    .gallery-image {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: all 0.4s ease;
        cursor: pointer;
    }
    
    .gallery-item:hover .gallery-image {
        transform: scale(1.1);
        filter: brightness(1.1) contrast(1.1);
    }
    
    .gallery-overlay {
        position: absolute;
        inset: 0;
        background: linear-gradient(to bottom, transparent, rgba(0,0,0,0.7));
        opacity: 0;
        transition: opacity 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 2;
    }
    
    .gallery-item:hover .gallery-overlay {
        opacity: 1;
    }
    
    .gallery-overlay-content {
        text-align: center;
        color: white;
        transform: translateY(20px);
        transition: transform 0.3s ease;
    }
    
    .gallery-item:hover .gallery-overlay-content {
        transform: translateY(0);
    }
    
    .gallery-info {
        padding: 20px;
        background: rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(10px);
    }
    
    .gallery-caption {
        font-size: 16px;
        font-weight: 600;
        color: #e0e0e0;
        margin-bottom: 8px;
        line-height: 1.4;
    }
    
    .gallery-meta {
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 14px;
        color: #a0a0a0;
    }
    
    .featured-badge {
        background: linear-gradient(135deg, #1abc9c, #16a085);
        color: white;
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 4px;
        box-shadow: 0 4px 12px rgba(26, 188, 156, 0.3);
    }
    
    /* Gallery Actions Enhancement */
    .gallery-actions {
        display: flex;
        justify-content: center;
        gap: 16px;
        flex-wrap: wrap;
        margin-top: 32px;
    }
    
    .gallery-action-btn {
        background: linear-gradient(135deg, #3498db, #2980b9);
        color: white;
        padding: 14px 24px;
        border-radius: 50px;
        border: none;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 8px;
        box-shadow: 0 8px 25px rgba(52, 152, 219, 0.3);
        min-width: 160px;
        justify-content: center;
    }
    
    .gallery-action-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 12px 35px rgba(52, 152, 219, 0.4);
        background: linear-gradient(135deg, #2980b9, #3498db);
    }
    
    .gallery-action-btn.secondary {
        background: linear-gradient(135deg, #34495e, #2c3e50);
        box-shadow: 0 8px 25px rgba(52, 73, 94, 0.3);
    }
    
    .gallery-action-btn.secondary:hover {
        background: linear-gradient(135deg, #2c3e50, #34495e);
        box-shadow: 0 12px 35px rgba(52, 73, 94, 0.4);
    }
    
    /* No Images Placeholder Enhancement */
    .no-images-placeholder {
        background: linear-gradient(135deg, rgba(255,255,255,0.05), rgba(255,255,255,0.02));
        border: 2px dashed rgba(255, 255, 255, 0.2);
        border-radius: 20px;
        padding: 60px 40px;
        text-align: center;
        backdrop-filter: blur(10px);
    }
    
    .no-images-icon {
        width: 80px;
        height: 80px;
        margin: 0 auto 24px;
        opacity: 0.6;
        color: #a0a0a0;
    }
    
    /* Image Loading States */
    .image-loading {
        position: relative;
        overflow: hidden;
    }
    
    .image-loading::after {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
        animation: shimmer 1.5s infinite;
    }
    
    @keyframes shimmer {
        0% { left: -100%; }
        100% { left: 100%; }
    }
    
    /* Responsive Gallery */
    @media (max-width: 768px) {
        .enhanced-gallery-grid {
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 16px;
        }
        
        .gallery-image-container {
            height: 200px;
        }
        
        .gallery-actions {
            flex-direction: column;
            align-items: center;
        }
        
        .gallery-action-btn {
            width: 100%;
            max-width: 280px;
        }
    }
    
    /* Cover Slider Click Enhancement */
    .cover-slider .slide {
        cursor: pointer;
        transition: all 0.3s ease;
    }
    
    .cover-slider .slide:hover {
        transform: scale(1.02);
    }
    
    .cover-slider .slide:hover img {
        filter: brightness(1.1) contrast(1.2);
    }
    
    /* Improved accessibility */
    .slider-nav:focus,
    .slider-dot:focus {
        outline: 2px solid var(--primary-color);
        outline-offset: 2px;
    }
    
    /* Enhanced map container */
    .map-container {
        border: 2px solid #e5e7eb;
        transition: border-color 0.3s ease;
    }
    
    .map-container:hover {
        border-color: var(--primary-color);
    }
</style>
{% endblock %}

{% block content %}
<style>
/* Dark Theme Professional Design */
body {
    background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
    min-height: 100vh;
    color: #e0e0e0;
}

.container {
    background: transparent;
}

.info-card {
    background: linear-gradient(145deg, #2a2a3e 0%, #1e1e30 100%);
    border: 1px solid #3a3a4e;
    border-radius: 16px;
    padding: 2rem;
    margin-bottom: 2rem;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3), 0 2px 16px rgba(255, 255, 255, 0.05) inset;
    backdrop-filter: blur(10px);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.info-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4), 0 2px 20px rgba(255, 255, 255, 0.08) inset;
}

.text-primary {
    color: #00bcd4 !important;
    text-shadow: 0 0 10px rgba(0, 188, 212, 0.3);
}

    .text-gradient {
        background: linear-gradient(135deg, #ffffff, #f0f8ff, #e6f3ff);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.8), 0 0 20px rgba(255, 255, 255, 0.5);
        filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.8));
    }.detail-label {
    color: #b0b0c0;
    font-weight: 600;
    display: inline-block;
    min-width: 140px;
}

.detail-value {
    color: #f0f0f0;
    font-weight: 500;
}

.detail-item {
    padding: 0.75rem 0;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    transition: all 0.3s ease;
}

.detail-item:hover {
    background: rgba(255, 255, 255, 0.05);
    border-radius: 8px;
    padding-left: 1rem;
    padding-right: 1rem;
}

.detail-item:last-child {
    border-bottom: none;
}

.payment-method {
    background: linear-gradient(145deg, #2a2a3e 0%, #1e1e30 100%);
    border: 1px solid #3a3a4e;
    border-radius: 12px;
    padding: 1.5rem;
    text-align: center;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.payment-method::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(0, 188, 212, 0.1), transparent);
    transition: left 0.5s ease;
}

.payment-method:hover::before {
    left: 100%;
}

.payment-method:hover {
    transform: translateY(-4px);
    border-color: #00bcd4;
    box-shadow: 0 8px 25px rgba(0, 188, 212, 0.2);
}

.btn {
    border-radius: 12px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    transition: all 0.3s ease;
    border: none;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
}

.btn-primary {
    background: linear-gradient(135deg, #00bcd4, #0097a7);
    color: white;
}

.btn-primary:hover {
    background: linear-gradient(135deg, #00acc1, #00838f);
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(0, 188, 212, 0.4);
}

.btn-secondary {
    background: linear-gradient(135deg, #555570, #444455);
    color: #e0e0e0;
    border: 1px solid #666680;
}

.btn-secondary:hover {
    background: linear-gradient(135deg, #666680, #555570);
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(85, 85, 112, 0.3);
}

.status-badge {
    padding: 0.5rem 1rem;
    border-radius: 20px;
    font-size: 0.875rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.status-active {
    background: linear-gradient(135deg, #4caf50, #388e3c);
    color: white;
    box-shadow: 0 2px 10px rgba(76, 175, 80, 0.3);
}

/* Cover Slider Dark Theme */
.cover-slider {
    position: relative;
    height: 400px;
    border-radius: 16px;
    overflow: hidden;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
}

.slider-container {
    height: 100%;
    position: relative;
}

.slide {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    opacity: 0;
    transition: opacity 0.5s ease;
}

.slide.active {
    opacity: 1;
}

.slide img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    filter: brightness(0.9) contrast(1.1);
}

.slider-nav {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    background: rgba(0, 0, 0, 0.7);
    color: white;
    border: none;
    width: 50px;
    height: 50px;
    border-radius: 50%;
    font-size: 1.5rem;
    cursor: pointer;
    transition: all 0.3s ease;
    backdrop-filter: blur(10px);
}

.slider-nav:hover {
    background: rgba(0, 188, 212, 0.8);
    transform: translateY(-50%) scale(1.1);
}

.slider-nav.prev {
    left: 15px;
}

.slider-nav.next {
    right: 15px;
}

.slider-controls {
    position: absolute;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 10px;
}

.slider-dot {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.5);
    cursor: pointer;
    transition: all 0.3s ease;
}

.slider-dot.active,
.slider-dot:hover {
    background: #00bcd4;
    transform: scale(1.2);
}

/* Map Container */
.map-container {
    height: 320px;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
}

.map-iframe {
    width: 100%;
    height: 100%;
    border: none;
    filter: hue-rotate(180deg) invert(90%);
}

.spinner {
    width: 40px;
    height: 40px;
    border: 4px solid rgba(0, 188, 212, 0.3);
    border-top: 4px solid #00bcd4;
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* Image Gallery Dark Theme */
.image-gallery {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1.5rem;
    margin-top: 1rem;
}

.gallery-image {
    width: 100%;
    height: 200px;
    object-fit: cover;
    border-radius: 12px;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
}

.gallery-image:hover {
    transform: scale(1.05);
    box-shadow: 0 8px 25px rgba(0, 188, 212, 0.3);
}

/* Amenity Tags */
.amenity-tag {
    display: inline-block;
    background: linear-gradient(135deg, #37474f, #263238);
    color: #e0e0e0;
    padding: 0.5rem 1rem;
    margin: 0.25rem;
    border-radius: 20px;
    font-size: 0.875rem;
    border: 1px solid #455a64;
    transition: all 0.3s ease;
}

.amenity-tag:hover {
    background: linear-gradient(135deg, #455a64, #37474f);
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(0, 188, 212, 0.2);
}

/* Responsive Design */
@media (max-width: 768px) {
    .info-card {
        padding: 1.5rem;
    }
    
    .cover-slider {
        height: 250px;
    }
    
    .slider-nav {
        width: 40px;
        height: 40px;
        font-size: 1.2rem;
    }
    
    .payment-method {
        padding: 1rem;
    }
}

/* Time Slots Dark Theme */
.slot-currency, .slot-price {
    color: #e0e0e0;
    font-weight: 600;
}

/* Enhanced Dynamic Time Slots Styling - Dark Theme */
.time-slot-card {
    background: linear-gradient(145deg, #1f2937 0%, #111827 100%);
    border: 1px solid #374151;
    border-radius: 20px;
    padding: 1.5rem;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
    cursor: pointer;
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
    color: #f3f4f6;
    min-height: 180px;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
}

.time-slot-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(90deg, #06b6d4, #3b82f6);
    opacity: 0;
    transition: opacity 0.3s ease;
}

.time-slot-card:hover {
    transform: translateY(-6px);
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
    border-color: #06b6d4;
    background: linear-gradient(145deg, #22374a 0%, #1a202c 100%);
}

.time-slot-card:hover::before {
    opacity: 1;
}

.time-slot-card.basic {
    background: linear-gradient(145deg, #1f2937 0%, #111827 100%);
    border-color: #4b5563;
}

.time-slot-card.premium {
    background: linear-gradient(145deg, #7c2d12 0%, #451a03 100%);
    border-color: #f59e0b;
    border-width: 2px;
}

.time-slot-card.premium::before {
    background: linear-gradient(90deg, #f59e0b, #d97706);
    height: 5px;
}

.time-slot-card.premium:hover {
    background: linear-gradient(145deg, #92400e 0%, #5b1f03 100%);
    border-color: #fbbf24;
    box-shadow: 0 20px 40px rgba(251, 191, 36, 0.2);
}

/* Slot Content Styling - Dark Theme */
.slot-day {
    font-weight: 700;
    color: #d1d5db;
    font-size: 0.875rem;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    margin-bottom: 0.5rem;
}

.slot-time {
    font-size: 1.25rem;
    font-weight: 700;
    color: #ffffff;
    margin: 0.75rem 0;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.slot-time i {
    color: #06b6d4;
    font-size: 1rem;
}

.slot-price {
    display: flex;
    align-items: baseline;
    gap: 0.25rem;
    margin: 0.75rem 0;
}

.slot-price .currency {
    font-size: 0.875rem;
    color: #9ca3af;
    font-weight: 500;
}

.slot-price .amount {
    font-size: 1.25rem;
    font-weight: 800;
    color: #10b981;
}

.slot-capacity, .slot-duration {
    font-size: 0.875rem;
    color: #9ca3af;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-top: 0.5rem;
}

.slot-capacity i, .slot-duration i {
    color: #6b7280;
    font-size: 0.75rem;
}

.slot-status {
    padding: 0.25rem 0.75rem;
    border-radius: 12px;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

.slot-status.available {
    background: #064e3b;
    color: #6ee7b7;
    border: 1px solid #059669;
}

.slot-status.unavailable {
    background: #7f1d1d;
    color: #fca5a5;
    border: 1px solid #dc2626;
}

/* Enhanced Tab Styling - Dark Theme */
.slot-tabs {
    display: flex;
    gap: 0.5rem;
    margin-bottom: 1.5rem;
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
    scrollbar-width: none;
    -ms-overflow-style: none;
}

.slot-tabs::-webkit-scrollbar {
    display: none;
}

.tab-button {
    background: linear-gradient(145deg, #374151 0%, #1f2937 100%);
    color: #9ca3af;
    border: 1px solid #4b5563;
    border-radius: 12px;
    padding: 0.75rem 1.25rem;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    white-space: nowrap;
    flex-shrink: 0;
    font-size: 0.875rem;
}

.tab-button:hover {
    background: linear-gradient(145deg, #4b5563 0%, #374151 100%);
    color: #e5e7eb;
    border-color: #6b7280;
    transform: translateY(-1px);
}

.tab-button.active {
    background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%);
    color: #ffffff;
    border-color: #06b6d4;
    box-shadow: 0 4px 20px rgba(6, 182, 212, 0.4);
}

.tab-button i {
    font-size: 1rem;
}

/* Custom Slot Cards - Premium Professional Style */
.custom-slot-card {
    background: linear-gradient(145deg, #4c1d95 0%, #312e81 100%);
    border: 2px solid #6d28d9;
    border-radius: 20px;
    padding: 1.75rem;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
    box-shadow: 0 8px 25px rgba(109, 40, 217, 0.4);
    color: #f3f4f6;
    min-height: 200px;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
}

.custom-slot-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 5px;
    background: linear-gradient(90deg, #7c3aed, #a855f7, #ec4899);
    opacity: 1;
}

.custom-slot-card:hover {
    transform: translateY(-8px);
    box-shadow: 0 20px 40px rgba(109, 40, 217, 0.5);
    border-color: #a855f7;
    background: linear-gradient(145deg, #5b21b6 0%, #3730a3 100%);
}

/* Loading States - Dark Theme */
.time-slot-card.loading {
    opacity: 0.6;
    pointer-events: none;
}

.time-slot-card.loading::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 20px;
    height: 20px;
    margin: -10px 0 0 -10px;
    border: 2px solid #374151;
    border-top: 2px solid #06b6d4;
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* Mobile Responsiveness - Dark Theme */
@media (max-width: 640px) {
    .time-slot-card {
        padding: 1rem;
    }
    
    .slot-time {
        font-size: 1rem;
    }
    
    .slot-price .amount {
        font-size: 1.125rem;
    }
    
    .tab-button {
        padding: 0.625rem 1rem;
        font-size: 0.8125rem;
    }
}

@media (max-width: 768px) {
    .time-slots-container {
        grid-template-columns: 1fr;
    }
    
    .slot-tabs {
        gap: 0.375rem;
    }
    
    .tab-button {
        flex: 1;
        justify-content: center;
        min-width: auto;
    }
}

/* Dark Theme Support */
.info-card {
    background: linear-gradient(145deg, #1f2937 0%, #111827 100%);
    border-color: #374151;
    color: #f3f4f6;
}

/* Membership Pass Card Styling - Enhanced Dark */
.membership-pass-card {
    background: linear-gradient(145deg, #4c1d95 0%, #312e81 100%);
    border: 1px solid #6d28d9;
    border-radius: 16px;
    padding: 1.5rem;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
    box-shadow: 0 4px 12px rgba(109, 40, 217, 0.3);
    color: #f3f4f6;
}

.membership-pass-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(90deg, #7c3aed, #a855f7);
    opacity: 1;
}

.membership-pass-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 12px 32px rgba(109, 40, 217, 0.4);
    border-color: #7c3aed;
}

.pass-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
}

.pass-name {
    font-weight: 700;
    font-size: 1.125rem;
    color: #ffffff;
}

.pass-type {
    padding: 0.25rem 0.75rem;
    border-radius: 12px;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
}

.badge-weekly {
    background: #1e40af;
    color: #bfdbfe;
}

.badge-monthly {
    background: #166534;
    color: #bbf7d0;
}

.badge-custom {
    background: #d97706;
    color: #fed7aa;
}

.pass-duration, .pass-access {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: #d1d5db;
    font-size: 0.875rem;
    margin: 0.75rem 0;
}

.pass-price {
    margin: 1rem 0;
}

.pass-price .amount {
    font-size: 1.5rem;
    font-weight: 800;
    color: #10b981;
}

.price-per-day {
    font-size: 0.875rem;
    color: #9ca3af;
    margin-top: 0.25rem;
}

.pass-description {
    color: #d1d5db;
    font-size: 0.875rem;
    margin: 0.75rem 0;
    line-height: 1.5;
}

.pass-features {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    margin: 0.75rem 0;
}

.feature-tag {
    background: #6366f1;
    color: #ffffff;
    padding: 0.25rem 0.75rem;
    border-radius: 12px;
    font-size: 0.75rem;
    font-weight: 500;
}

.peak-access {
    background: #f59e0b;
    color: #ffffff;
    padding: 0.125rem 0.5rem;
    border-radius: 8px;
    font-size: 0.75rem;
    font-weight: 600;
    margin-left: 0.5rem;
}

/* Amenity Tab Styling */
.amenity-tabs {
    display: flex;
    gap: 0.5rem;
    margin-bottom: 1.5rem;
    flex-wrap: wrap;
}

.amenity-content {
    display: none;
}

.amenity-content.active {
    display: block;
}

/* Responsive Grid Improvements */
@media (max-width: 475px) {
    .grid.grid-cols-1.sm\\:grid-cols-2.lg\\:grid-cols-3.xl\\:grid-cols-4 {
        grid-template-columns: 1fr;
        gap: 1rem;
    }
}

@media (min-width: 476px) and (max-width: 767px) {
    .grid.grid-cols-1.sm\\:grid-cols-2.lg\\:grid-cols-3.xl\\:grid-cols-4 {
        grid-template-columns: repeat(2, 1fr);
        gap: 1rem;
    }
}

@media (min-width: 768px) and (max-width: 1023px) {
    .grid.grid-cols-1.sm\\:grid-cols-2.lg\\:grid-cols-3.xl\\:grid-cols-4 {
        grid-template-columns: repeat(3, 1fr);
        gap: 1.25rem;
    }
}

@media (min-width: 1024px) {
    .grid.grid-cols-1.sm\\:grid-cols-2.lg\\:grid-cols-3.xl\\:grid-cols-4 {
        grid-template-columns: repeat(4, 1fr);
        gap: 1.5rem;
    }
}

/* Enhanced Slot Content */
.slot-content {
    display: none;
}

.slot-content.active {
    display: block;
}

/* Loading States */
.time-slot-card.loading {
    opacity: 0.6;
    pointer-events: none;
}

.time-slot-card.loading::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 20px;
    height: 20px;
    margin: -10px 0 0 -10px;
    border: 2px solid #e5e7eb;
    border-top: 2px solid #4f46e5;
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

.slot-content, .amenity-content {
    display: none;
}

.slot-content.active, .amenity-content.active {
    display: block;
}

/* Membership Pass Cards */
.membership-pass-card {
    background: linear-gradient(145deg, #065f46 0%, #064e3b 100%);
    border: 1px solid #10b981;
    border-radius: 12px;
    padding: 1.25rem;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.membership-pass-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(16, 185, 129, 0.3);
    border-color: #34d399;
}

.pass-header {
    display: flex;
    justify-content: between;
    align-items: center;
    margin-bottom: 0.75rem;
    flex-wrap: wrap;
    gap: 0.5rem;
}

.pass-name {
    color: #d1fae5;
    font-size: 1.125rem;
    font-weight: 700;
    flex: 1;
}

.pass-type {
    padding: 0.25rem 0.5rem;
    border-radius: 0.375rem;
    font-size: 0.75rem;
    font-weight: 600;
}

.pass-duration {
    color: #a7f3d0;
    font-size: 1rem;
    font-weight: 600;
    margin: 0.5rem 0;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.pass-price {
    color: #6ee7b7;
    font-size: 1.125rem;
    font-weight: 700;
    margin: 0.75rem 0;
}

.price-per-day {
    color: #a7f3d0;
    font-size: 0.875rem;
    font-weight: 500;
    margin-top: 0.25rem;
}

.pass-description {
    color: #d1fae5;
    font-size: 0.875rem;
    line-height: 1.5;
    margin: 0.75rem 0;
}

.pass-features {
    display: flex;
    flex-wrap: wrap;
    gap: 0.375rem;
    margin: 0.75rem 0;
}

.pass-access {
    color: #34d399;
    font-size: 0.875rem;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-top: 0.75rem;
}

.peak-access {
    background: rgba(245, 158, 11, 0.2);
    color: #fbbf24;
    padding: 0.125rem 0.375rem;
    border-radius: 0.25rem;
    font-size: 0.75rem;
    margin-left: 0.5rem;
}

.badge-weekly {
    background: rgba(34, 197, 94, 0.2);
    color: #4ade80;
}

.badge-monthly {
    background: rgba(168, 85, 247, 0.2);
    color: #c084fc;
}

.badge-custom {
    background: rgba(245, 158, 11, 0.2);
    color: #fbbf24;
}

.slot-day {
    font-weight: 600;
    color: #e2e8f0;
    font-size: 0.875rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.slot-time {
    color: #60a5fa;
    font-size: 1.125rem;
    font-weight: 700;
    margin: 0.75rem 0;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.slot-price {
    color: #34d399;
    font-size: 1rem;
    font-weight: 600;
    margin: 0.5rem 0;
}

.slot-price .currency {
    font-size: 0.875rem;
    opacity: 0.8;
}

.slot-capacity {
    color: #a78bfa;
    font-size: 0.875rem;
    display: flex;
    align-items: center;
    gap: 0.375rem;
    margin: 0.5rem 0;
}

.slot-description {
    color: #cbd5e1;
    font-size: 0.875rem;
    margin-top: 0.75rem;
    padding-top: 0.75rem;
    border-top: 1px solid #374151;
}

.slot-features {
    display: flex;
    flex-wrap: wrap;
    gap: 0.375rem;
    margin-top: 0.75rem;
}

.feature-tag {
    background: rgba(79, 70, 229, 0.2);
    color: #a5b4fc;
    padding: 0.25rem 0.5rem;
    border-radius: 0.375rem;
    font-size: 0.75rem;
    font-weight: 500;
}

.badge-regular {
    background: rgba(34, 197, 94, 0.2);
    color: #4ade80;
    padding: 0.25rem 0.5rem;
    border-radius: 0.375rem;
    font-size: 0.75rem;
    font-weight: 600;
}

.badge-premium {
    background: rgba(245, 158, 11, 0.2);
    color: #fbbf24;
    padding: 0.25rem 0.5rem;
    border-radius: 0.375rem;
    font-size: 0.75rem;
    font-weight: 600;
}

.badge-vip {
    background: rgba(168, 85, 247, 0.2);
    color: #c084fc;
    padding: 0.25rem 0.5rem;
    border-radius: 0.375rem;
    font-size: 0.75rem;
    font-weight: 600;
}

.slot-status.available {
    background: rgba(34, 197, 94, 0.2);
    color: #4ade80;
    padding: 0.25rem 0.5rem;
    border-radius: 0.375rem;
    font-size: 0.75rem;
    font-weight: 600;
}

.slot-status.unavailable {
    background: rgba(239, 68, 68, 0.2);
    color: #f87171;
    padding: 0.25rem 0.5rem;
    border-radius: 0.375rem;
    font-size: 0.75rem;
    font-weight: 600;
}

/* Dynamic Amenities Styling */
.amenity-card {
    background: linear-gradient(145deg, #2a2a3e 0%, #1e1e30 100%);
    border: 1px solid #3a3a5e;
    border-radius: 12px;
    padding: 1.25rem;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.amenity-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
    border-color: #10b981;
}

.amenity-card.free {
    border-left: 4px solid #10b981;
}

.amenity-card.paid {
    border-left: 4px solid #f59e0b;
}

.amenity-card.legacy {
    border-left: 4px solid #6366f1;
}

.amenity-header {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    margin-bottom: 0.75rem;
    flex-wrap: wrap;
}

.amenity-icon {
    color: #60a5fa;
    font-size: 1.25rem;
}

.amenity-name {
    color: #e2e8f0;
    font-size: 1rem;
    font-weight: 600;
    flex: 1;
    min-width: 0;
}

.amenity-type-badge {
    padding: 0.25rem 0.5rem;
    border-radius: 0.375rem;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.badge-free {
    background: rgba(16, 185, 129, 0.2);
    color: #34d399;
}

.badge-paid {
    background: rgba(245, 158, 11, 0.2);
    color: #fbbf24;
}

.amenity-description {
    color: #cbd5e1;
    font-size: 0.875rem;
    line-height: 1.5;
    margin-bottom: 0.75rem;
}

.amenity-price {
    color: #fbbf24;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.no-slots-message, .no-amenities-message {
    background: linear-gradient(145deg, #1e293b 0%, #0f172a 100%);
    border: 1px solid #334155;
    border-radius: 12px;
    padding: 2rem;
}

.free-amenities-summary {
    margin-top: 1.5rem;
}

.free-amenities-summary .bg-green-50 {
    background: rgba(16, 185, 129, 0.1) !important;
    border-color: rgba(16, 185, 129, 0.3) !important;
}

.free-amenities-summary .text-green-800 {
    color: #34d399 !important;
}

.free-amenities-summary .text-green-700 {
    color: #6ee7b7 !important;
}

.free-amenities-summary .text-green-600 {
    color: #10b981 !important;
}

/* Responsive Design */
@media (max-width: 768px) {
    .time-slot-card, .amenity-card {
        padding: 1rem;
    }
    
    .amenity-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 0.5rem;
    }
    
    .amenity-type-badge {
        align-self: flex-end;
    }
}

/* Rating Stars */
.rating-stars {
    font-size: 1.2rem;
    margin-right: 0.5rem;
}

/* Loading State */
.map-loading {
    background: linear-gradient(145deg, #2a2a3e 0%, #1e1e30 100%);
    border-radius: 12px;
}

/* Enhanced Time Slots Section */
#time-slots-section {
    background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #334155 100%);
    border: 2px solid #475569;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5), 0 4px 20px rgba(14, 165, 233, 0.1);
    position: relative;
    overflow: hidden;
}

#time-slots-section::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(90deg, #0ea5e9, #06b6d4, #8b5cf6);
}

/* Enhanced Tab Styling */
.slot-tabs {
    display: flex;
    gap: 8px;
    margin-bottom: 24px;
    overflow-x: auto;
    padding: 4px;
    background: rgba(15, 23, 42, 0.5);
    border-radius: 16px;
    backdrop-filter: blur(10px);
}

.tab-button {
    background: rgba(30, 41, 59, 0.8);
    color: #94a3b8;
    border: 2px solid #475569;
    padding: 12px 20px;
    border-radius: 12px;
    cursor: pointer;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    font-weight: 600;
    font-size: 14px;
    white-space: nowrap;
    position: relative;
    overflow: hidden;
    min-width: 120px;
    text-align: center;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
}

.tab-button::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
    transition: left 0.5s;
}

.tab-button:hover::before {
    left: 100%;
}

.tab-button:hover {
    background: rgba(51, 65, 85, 0.9);
    border-color: #64748b;
    color: #e2e8f0;
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
}

.tab-button.active {
    background: linear-gradient(135deg, #0ea5e9 0%, #0284c7 50%, #0369a1 100%);
    color: white;
    border-color: #0ea5e9;
    box-shadow: 0 8px 25px rgba(14, 165, 233, 0.4);
    transform: translateY(-1px);
}

/* Enhanced Slot Grid with Consistent Sizing */
#today-slots-grid,
#custom-slots-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 20px;
    margin-top: 20px;
    align-items: stretch; /* Ensure all items stretch to same height */
}

@media (min-width: 640px) {
    #today-slots-grid,
    #custom-slots-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 18px;
    }
}

@media (min-width: 1024px) {
    #today-slots-grid,
    #custom-slots-grid {
        grid-template-columns: repeat(3, 1fr);
        gap: 20px;
    }
}

@media (min-width: 1280px) {
    #today-slots-grid,
    #custom-slots-grid {
        grid-template-columns: repeat(4, 1fr);
        gap: 22px;
    }
}

@media (min-width: 1536px) {
    #today-slots-grid,
    #custom-slots-grid {
        grid-template-columns: repeat(5, 1fr);
    }
}

/* Enhanced Slot Cards with Consistent Sizing */
.slot-card,
.membership-pass-card,
.time-slot-card,
.custom-slot-card {
    background: linear-gradient(135deg, #1e293b 0%, #334155 50%, #475569 100%);
    border: 2px solid #64748b;
    border-radius: 16px;
    padding: 20px;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
    cursor: pointer;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    min-height: 280px; /* Consistent minimum height */
    max-height: 320px; /* Consistent maximum height */
    height: auto;
}

.slot-card::before,
.membership-pass-card::before,
.time-slot-card::before,
.custom-slot-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(90deg, #0ea5e9, #06b6d4);
    opacity: 0;
    transition: opacity 0.3s ease;
}

.slot-card::after,
.membership-pass-card::after,
.time-slot-card::after,
.custom-slot-card::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(135deg, rgba(14, 165, 233, 0.05), rgba(139, 92, 246, 0.05));
    opacity: 0;
    transition: opacity 0.3s ease;
    pointer-events: none;
}

.slot-card:hover,
.membership-pass-card:hover,
.time-slot-card:hover,
.custom-slot-card:hover {
    transform: translateY(-4px) scale(1.02);
    box-shadow: 0 16px 40px rgba(0, 0, 0, 0.4), 0 8px 20px rgba(14, 165, 233, 0.2);
    border-color: #0ea5e9;
}

.slot-card:hover::before,
.slot-card:hover::after,
.membership-pass-card:hover::before,
.membership-pass-card:hover::after,
.time-slot-card:hover::before,
.time-slot-card:hover::after,
.custom-slot-card:hover::before,
.custom-slot-card:hover::after {
    opacity: 1;
}

/* Slot Content Container for Better Layout */
.slot-content-top {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.slot-content-bottom {
    margin-top: auto;
    padding-top: 12px;
}

/* Day and Status Row */
.slot-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 12px;
    min-height: 24px;
}

.slot-day {
    color: #94a3b8;
    font-size: 11px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 1px;
    background: rgba(148, 163, 184, 0.15);
    padding: 3px 8px;
    border-radius: 6px;
    display: inline-block;
    white-space: nowrap;
}

.slot-status,
.available-badge {
    background: linear-gradient(135deg, #10b981, #059669);
    color: white !important;
    padding: 4px 8px;
    border-radius: 6px;
    font-size: 10px !important;
    font-weight: 700 !important;
    text-align: center;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    box-shadow: 0 2px 8px rgba(16, 185, 129, 0.3);
    border: 1px solid rgba(16, 185, 129, 0.3);
    text-shadow: none;
    white-space: nowrap;
}

.slot-status.unavailable {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    box-shadow: 0 2px 8px rgba(239, 68, 68, 0.3);
    border-color: rgba(239, 68, 68, 0.3);
}

/* Time Display */
.slot-time,
.time-display {
    color: #0ea5e9 !important;
    font-size: 16px !important;
    font-weight: 800 !important;
    margin-bottom: 12px;
    display: flex;
    align-items: center;
    gap: 6px;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
    line-height: 1.2;
    min-height: 20px;
}

.slot-time .fas,
.time-display .fas {
    color: #06b6d4;
    font-size: 12px;
    width: 12px;
    text-align: center;
}

/* Price Display */
.slot-price,
.pass-price .amount {
    color: #10b981 !important;
    font-size: 18px !important;
    font-weight: 800 !important;
    margin-bottom: 12px;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
    display: flex;
    align-items: center;
    gap: 4px;
    min-height: 22px;
}

/* Slot Details */
.slot-details {
    display: flex;
    flex-direction: column;
    gap: 6px;
    margin-bottom: 12px;
    flex: 1;
}

.slot-detail {
    color: #e2e8f0 !important;
    font-size: 12px !important;
    display: flex;
    align-items: center;
    gap: 6px;
    font-weight: 600 !important;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
    min-height: 16px;
}

.slot-detail .fas {
    color: #64748b;
    width: 12px;
    text-align: center;
    font-size: 10px;
}

/* Custom Slot Card Enhanced with Consistent Sizing */
.custom-slot-card {
    background: linear-gradient(135deg, #4c1d95 0%, #6b21a8 50%, #7c3aed 100%);
    border: 2px solid #8b5cf6;
    min-height: 280px;
    max-height: 320px;
}

.custom-slot-card::before {
    background: linear-gradient(90deg, #fbbf24, #f59e0b);
}

.custom-slot-card:hover {
    border-color: #a855f7;
}

.custom-slot-card .slot-time,
.custom-slot-card .time-display {
    color: #c4b5fd !important;
}

.custom-slot-card .slot-price {
    color: #fbbf24 !important;
}

.custom-slot-card .slot-detail {
    color: #e9d5ff !important;
}

/* Slot Content Styling */
.slot-time {
    color: #0ea5e9;
    font-size: 20px;
    font-weight: 800;
    margin-bottom: 16px;
    display: flex;
    align-items: center;
    gap: 8px;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
}

.slot-time::before {
    content: '';
    font-size: 16px;
}

.slot-price,
.pass-price .amount {
    color: #10b981;
    font-size: 22px;
    font-weight: 800;
    margin-bottom: 12px;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
}

.slot-details {
    display: flex;
    flex-direction: column;
    gap: 8px;
    margin-bottom: 18px;
}

.slot-detail {
    color: #cbd5e1;
    font-size: 14px;
    display: flex;
    align-items: center;
    gap: 8px;
    font-weight: 500;
}

.slot-detail::before {
    content: '';
    font-size: 12px;
}

.slot-detail:last-child::before {
    content: '';
}

.slot-status,
.available-badge {
    background: linear-gradient(135deg, #10b981, #059669);
    color: white;
    padding: 10px 16px;
    border-radius: 10px;
    font-size: 13px;
    font-weight: 700;
    text-align: center;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
    border: 2px solid rgba(16, 185, 129, 0.3);
}

/* Premium Slot Styling */
.premium-slot {
    background: linear-gradient(135deg, #4c1d95 0%, #6b21a8 50%, #7c3aed 100%);
    border-color: #8b5cf6;
}

.premium-slot .slot-time {
    color: #c4b5fd;
}

.premium-slot .slot-price {
    color: #fbbf24;
}

.premium-badge {
    background: linear-gradient(135deg, #fbbf24, #f59e0b);
    color: #1f2937;
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 11px;
    font-weight: 800;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    position: absolute;
    top: 12px;
    right: 12px;
    box-shadow: 0 2px 8px rgba(251, 191, 36, 0.3);
}

/* Membership Pass Enhanced Styling */
.pass-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 16px;
    flex-wrap: wrap;
    gap: 8px;
}

.pass-name {
    color: #f8fafc;
    font-size: 18px;
    font-weight: 700;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
}

.pass-type {
    padding: 4px 12px;
    border-radius: 12px;
    font-size: 11px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.badge-weekly {
    background: linear-gradient(135deg, #059669, #047857);
    color: white;
}

.badge-monthly {
    background: linear-gradient(135deg, #0ea5e9, #0284c7);
    color: white;
}

.badge-yearly {
    background: linear-gradient(135deg, #7c3aed, #6b21a8);
    color: white;
}

.pass-duration {
    color: #94a3b8;
    font-size: 14px;
    margin-bottom: 12px;
    display: flex;
    align-items: center;
    gap: 8px;
}

.pass-price {
    margin-bottom: 16px;
}

.pass-price .currency {
    color: #64748b;
    font-size: 14px;
    font-weight: 500;
    margin-right: 4px;
}

.pass-price .amount {
    color: #10b981;
    font-size: 24px;
    font-weight: 800;
}

.price-per-day {
    color: #64748b;
    font-size: 12px;
    margin-top: 4px;
}

.pass-description {
    color: #cbd5e1;
    font-size: 14px;
    line-height: 1.5;
    margin-bottom: 16px;
}

.pass-features {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    margin-bottom: 16px;
}

.feature-tag {
    background: linear-gradient(135deg, #8b5cf6, #7c3aed);
    color: white;
    padding: 4px 8px;
    border-radius: 8px;
    font-size: 11px;
    font-weight: 600;
}

.pass-access {
    color: #94a3b8;
    font-size: 13px;
    border-top: 1px solid #374151;
    padding-top: 12px;
}

/* No Slots Message Enhancement */
.no-slots-message,
#today-no-slots > div,
#custom-no-slots > div {
    background: linear-gradient(135deg, rgba(15, 23, 42, 0.8), rgba(30, 41, 59, 0.6));
    border: 2px dashed #475569;
    border-radius: 16px;
    padding: 48px 24px;
    text-align: center;
    margin: 20px 0;
}

.no-slots-message h3,
#today-no-slots h4,
#custom-no-slots h4 {
    color: #94a3b8;
    margin-bottom: 12px;
    font-size: 20px;
    font-weight: 600;
}

.no-slots-message p,
#today-no-slots p,
#custom-no-slots p {
    color: #64748b;
    font-size: 15px;
    line-height: 1.6;
}

/* Booking Information Enhancement */
.booking-info {
    background: linear-gradient(135deg, rgba(14, 165, 233, 0.15), rgba(139, 92, 246, 0.1));
    border: 2px solid rgba(14, 165, 233, 0.3);
    border-radius: 16px;
    padding: 20px;
    margin-top: 28px;
    position: relative;
    overflow: hidden;
}

.booking-info::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(90deg, #0ea5e9, #8b5cf6);
}

.booking-info h4 {
    color: #0ea5e9;
    margin-bottom: 12px;
    font-size: 18px;
    font-weight: 700;
    display: flex;
    align-items: center;
    gap: 8px;
}

.booking-info h4::before {
    content: '';
    font-size: 16px;
}

.booking-info p {
    color: #cbd5e1;
    font-size: 15px;
    line-height: 1.6;
    font-weight: 500;
}

/* Mobile Responsiveness */
@media (max-width: 640px) {
    #time-slots-section {
        padding: 20px;
        margin: 20px 10px;
        border-radius: 16px;
    }

    .slot-tabs {
        gap: 6px;
        margin-bottom: 20px;
        padding: 2px;
    }

    .tab-button {
        padding: 10px 16px;
        font-size: 13px;
        min-width: 100px;
    }

    #today-slots-grid,
    #custom-slots-grid {
        gap: 16px;
        grid-template-columns: 1fr;
    }

    .slot-card,
    .membership-pass-card {
        padding: 20px;
    }

    .slot-time {
        font-size: 18px;
    }

    .slot-price,
    .pass-price .amount {
        font-size: 20px;
    }

    .pass-name {
        font-size: 16px;
    }

    .booking-info {
        padding: 16px;
        margin-top: 20px;
    }
}
</style>

<div class="container mx-auto px-4 py-8"
     style="background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%); min-height: 100vh;">
    <div class="max-w-7xl mx-auto">
        
        <!-- Playground Header -->
        <div class="info-card">
            <div class="grid grid-cols-1 gap-8" style="grid-template-columns: 1fr; /* Mobile: single column */">
                <div class="image-section" style="grid-column: 1; /* Mobile: full width */">
                    
                    <!-- Add responsive grid for larger screens -->
                    <style>
                        @media (min-width: 1024px) {
                            .info-card .grid {
                                grid-template-columns: 2fr 1fr !important; /* Desktop: 2/3 image, 1/3 info */
                                gap: 2rem !important;
                            }
                            .image-section {
                                grid-column: 1 !important;
                            }
                            .info-section {
                                grid-column: 2 !important;
                            }
                        }
                        
                        @media (max-width: 1023px) {
                            .cover-slider {
                                height: 350px !important; /* Landscape height for mobile/tablet */
                            }
                        }
                        
                        @media (min-width: 1280px) {
                            .cover-slider {
                                height: 550px !important; /* Landscape height for very large screens */
                            }
                        }
                    </style>>
                    <!-- Auto Slider for Cover Images -->
                    {% if playground.images.all %}
                    <div class="cover-slider">
                        <div class="slider-container">
                            {% for image in playground.images.all %}
                            <div class="slide {% if forloop.first %}active{% endif %} cursor-pointer" onclick="openImageModal('{{ image.image.url }}', '{{ image.caption|default:playground.name }}')">
                                <img src="{{ image.image.url }}" alt="{{ image.caption|default:playground.name }}" onerror="this.onerror=null; this.src='/static/images/placeholder-playground.png'; this.classList.add('placeholder-img');">
                                <div class="absolute inset-0 bg-black bg-opacity-0 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                                    <div class="opacity-0 hover:opacity-100 transition-opacity duration-300">
                                        <svg class="w-16 h-16 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v3m0 0v3m0-3h3m-3 0H7"></path>
                                        </svg>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                        
                        <!-- Navigation buttons -->
                        {% if playground.images.all|length > 1 %}
                        <button class="slider-nav prev" onclick="changeSlide(-1)"></button>
                        <button class="slider-nav next" onclick="changeSlide(1)"></button>
                        
                        <!-- Dots indicator -->
                        <div class="slider-controls">
                            {% for image in playground.images.all %}
                            <span class="slider-dot {% if forloop.first %}active{% endif %}" onclick="currentSlide({{ forloop.counter }})"></span>
                            {% endfor %}
                        </div>
                        {% endif %}
                    </div>
                    {% elif playground.main_image %}
                    <div class="cover-slider">
                        <div class="slider-container">
                            <div class="slide active">
                                <img src="{{ playground.main_image.url }}" alt="{{ playground.name }}" onerror="this.onerror=null; this.style.display='none'; this.parentElement.innerHTML='<div class=\\'w-full h-full bg-gradient-to-br from-slate-700 via-slate-600 to-slate-700 flex items-center justify-center\\'><span class=\\'text-slate-400\\'>Image not available</span></div>';">
                            </div>
                        </div>
                    </div>
                    {% else %}
                    <!-- Default placeholder -->
                    <div class="cover-slider">
                        <div class="w-full h-full bg-gradient-to-br from-gray-100 to-gray-200 rounded-lg flex flex-col items-center justify-center">
                            <svg class="w-16 h-16 text-gray-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                            </svg>
                            <span class="text-gray-500 text-lg font-medium">No images available</span>
                            <span class="text-gray-400 text-sm mt-2">Contact owner for more photos</span>
                        </div>
                    </div>
                    {% endif %}
                </div>
                
                <div class="info-section">
                    <div class="flex items-center justify-between mb-4">
                        <h1 class="text-4xl font-bold text-gradient">{{ playground.name }}</h1>
                        <span class="status-badge status-{{ playground.status }}">{{ playground.get_status_display }}</span>
                    </div>
                    
                    <div class="flex items-center mb-4">
                        <div class="rating-stars">
                            {% for i in "12345" %}
                                {% if forloop.counter <= playground.rating %}
                                    
                                {% else %}
                                    
                                {% endif %}
                            {% endfor %}
                        </div>
                        <span class="text-gray-200 font-medium ml-2">{{ playground.rating }}/5.0 ({{ playground.review_count }} reviews)</span>
                    </div>
                    
                    <p class="text-gray-100 mb-6 leading-relaxed font-medium">{{ playground.description }}</p>
                    
                    <div class="grid grid-cols-2 gap-4 mb-6">
                        <div class="text-center p-4 bg-gradient-to-br from-gray-800 to-gray-900 rounded-lg border border-gray-600 shadow-lg">
                            <div class="text-2xl font-bold text-cyan-400" id="price-per-hour">
                                <span id="currency-symbol"></span><span id="price-value">{{ playground.price_per_hour }}</span>
                            </div>
                            <div class="text-sm text-gray-300 font-medium">Per Hour</div>
                        </div>
                        <div class="text-center p-4 bg-gradient-to-br from-gray-800 to-gray-900 rounded-lg border border-gray-600 shadow-lg">
                            <div class="text-2xl font-bold text-cyan-400">{{ playground.capacity }}</div>
                            <div class="text-sm text-gray-300 font-medium">Max Players</div>
                        </div>
                    </div>
                    
                    <div class="space-y-3">
                        <a href="{% url 'bookings:checkout' playground.id %}" class="btn btn-primary btn-lg w-full text-center">Book Now</a>
                        {% if user.is_authenticated %}
                        <button onclick="contactOwner()" class="btn btn-secondary w-full text-center flex items-center justify-center gap-2">
                            <i class="fas fa-comments"></i>
                            <span>Contact Owner</span>
                        </button>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Detailed Information -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            
            <!-- Basic Information -->
            <div class="info-card">
                <h2 class="text-2xl font-bold mb-6 text-primary"> Basic Information</h2>
                <div class="space-y-4">
                    <div class="detail-item">
                        <span class="detail-label"> Playground Type:</span>
                        <span class="detail-value" id="playground-type-display">Loading...</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label"> Capacity:</span>
                        <span class="detail-value">{{ playground.capacity }} people</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label"> Verification:</span>
                        <span class="detail-value">
                            {% if playground.is_verified %}
                                <span class="text-green-400 font-semibold"> Verified</span>
                            {% else %}
                                <span class="text-yellow-400"> Pending Verification</span>
                            {% endif %}
                        </span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label"> Advance Booking:</span>
                        <span class="detail-value">{{ playground.advance_booking_days }} days ahead</span>
                    </div>
                </div>
                
                <!-- Moved Items Section - Fill the empty space -->
                <div class="space-y-4">
                    <!-- Sport Types Row -->
                    <div class="detail-item">
                        <span class="detail-label"> Sport Types:</span>
                        <span class="detail-value">
                            {% for sport in playground.sport_types.all %}
                                <span class="inline-block bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full mr-1 mb-1">{{ sport.name }}</span>
                            {% empty %}
                                <span class="text-gray-500">Not specified</span>
                            {% endfor %}
                        </span>
                    </div>
                    
                    <!-- Status and Featured Row -->
                    <div class="detail-item">
                        <span class="detail-label"> Status:</span>
                        <span class="detail-value">
                            {% if playground.status == 'active' %}
                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                     Active
                                </span>
                            {% elif playground.status == 'pending' %}
                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">
                                     Pending Approval
                                </span>
                            {% elif playground.status == 'maintenance' %}
                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-orange-100 text-orange-800">
                                     Under Maintenance
                                </span>
                            {% else %}
                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800">
                                    {{ playground.get_status_display }}
                                </span>
                            {% endif %}
                        </span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label"> Featured:</span>
                        <span class="detail-value">
                            {% if playground.is_featured %}
                                <span class="text-yellow-500 font-semibold"> Featured Playground</span>
                            {% else %}
                                <span class="text-gray-500">Regular Listing</span>
                            {% endif %}
                        </span>
                    </div>
                    
                    <!-- Total Bookings Row -->
                    <div class="detail-item">
                        <span class="detail-label"> Total Bookings:</span>
                        <span class="detail-value">
                            <span id="total-bookings-count" class="text-blue-600 font-semibold">Loading...</span>
                        </span>
                    </div>
                    
                    <!-- Booking Features Row -->
                    <div class="detail-item">
                        <span class="detail-label"> Booking Features:</span>
                        <span class="detail-value">
                            <div class="flex flex-wrap gap-1">
                                {% if playground.instant_booking %}
                                    <span class="inline-block bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full"> Instant Booking</span>
                                {% endif %}
                                {% if playground.auto_approval %}
                                    <span class="inline-block bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full"> Auto Approval</span>
                                {% endif %}
                                {% if playground.live_availability %}
                                    <span class="inline-block bg-purple-100 text-purple-800 text-xs px-2 py-1 rounded-full"> Live Availability</span>
                                {% endif %}
                                {% if playground.enable_chat %}
                                    <span class="inline-block bg-indigo-100 text-indigo-800 text-xs px-2 py-1 rounded-full"> Chat Enabled</span>
                                {% endif %}
                            </div>
                        </span>
                    </div>
                    
                    <!-- Description Row -->
                    <div class="detail-item">
                        <span class="detail-label"> Description:</span>
                        <span class="detail-value">
                            <p class="text-sm text-gray-700 leading-relaxed">{{ playground.description|truncatewords:25 }}</p>
                        </span>
                    </div>
                </div>
            </div>

            <!-- Location & Contact -->
            <div class="info-card">
                <h2 class="text-2xl font-bold mb-6 text-primary"> Location & Contact</h2>
                
                <!-- Location Details -->
                <div class="space-y-3 mb-6">
                    <div class="detail-item">
                        <span class="detail-label"> Country:</span>
                        <span class="detail-value">{{ playground.city.state.country.name|title }}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label"> State/Region:</span>
                        <span class="detail-value">{{ playground.city.state.name|title }}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label"> City:</span>
                        <span class="detail-value">{{ playground.city.name|title }}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label"> Address:</span>
                        <span class="detail-value">{{ playground.address }}</span>
                    </div>
                    {% if playground.phone_number %}
                    <div class="detail-item">
                        <span class="detail-label"> Phone:</span>
                        <span class="detail-value">
                            <a href="tel:{{ playground.phone_number }}" class="text-blue-600 hover:text-blue-800 hover:underline transition-colors">
                                {{ playground.phone_number }}
                            </a>
                        </span>
                    </div>
                    {% endif %}
                    {% if playground.whatsapp_number %}
                    <div class="detail-item">
                        <span class="detail-label"> WhatsApp:</span>
                        <span class="detail-value">
                            <a href="https://wa.me/{{ playground.whatsapp_number }}" target="_blank" class="text-green-600 hover:text-green-800 hover:underline transition-colors">
                                {{ playground.whatsapp_number }}
                            </a>
                        </span>
                    </div>
                    {% endif %}
                </div>
                
                <!-- Interactive Map Section with Dark Theme -->
                {% if playground.latitude and playground.longitude %}
                <div class="bg-gradient-to-r from-gray-800 to-gray-900 rounded-xl p-6 border border-gray-700">
                    <h3 class="text-lg font-semibold mb-4 text-white flex items-center">
                        <svg class="w-5 h-5 mr-2 text-blue-400" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd"></path>
                        </svg>
                        Interactive Location Map
                    </h3>
                    
                    <!-- Map Container -->
                    <div class="map-container relative" id="map-container">
                        {% if playground.google_maps_embed_url %}
                        <iframe 
                            id="google-map"
                            class="map-iframe w-full h-80 rounded-lg shadow-md filter brightness-75 contrast-125"
                            src="{{ playground.google_maps_embed_url }}"
                            loading="lazy"
                            allowfullscreen
                            referrerpolicy="no-referrer-when-downgrade">
                        </iframe>
                        {% elif playground.latitude and playground.longitude %}
                        <iframe 
                            id="google-map"
                            class="map-iframe w-full h-80 rounded-lg shadow-md filter brightness-75 contrast-125"
                            src="https://www.google.com/maps/embed/v1/place?key=AIzaSyAoW0TB8i9Gfjfly1EJf8Kr1FFTPuORYnE&q={{ playground.latitude }},{{ playground.longitude }}&zoom=15&maptype=roadmap"
                            loading="lazy"
                            allowfullscreen
                            referrerpolicy="no-referrer-when-downgrade">
                        </iframe>
                        {% else %}
                        <div class="map-placeholder w-full h-80 rounded-lg shadow-md bg-gray-700 flex items-center justify-center">
                            <div class="text-center text-gray-400">
                                <i class="fas fa-map-marker-alt text-4xl mb-3"></i>
                                <p>Map coordinates not available</p>
                            </div>
                        </div>
                        {% endif %}
                    </div>
                    
                    <!-- Map Action Buttons -->
                    <div class="mt-4 flex flex-wrap gap-3">
                        <a href="{% if playground.google_maps_url %}{{ playground.google_maps_url }}{% else %}#{% endif %}" 
                           id="google-maps-link"
                           target="_blank" 
                           class="inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-all duration-300 transform hover:scale-105 shadow-lg hover:shadow-xl">
                            <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd"></path>
                            </svg>
                            Open in Google Maps
                        </a>
                        <button 
                            onclick="getDirections()"
                            class="inline-flex items-center px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-all duration-300 transform hover:scale-105 shadow-lg hover:shadow-xl">
                            <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-8.293l-3-3a1 1 0 00-1.414-1.414l-3 3a1 1 0 001.414 1.414L9 8.414V15a1 1 0 102 0V8.414l1.293 1.293a1 1 0 001.414-1.414z" clip-rule="evenodd"></path>
                            </svg>
                            Get Directions
                        </button>
                        <button 
                            onclick="shareLocation()"
                            class="inline-flex items-center px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-all duration-300 transform hover:scale-105 shadow-lg hover:shadow-xl">
                            <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M15 8a3 3 0 10-2.977-2.63l-4.94 2.47a3 3 0 100 4.319l4.94 2.47a3 3 0 10.895-1.789l-4.94-2.47a3.027 3.027 0 000-.74l4.94-2.47C13.456 7.68 14.19 8 15 8z"></path>
                            </svg>
                            Share Location
                        </button>
                    </div>
                    
                    <!-- Location Coordinates -->
                    <div class="mt-4 text-sm text-gray-300 bg-gray-800 rounded-lg p-3 border border-gray-600">
                        <div class="flex items-center justify-between">
                            <span class="font-medium">Coordinates:</span>
                            <span class="font-mono text-xs text-blue-400" id="coordinates-display">{{ playground.latitude }}, {{ playground.longitude }}</span>
                        </div>
                    </div>
                </div>
                {% else %}
                <div class="bg-yellow-50 border border-yellow-200 rounded-xl p-6">
                    <div class="flex items-start">
                        <svg class="w-6 h-6 text-yellow-500 mr-3 mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                        </svg>
                        <div class="flex-1">
                            <h4 class="text-yellow-800 font-semibold mb-2"> Location Not Precisely Mapped</h4>
                            <p class="text-yellow-700 text-sm leading-relaxed">
                                Exact coordinates are not available for this playground. Please contact the owner for detailed location information and directions.
                            </p>
                            <div class="mt-3">
                                <button onclick="requestLocationUpdate()" class="text-yellow-800 hover:text-yellow-900 font-medium text-sm underline">
                                    Request Location Update
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>

                <!-- Enhanced Photo Gallery -->
        <div class="info-card">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-primary flex items-center gap-3">
                    <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                    </svg>
                    Photo Gallery
                </h2>
                {% if playground.images.all %}
                <div class="text-sm bg-gradient-to-r from-blue-600/20 to-purple-600/20 px-4 py-2 rounded-full border border-blue-500/30">
                    <span class="text-blue-400 font-medium">{{ playground.images.all|length }} Photo{{ playground.images.all|length|pluralize }}</span>
                </div>
                {% endif %}
            </div>
            
            {% if playground.images.all %}
            <div class="enhanced-gallery-grid">
                {% for image in playground.images.all %}
                <div class="gallery-item" data-image-index="{{ forloop.counter0 }}">
                    <div class="gallery-image-container">
                        <img src="{{ image.image.url }}" 
                             alt="{{ image.caption|default:playground.name }}" 
                             class="gallery-image"
                             onclick="openImageModal('{{ image.image.url }}', '{{ image.caption|default:playground.name|escapejs }}', {{ forloop.counter0 }})"
                             onerror="this.onerror=null; this.src='/static/images/placeholder-playground.png'; this.classList.add('placeholder-img');">
                        
                        <!-- Hover Overlay -->
                        <div class="gallery-overlay">
                            <div class="gallery-overlay-content">
                                <div class="bg-white/20 backdrop-blur-sm rounded-full p-4 mb-3 mx-auto w-16 h-16 flex items-center justify-center">
                                    <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v3m0 0v3m0-3h3m-3 0H7"></path>
                                    </svg>
                                </div>
                                <p class="text-white font-semibold">View Full Size</p>
                                <p class="text-white/80 text-sm">Click to expand</p>
                            </div>
                        </div>
                        
                        <!-- Featured Badge -->
                        {% if image.is_primary %}
                        <div class="absolute top-4 left-4 z-10">
                            <span class="featured-badge">
                                <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
                                </svg>
                                Featured
                            </span>
                        </div>
                        {% endif %}
                    </div>
                    
                    <!-- Image Info -->
                    {% if image.caption %}
                    <div class="gallery-info">
                        <div class="gallery-caption">{{ image.caption }}</div>
                        <div class="gallery-meta">
                            <span>{{ forloop.counter }} of {{ playground.images.all|length }}</span>
                            <span class="text-xs"> {{ image.uploaded_at|date:"M d, Y" }}</span>
                        </div>
                    </div>
                    {% endif %}
                </div>
                {% endfor %}
            </div>
            
            <!-- Enhanced Gallery Actions -->
            <div class="gallery-actions">
                <button class="gallery-action-btn" onclick="showAllImages()">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                    </svg>
                    View All Photos
                </button>
                
                <button class="gallery-action-btn secondary" onclick="startSlideshow()">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.828 14.828a4 4 0 01-5.656 0M9 10h1m4 0h1m-6 4h.01M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16l3.5-2 3.5 2 3.5-2 3.5 2z"></path>
                    </svg>
                    Start Slideshow
                </button>
                
                <button class="gallery-action-btn secondary" onclick="downloadAllImages()">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10"></path>
                    </svg>
                    Download All
                </button>
            </div>
            
            {% else %}
            <!-- Enhanced No Images Placeholder -->
            <div class="no-images-placeholder">
                <svg class="no-images-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                </svg>
                <h3 class="text-2xl font-bold text-gray-300 mb-4">No Photos Available</h3>
                <p class="text-gray-400 mb-6 max-w-md mx-auto leading-relaxed">
                    This playground hasn't uploaded any photos yet. Contact the owner to request photos or visit in person to see the facilities.
                </p>
                <div class="flex justify-center gap-4 flex-wrap">
                    <button class="gallery-action-btn secondary" onclick="contactOwner()">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 4.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                        </svg>
                        Contact Owner
                    </button>
                    <button class="gallery-action-btn secondary" onclick="requestPhotos()">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"></path>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"></path>
                        </svg>
                        Request Photos
                    </button>
                </div>
            </div>
            {% endif %}
        </div>

        <!-- Enhanced Dynamic Time Slots -->
        <div class="info-card bg-gradient-to-br from-gray-900 to-gray-800 border-gray-700" id="time-slots-section">
            <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between mb-6">
                <h2 class="text-2xl font-bold text-white mb-4 lg:mb-0"> Available Time Slots</h2>
                <div class="flex items-center space-x-2 text-sm text-gray-300">
                    <i class="fas fa-calendar-day text-cyan-400"></i>
                    <span id="today-date" class="text-white">Today's Slots</span>
                    <span class="hidden lg:inline text-gray-500"></span>
                    <span id="current-time" class="hidden lg:inline text-cyan-400"></span>
                </div>
            </div>
            
            <!-- Enhanced Slot Types Tabs -->
            <div class="slot-tabs mb-6 overflow-x-auto">
                <div class="flex space-x-2 min-w-max">
                    <button class="tab-button active flex-shrink-0" onclick="showSlotType('today')" id="today-tab">
                        <i class="fas fa-clock"></i> 
                        <span class="hidden sm:inline">Today's Slots</span>
                        <span class="sm:hidden">Today</span>
                    </button>
                    <button class="tab-button flex-shrink-0" onclick="showSlotType('custom')" id="custom-tab">
                        <i class="fas fa-star"></i> 
                        <span class="hidden sm:inline">Premium Slots</span>
                        <span class="sm:hidden">Premium</span>
                    </button>
                    <button class="tab-button flex-shrink-0" onclick="showSlotType('passes')" id="passes-tab">
                        <i class="fas fa-ticket-alt"></i> 
                        <span class="hidden sm:inline">Membership</span>
                        <span class="sm:hidden">Passes</span>
                    </button>
                </div>
            </div>
            
            <!-- Loading Spinner -->
            <div id="slots-loading" class="hidden text-center py-8">
                <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-cyan-400"></div>
                <p class="mt-2 text-gray-300">Loading slots...</p>
            </div>
            
            <div id="time-slots-container">
                
                <!-- Today's Available Slots (Dynamic) -->
                <div id="today-slots" class="slot-content active">
                    <div id="today-slots-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-2 xl:grid-cols-3 2xl:grid-cols-4 gap-6">
                        <!-- Dynamic content will be loaded here -->
                    </div>
                    <div id="today-no-slots" class="hidden">
                        <div class="text-center py-12">
                            <i class="fas fa-clock text-5xl text-gray-500 mb-4"></i>
                            <h4 class="text-xl font-semibold text-gray-300 mb-3">No Slots Available Today</h4>
                            <p class="text-gray-400 mb-6">All slots for today are booked or past the current time.</p>
                            <button onclick="showSlotType('custom')" class="px-6 py-3 bg-gradient-to-r from-cyan-600 to-blue-600 text-white rounded-lg hover:from-cyan-700 hover:to-blue-700 transition-all duration-300 shadow-lg">
                                <i class="fas fa-star mr-2"></i>View Premium Slots
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Custom Premium Slots -->
                <div id="custom-slots" class="slot-content">
                    <div id="custom-slots-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-2 xl:grid-cols-3 gap-6">
                        <!-- Dynamic content will be loaded here -->
                    </div>
                    <div id="custom-no-slots" class="hidden">
                        <div class="text-center py-12">
                            <i class="fas fa-star text-5xl text-gray-500 mb-4"></i>
                            <h4 class="text-xl font-semibold text-gray-300 mb-3">No Premium Slots</h4>
                            <p class="text-gray-400">Premium custom slots haven't been added yet.</p>
                        </div>
                    </div>
                </div>
                
                <!-- Membership Passes -->
                <div id="passes-slots" class="slot-content">
                    {% if playground.duration_passes.all %}
                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                            {% for pass in playground.duration_passes.all %}
                            <div class="membership-pass-card bg-gradient-to-br from-gray-800 to-gray-700 border-gray-600 hover:border-purple-500">
                                <div class="pass-header">
                                    <span class="pass-name text-white">{{ pass.name }}</span>
                                    <span class="pass-type badge-{{ pass.duration_type }}">{{ pass.get_duration_type_display }}</span>
                                </div>
                                <div class="pass-duration text-gray-300">
                                    <i class="fas fa-calendar-alt text-purple-400"></i>
                                    {{ pass.duration_days }} day{% if pass.duration_days != 1 %}s{% endif %}
                                </div>
                                <div class="pass-price">
                                    <span class="currency text-gray-400" data-currency="{{ pass.currency }}">{{ pass.currency }}</span>
                                    <span class="amount text-green-400" data-price="{{ pass.price }}">{{ pass.price }}</span>
                                    <div class="price-per-day text-gray-400" data-per-day-price="{{ pass.price_per_day|floatformat:2 }}">
                                        <span class="per-day-currency">{{ pass.currency }}</span> 
                                        <span class="per-day-amount">{{ pass.price_per_day|floatformat:2 }}</span>/day
                                    </div>
                                </div>
                                {% if pass.description %}
                                <div class="pass-description text-gray-300">
                                    {{ pass.description }}
                                </div>
                                {% endif %}
                                {% if pass.features %}
                                <div class="pass-features">
                                    {% for feature in pass.features %}
                                    <span class="feature-tag bg-purple-600 text-white">{{ feature }}</span>
                                    {% endfor %}
                                </div>
                                {% endif %}
                                <div class="pass-access text-gray-300">
                                    <i class="fas fa-key text-purple-400"></i>
                                    {{ pass.access_pattern|title }} Access
                                    {% if pass.peak_access %}
                                        <span class="peak-access bg-yellow-600 text-white">+ Peak Hours</span>
                                    {% endif %}
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    {% else %}
                        <div class="no-slots-message">
                            <div class="text-center py-8">
                                <i class="fas fa-ticket-alt text-4xl text-gray-500 mb-3"></i>
                                <h4 class="text-lg font-semibold text-gray-300 mb-2">No Membership Passes</h4>
                                <p class="text-gray-400">Duration passes and memberships haven't been created yet.</p>
                            </div>
                        </div>
                    {% endif %}
                </div>
                
                <!-- Info Note -->
                <div class="slot-info-note mt-6">
                    <div class="bg-blue-900 border border-blue-700 rounded-lg p-4">
                        <h4 class="text-lg font-semibold text-blue-200 mb-2">
                            <i class="fas fa-info-circle text-blue-400 mr-2"></i>
                            Booking Information
                        </h4>
                        <p class="text-blue-300">
                            View today's available slots and premium packages. All times are shown in 12-hour format with real-time availability.
                            <span class="font-semibold text-white">Contact owner for immediate booking.</span>
                        </p>
                    </div>
                </div>
            </div>
        </div>
        <!-- Rules & Policies -->
        {% if playground.rules or playground.cancellation_policy or playground.refund_policy %}
        <div class="info-card">
            <h2 class="text-2xl font-bold mb-6 text-primary"> Rules & Policies</h2>
            
            {% if playground.rules %}
            <div class="mb-6">
                <h3 class="text-lg font-semibold mb-3 text-gray-800"> Playground Rules</h3>
                <div class="bg-gray-50 p-4 rounded-lg">
                    <p class="whitespace-pre-line">{{ playground.rules }}</p>
                </div>
            </div>
            {% endif %}
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                {% if playground.cancellation_policy %}
                <div>
                    <h3 class="text-lg font-semibold mb-3 text-gray-800"> Cancellation Policy</h3>
                    <div class="bg-red-50 border border-red-200 p-4 rounded-lg">
                        <p class="whitespace-pre-line text-red-800">{{ playground.cancellation_policy }}</p>
                    </div>
                </div>
                {% endif %}
                
                {% if playground.refund_policy %}
                <div>
                    <h3 class="text-lg font-semibold mb-3 text-gray-800"> Refund Policy</h3>
                    <div class="bg-green-50 border border-green-200 p-4 rounded-lg">
                        <p class="whitespace-pre-line text-green-800">{{ playground.refund_policy }}</p>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
        {% endif %}

        <!-- Dynamic Amenities & Features -->
        <div class="info-card" id="amenities-section">
            <h2 class="text-2xl font-bold mb-6 text-primary"> Amenities & Features</h2>
            
            <!-- Amenities Tabs -->
            <div class="amenity-tabs mb-6">
                <button class="tab-button active" onclick="showAmenityType('free')">
                    <i class="fas fa-gift"></i> Free Amenities
                </button>
                <button class="tab-button" onclick="showAmenityType('paid')">
                    <i class="fas fa-tag"></i> Premium Services
                </button>
            </div>
            
            <div id="amenities-container">
                
                <!-- Free Amenities Section -->
                <div id="free-amenities" class="amenity-content active">
                    {% if playground.amenities or playground.playground_amenities.all %}
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                            
                            {% comment %} Free amenities from Amenity model {% endcomment %}
                            {% for amenity in playground.playground_amenities.all %}
                                {% if amenity.amenity_type == 'free' %}
                                <div class="amenity-card free">
                                    <div class="amenity-header">
                                        {% if amenity.icon %}
                                        <i class="{{ amenity.icon }} amenity-icon"></i>
                                        {% else %}
                                        <i class="fas fa-check-circle amenity-icon"></i>
                                        {% endif %}
                                        <h3 class="amenity-name">{{ amenity.name }}</h3>
                                        <span class="amenity-type-badge badge-free">FREE</span>
                                    </div>
                                    {% if amenity.description %}
                                    <div class="amenity-description">
                                        {{ amenity.description }}
                                    </div>
                                    {% endif %}
                                </div>
                                {% endif %}
                            {% endfor %}
                            
                            {% comment %} Free amenities from JSON field {% endcomment %}
                            {% for amenity in playground.amenities %}
                                {% if amenity.type == 'free' or not amenity.type %}
                                <div class="amenity-card free legacy">
                                    <div class="amenity-header">
                                        {% if amenity.icon %}
                                        <span class="amenity-icon">{{ amenity.icon }}</span>
                                        {% else %}
                                        <i class="fas fa-check-circle amenity-icon"></i>
                                        {% endif %}
                                        <h3 class="amenity-name">
                                            {% if amenity.name %}
                                                {{ amenity.name }}
                                            {% else %}
                                                {{ amenity }}
                                            {% endif %}
                                        </h3>
                                        <span class="amenity-type-badge badge-free">FREE</span>
                                    </div>
                                    {% if amenity.description %}
                                    <div class="amenity-description">
                                        {{ amenity.description }}
                                    </div>
                                    {% endif %}
                                </div>
                                {% endif %}
                            {% endfor %}
                        </div>
                        
                        <!-- Free Amenities Info -->
                        <div class="amenities-info mt-6">
                            <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                                <h4 class="text-lg font-semibold text-green-800 mb-2">
                                    <i class="fas fa-gift text-green-600 mr-2"></i>
                                    Included with Every Booking
                                </h4>
                                <p class="text-green-700">
                                    All free amenities listed above are automatically included with your booking at no additional cost.
                                </p>
                            </div>
                        </div>
                    {% else %}
                        <div class="no-amenities-message">
                            <div class="text-center py-6">
                                <i class="fas fa-gift text-4xl text-gray-400 mb-3"></i>
                                <h4 class="text-lg font-semibold text-gray-600 mb-2">No Free Amenities Listed</h4>
                                <p class="text-gray-500">Free amenities information hasn't been added yet.</p>
                            </div>
                        </div>
                    {% endif %}
                </div>
                
                <!-- Paid Amenities Section -->
                <div id="paid-amenities" class="amenity-content">
                    {% if playground.playground_amenities.all or playground.amenities %}
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                            
                            {% comment %} Paid amenities from Amenity model {% endcomment %}
                            {% for amenity in playground.playground_amenities.all %}
                                {% if amenity.amenity_type == 'paid' %}
                                <div class="amenity-card paid">
                                    <div class="amenity-header">
                                        {% if amenity.icon %}
                                        <i class="{{ amenity.icon }} amenity-icon"></i>
                                        {% else %}
                                        <i class="fas fa-star amenity-icon"></i>
                                        {% endif %}
                                        <h3 class="amenity-name">{{ amenity.name }}</h3>
                                        <span class="amenity-type-badge badge-paid">PREMIUM</span>
                                    </div>
                                    {% if amenity.description %}
                                    <div class="amenity-description">
                                        {{ amenity.description }}
                                    </div>
                                    {% endif %}
                                    <div class="amenity-price">
                                        <i class="fas fa-tag"></i>
                                        <span class="price-amount dynamic-currency" data-price="{{ amenity.price }}" data-currency="BDT">{{ playground.currency|default:"BDT" }} {{ amenity.price }}</span>
                                    </div>
                                </div>
                                {% endif %}
                            {% endfor %}
                            
                            {% comment %} Paid amenities from JSON field {% endcomment %}
                            {% for amenity in playground.amenities %}
                                {% if amenity.type == 'paid' %}
                                <div class="amenity-card paid legacy">
                                    <div class="amenity-header">
                                        {% if amenity.icon %}
                                        <span class="amenity-icon">{{ amenity.icon }}</span>
                                        {% else %}
                                        <i class="fas fa-star amenity-icon"></i>
                                        {% endif %}
                                        <h3 class="amenity-name">
                                            {% if amenity.name %}
                                                {{ amenity.name }}
                                            {% else %}
                                                {{ amenity }}
                                            {% endif %}
                                        </h3>
                                        <span class="amenity-type-badge badge-paid">PREMIUM</span>
                                    </div>
                                    {% if amenity.description %}
                                    <div class="amenity-description">
                                        {{ amenity.description }}
                                    </div>
                                    {% endif %}
                                    {% if amenity.price %}
                                    <div class="amenity-price">
                                        <i class="fas fa-tag"></i>
                                        <span class="price-amount dynamic-currency" data-price="{{ amenity.price }}" data-currency="BDT">{{ playground.currency|default:"BDT" }} {{ amenity.price }}</span>
                                    </div>
                                    {% endif %}
                                </div>
                                {% endif %}
                            {% endfor %}
                        </div>
                        
                        <!-- Paid Amenities Info -->
                        <div class="amenities-info mt-6">
                            <div class="bg-orange-50 border border-orange-200 rounded-lg p-4">
                                <h4 class="text-lg font-semibold text-orange-800 mb-2">
                                    <i class="fas fa-shopping-cart text-orange-600 mr-2"></i>
                                    Available at Checkout
                                </h4>
                                <p class="text-orange-700">
                                    Premium services can be selected and added to your booking during the checkout process. 
                                    <span class="font-semibold">Prices are additional to the base booking cost.</span>
                                </p>
                            </div>
                        </div>
                    {% else %}
                        <div class="no-amenities-message">
                            <div class="text-center py-6">
                                <i class="fas fa-star text-4xl text-gray-400 mb-3"></i>
                                <h4 class="text-lg font-semibold text-gray-600 mb-2">No Premium Services</h4>
                                <p class="text-gray-500">Paid amenities and premium services haven't been configured yet.</p>
                            </div>
                        </div>
                  
                </div>
            </div>
        </div>
                    <div class="no-amenities-message">
                        <div class="text-center py-8">
                            <i class="fas fa-concierge-bell text-6xl text-gray-300 mb-4"></i>
                            <h3 class="text-xl font-semibold text-gray-600 mb-2">No Amenities Listed</h3>
                            <p class="text-gray-500">The owner hasn't added amenities information yet. Contact them for details about available facilities.</p>
                        </div>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Owner Information Section -->
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <div class="bg-gradient-to-r from-gray-900 to-gray-800 rounded-xl p-8 border border-gray-700 shadow-2xl">
        <h2 class="text-2xl font-bold mb-6 text-white flex items-center">
            <svg class="w-6 h-6 mr-3 text-cyan-400" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"></path>
            </svg>
             Owner Information
        </h2>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
            <div class="text-center md:text-left">
                <p class="text-sm text-gray-300 mb-2 font-medium">Owner Name</p>
                <p class="font-bold text-white text-lg">{{ playground.owner.get_full_name|default:playground.owner.username }}</p>
            </div>
            <div class="text-center md:text-left">
                <p class="text-sm text-gray-300 mb-2 font-medium">Email Contact</p>
                <p class="font-semibold text-white">
                    <a href="mailto:{{ playground.owner.email }}" class="text-cyan-400 hover:text-cyan-300 hover:underline transition-colors">
                        {{ playground.owner.email }}
                    </a>
                </p>
            </div>
            <div class="text-center md:text-left">
                <p class="text-sm text-gray-300 mb-2 font-medium">Member Since</p>
                <p class="font-bold text-white">{{ playground.owner.date_joined|date:"F Y" }}</p>
            </div>
            <div class="text-center md:text-left">
                <p class="text-sm text-gray-300 mb-2 font-medium">Account Status</p>
                <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-bold bg-green-800 text-green-200 border border-green-600">
                    {% if playground.owner.is_active %}
                         Active Owner
                    {% else %}
                         Inactive
                    {% endif %}
                </span>
            </div>
        </div>
        
        <!-- Additional Owner Actions -->
        <div class="mt-6 pt-6 border-t border-indigo-200">
            <div class="flex flex-wrap gap-3 justify-center md:justify-start">
                <a href="mailto:{{ playground.owner.email }}" class="inline-flex items-center px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-all duration-200 shadow-md hover:shadow-lg">
                    <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"></path>
                        <path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"></path>
                    </svg>
                    Contact Owner
                </a>
                {% if playground.enable_chat %}
                <button onclick="openChat()" class="inline-flex items-center px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-all duration-200 shadow-md hover:shadow-lg">
                    <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z" clip-rule="evenodd"></path>
                    </svg>
                    Start Chat
                </button>
                {% endif %}
                <button onclick="reportPlayground()" class="inline-flex items-center px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-all duration-200 shadow-md hover:shadow-lg">
                    <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M3 6a3 3 0 013-3h10a1 1 0 01.8 1.6L14.25 8l2.55 3.4A1 1 0 0116 13H6a1 1 0 00-1 1v3a1 1 0 11-2 0V6z" clip-rule="evenodd"></path>
                    </svg>
                    Report Issue
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Professional Full Screen Image Modal -->
<div id="imageModal" class="fixed inset-0 bg-black hidden z-[9999] fullscreen-modal">
    <!-- Background overlay that closes modal when clicked -->
    <div class="absolute inset-0 bg-black" onclick="closeImageModal()"></div>
    
    <!-- Loading overlay -->
    <div id="imageLoader" class="absolute inset-0 flex items-center justify-center bg-black bg-opacity-75 z-10 pointer-events-none">
        <div class="loading-spinner text-center">
            <div class="spinner-ring mx-auto mb-4"></div>
            <p class="text-white text-lg font-medium">Loading...</p>
        </div>
    </div>
    
    <!-- Top Control Bar -->
    <div class="absolute top-0 left-0 right-0 bg-gradient-to-b from-black via-black/50 to-transparent p-6 z-20 pointer-events-auto">
        <div class="flex justify-between items-center">
            <!-- Image Info -->
            <div class="text-white">
                <h3 id="modalTitle" class="text-xl font-bold mb-1">Playground Image</h3>
                <div class="flex items-center space-x-4 text-sm opacity-80">
                    <span id="imageCounter">
                        <span id="currentImageIndex">1</span> / <span id="totalImages">1</span>
                    </span>
                    <span id="imageResolution">Loading...</span>
                </div>
            </div>
            
            <!-- Top Controls -->
            <div class="flex items-center space-x-3">
                <!-- Fullscreen Toggle -->
                <button id="fullscreenBtn" class="control-btn" onclick="toggleFullscreen()" title="Toggle Fullscreen">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5v-4m0 4h-4m4 0l-5-5"></path>
                    </svg>
                </button>
                
                <!-- Download -->
                <button id="downloadBtn" class="control-btn" onclick="downloadImage()" title="Download Image">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                    </svg>
                </button>
                
                <!-- Share -->
                <button id="shareBtn" class="control-btn" onclick="shareImage()" title="Share Image">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z"></path>
                    </svg>
                </button>
                
                <!-- Close -->
                <button class="control-btn close-btn" onclick="closeImageModal()" title="Close">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>
    
    <!-- Main Image Container -->
    <div class="absolute inset-0 flex items-center justify-center p-6 pt-24 pb-20 z-15 pointer-events-auto" onclick="event.stopPropagation()">
        <div class="relative w-full h-full flex items-center justify-center">
            <!-- Main Image -->
            <img id="modalImage" 
                 src="" 
                 alt="" 
                 class="max-w-full max-h-full object-contain transition-all duration-500 ease-out transform cursor-zoom-in"
                 onload="imageLoaded()" 
                 onerror="imageError()"
                 onclick="event.stopPropagation(); toggleImageZoom()">
            
            <!-- Always Visible Navigation Arrows -->
            <div class="absolute top-1/2 left-4 transform -translate-y-1/2 z-20">
                <button id="prevImage" class="nav-btn nav-btn-left" onclick="event.stopPropagation(); previousImage()" title="Previous Image" style="display: none;">
                    <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                    </svg>
                </button>
            </div>
            
            <div class="absolute top-1/2 right-4 transform -translate-y-1/2 z-20">
                <button id="nextImage" class="nav-btn nav-btn-right" onclick="event.stopPropagation(); nextImage()" title="Next Image" style="display: none;">
                    <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                    </svg>
                </button>
            </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Immediate script to hide modal -->
<script>
(function() {
    const modal = document.getElementById('imageModal');
    if (modal) {
        modal.classList.add('hidden');
        modal.style.display = 'none';
        modal.style.visibility = 'hidden';
        modal.style.pointerEvents = 'none';
        modal.style.zIndex = '-1';
        console.log('Modal immediately hidden on load');
    }
})();

// === GLOBAL FUNCTIONS DEFINED IMMEDIATELY FOR INLINE HANDLERS ===
function imageLoaded() {
    console.log('imageLoaded function called');
    const loader = document.getElementById('imageLoader');
    const modalImage = document.getElementById('modalImage');
    const resolutionElement = document.getElementById('imageResolution');
    
    // Hide loading indicator with smooth transition
    if (loader) {
        loader.style.opacity = '0';
        setTimeout(() => {
            loader.style.display = 'none';
        }, 300);
    }
    
    // Show and clear the image with smooth transition
    if (modalImage) {
        modalImage.style.opacity = '1';
        modalImage.style.filter = 'none';
        modalImage.style.transform = 'scale(1)';
        
        // Update image resolution
        if (resolutionElement && modalImage.naturalWidth && modalImage.naturalHeight) {
            resolutionElement.textContent = `${modalImage.naturalWidth}  ${modalImage.naturalHeight}`;
        }
    }
    
    console.log('Image loaded successfully');
}

function imageError() {
    console.log('imageError function called');
    const loader = document.getElementById('imageLoader');
    const modalImage = document.getElementById('modalImage');
    const resolutionElement = document.getElementById('imageResolution');
    
    // Hide loading indicator
    if (loader) {
        loader.style.opacity = '0';
        setTimeout(() => {
            loader.style.display = 'none';
        }, 300);
    }
    
    // Show error state
    if (modalImage) {
        modalImage.style.opacity = '0.5';
        modalImage.style.filter = 'none';
    }
    
    // Update resolution to show error
    if (resolutionElement) {
        resolutionElement.textContent = 'Failed to load';
    }
    
    console.error('Failed to load image');
    if (typeof showNotification === 'function') {
        showNotification('Failed to load image', 'error');
    }
}

// Make functions globally available
window.imageLoaded = imageLoaded;
window.imageError = imageError;
</script>

<script>
// === GLOBAL VARIABLES ===
let currentSlideIndex = 0;
let currentImageIndex = 0;
let sliderInterval;
let userCurrency = { symbol: '$', code: 'USD', rate: 1 };
let currentZoom = 1;
let isDragging = false;
let startX, startY, translateX = 0, translateY = 0;
let slideshowInterval = null;
let isFullscreen = false;

// Initialize playground images array with proper structure
const playgroundImages = [];

// Add main image first if it exists
{% if playground.main_image %}
playgroundImages.push({
    url: "{{ playground.main_image.url }}",
    caption: "Main Image - {{ playground.name|escapejs }}",
    type: "main"
});
{% endif %}

// Add gallery images
{% for image in playground.images.all %}
playgroundImages.push({
    url: "{{ image.image.url }}",
    caption: "{{ image.caption|default:playground.name|escapejs }}",
    type: "gallery"
});
{% endfor %}

console.log('Initialized playground images:', playgroundImages.length, 'images');
console.log('Playground images array:', playgroundImages);

function showNotification(message, type = 'info') {
    // Create notification element if it doesn't exist
    let notification = document.getElementById('notification');
    if (!notification) {
        notification = document.createElement('div');
        notification.id = 'notification';
        notification.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 12px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            z-index: 10000;
            opacity: 0;
            transition: opacity 0.3s ease;
        `;
        document.body.appendChild(notification);
    }
    
    // Set message and style based on type
    notification.textContent = message;
    notification.style.backgroundColor = type === 'error' ? '#e74c3c' : type === 'success' ? '#27ae60' : '#3498db';
    notification.style.opacity = '1';
    
    // Hide after 3 seconds
    setTimeout(() => {
        notification.style.opacity = '0';
    }, 3000);
}

// === DOM CONTENT LOADED ===
document.addEventListener('DOMContentLoaded', function() {
    console.log('Page loaded, initializing...');
    
    // Initialize all features
    initializeSlider();
    initializeImageModal();
    initializeGoogleMaps();
    loadPlaygroundTypeFromAPI();
    adjustForMobile();
    
    // Additional safety: Ensure modal is hidden
    setTimeout(() => {
        const modal = document.getElementById('imageModal');
        if (modal && !modal.classList.contains('hidden')) {
            console.log('Emergency modal hide applied');
            modal.classList.add('hidden');
            modal.style.display = 'none';
        }
    }, 100);
    
    // Force immediate currency update with default
    forceCurrencyUpdate();
    
    // Then detect and set proper currency
    setTimeout(() => {
        console.log('Starting delayed currency detection...');
        detectAndSetCurrency();
    }, 1000);
    
    // Also try immediate detection
    detectAndSetCurrency();
});

// === AUTO SLIDER FUNCTIONALITY ===
function initializeSlider() {
    if (playgroundImages.length > 1) {
        startAutoSlider();
        
        // Pause on hover
        const slider = document.querySelector('.cover-slider');
        if (slider) {
            slider.addEventListener('mouseenter', stopAutoSlider);
            slider.addEventListener('mouseleave', startAutoSlider);
        }
    }
}

function startAutoSlider() {
    stopAutoSlider(); // Clear any existing interval
    if (playgroundImages.length > 1) {
        sliderInterval = setInterval(() => {
            changeSlide(1);
        }, 4000); // Change slide every 4 seconds
    }
}

function stopAutoSlider() {
    if (sliderInterval) {
        clearInterval(sliderInterval);
        sliderInterval = null;
    }
}

function changeSlide(direction) {
    const slides = document.querySelectorAll('.slide');
    const dots = document.querySelectorAll('.slider-dot');
    
    if (slides.length === 0) return;
    
    // Remove active class from current slide and dot
    slides[currentSlideIndex].classList.remove('active');
    if (dots[currentSlideIndex]) {
        dots[currentSlideIndex].classList.remove('active');
    }
    
    // Calculate new index
    currentSlideIndex += direction;
    if (currentSlideIndex >= slides.length) {
        currentSlideIndex = 0;
    } else if (currentSlideIndex < 0) {
        currentSlideIndex = slides.length - 1;
    }
    
    // Add active class to new slide and dot
    slides[currentSlideIndex].classList.add('active');
    if (dots[currentSlideIndex]) {
        dots[currentSlideIndex].classList.add('active');
    }
}

function currentSlide(index) {
    const slides = document.querySelectorAll('.slide');
    const dots = document.querySelectorAll('.slider-dot');
    
    if (slides.length === 0) return;
    
    // Remove active class from current slide and dot
    slides[currentSlideIndex].classList.remove('active');
    if (dots[currentSlideIndex]) {
        dots[currentSlideIndex].classList.remove('active');
    }
    
    // Set new index
    currentSlideIndex = index - 1;
    
    // Add active class to new slide and dot
    slides[currentSlideIndex].classList.add('active');
    if (dots[currentSlideIndex]) {
        dots[currentSlideIndex].classList.add('active');
    }
    
    // Restart auto slider
    startAutoSlider();
}

// === ENHANCED TAB FUNCTIONALITY WITH API INTEGRATION ===
let playgroundId = null;
let currentCurrency = 'BDT';
let currencySymbol = '';

// Initialize playground data
document.addEventListener('DOMContentLoaded', function() {
    // Extract playground ID from URL or data attribute
    const pathParts = window.location.pathname.split('/');
    playgroundId = pathParts[pathParts.length - 2];
    
    console.log('Playground ID:', playgroundId); // Debug log
    
    // Initialize current time display
    updateCurrentTime();
    setInterval(updateCurrentTime, 60000); // Update every minute
    
    // Load today's slots by default
    loadTodaySlots();
    
    // Set up currency information and update all prices
    initializeCurrency();
    
    // Initialize currency for amenities on page load
    setTimeout(() => {
        if (currentCurrency && currencySymbol) {
            updateAmenitiesCurrency();
        }
    }, 1000); // Delay to ensure slots are loaded first
});

function updateCurrentTime() {
    const now = new Date();
    const timeString = now.toLocaleTimeString('en-US', { 
        hour: 'numeric', 
        minute: '2-digit',
        hour12: true 
    });
    const dateString = now.toLocaleDateString('en-US', { 
        weekday: 'long',
        year: 'numeric',
        month: 'long',
        day: 'numeric'
    });
    
    const currentTimeElement = document.getElementById('current-time');
    const todayDateElement = document.getElementById('today-date');
    
    if (currentTimeElement) {
        currentTimeElement.textContent = timeString;
    }
    
    if (todayDateElement) {
        todayDateElement.textContent = `${dateString}`;
    }
}

function initializeCurrency() {
    // Get currency from playground data or use default
    const playgroundData = {{ playground_data|safe }};
    if (playgroundData && playgroundData.exists) {
        // You can extend this to get currency from playground data
        currentCurrency = 'BDT'; // Default for now
        currencySymbol = '';
    }
}

async function showSlotType(type) {
    // Hide all slot contents
    const contents = document.querySelectorAll('.slot-content');
    contents.forEach(content => content.classList.remove('active'));
    
    // Remove active class from all tab buttons
    const tabButtons = document.querySelectorAll('.slot-tabs .tab-button');
    tabButtons.forEach(button => button.classList.remove('active'));
    
    // Add active class to clicked button
    const clickedButton = document.getElementById(type + '-tab');
    if (clickedButton) {
        clickedButton.classList.add('active');
    }
    
    // Show loading if needed
    if (type === 'today' || type === 'custom') {
        showLoading();
    }
    
    // Show selected content and load data if needed
    switch(type) {
        case 'today':
            await loadTodaySlots();
            break;
        case 'custom':
            await loadCustomSlots();
            break;
        case 'regular':
        case 'passes':
            const targetContent = document.getElementById(type + '-slots');
            if (targetContent) {
                targetContent.classList.add('active');
            }
            break;
    }
    
    hideLoading();
}

async function loadTodaySlots() {
    if (!playgroundId) {
        console.error('Playground ID not found');
        return;
    }
    
    try {
        const response = await fetch(`/api/today-slots/${playgroundId}/`, {
            method: 'GET',
            headers: {
                'Accept': 'application/json',
                'X-Requested-With': 'XMLHttpRequest',
            }
        });
        
        if (response.ok) {
            const data = await response.json();
            renderTodaySlots(data);
        } else {
            console.error('Failed to load today\'s slots');
            showTodayNoSlots();
        }
    } catch (error) {
        console.error('Error loading today\'s slots:', error);
        showTodayNoSlots();
    }
}

async function loadCustomSlots() {
    if (!playgroundId) {
        console.error('Playground ID not found');
        return;
    }
    
    try {
        const response = await fetch(`/api/professional-slots/${playgroundId}/`, {
            method: 'GET',
            headers: {
                'Accept': 'application/json',
                'X-Requested-With': 'XMLHttpRequest',
            }
        });
        
        if (response.ok) {
            const data = await response.json();
            renderCustomSlots(data);
        } else {
            console.error('Failed to load custom slots');
            showCustomNoSlots();
        }
    } catch (error) {
        console.error('Error loading custom slots:', error);
        showCustomNoSlots();
    }
}

function renderTodaySlots(data) {
    const gridContainer = document.getElementById('today-slots-grid');
    const noSlotsContainer = document.getElementById('today-no-slots');
    const todayContainer = document.getElementById('today-slots');
    
    if (!gridContainer) return;
    
    // Debug: Log the API response to see what's being returned
    console.log('Today slots API response:', JSON.stringify(data, null, 2));
    
    // Only show regular slots in Today's Slots (not custom slots)
    const regularSlots = data.regular_slots || [];
    
    // Debug: Log only regular slots
    console.log('Regular slots only:', regularSlots);
    
    if (regularSlots.length === 0) {
        showTodayNoSlots();
        return;
    }
    
    // Update currency information
    if (data.currency) {
        currentCurrency = data.currency;
        currencySymbol = data.currency_symbol || currentCurrency;
        updateMembershipPassesCurrency(); // Update membership passes currency
        updateAmenitiesCurrency(); // Update amenities currency
    }
    
    // Update today's date and current time display
    if (data.today_date) {
        const todayDateElement = document.getElementById('today-date');
        if (todayDateElement) {
            const totalSlots = regularSlots.length;
            todayDateElement.textContent = `${data.today_day} - ${totalSlots} slot${totalSlots !== 1 ? 's' : ''} available`;
        }
    }

    gridContainer.innerHTML = regularSlots.map(slot => `
        <div class="time-slot-card basic" data-slot-id="${slot.id}">
            <div class="flex justify-between items-center mb-2">
                <span class="slot-day">${slot.day}</span>
                <span class="slot-status ${slot.is_available ? 'available' : 'unavailable'}">
                    ${slot.is_available ? 'Available' : 'Unavailable'}
                </span>
            </div>
            <div class="slot-time">
                <i class="fas fa-clock"></i>
                <span class="time-display">${slot.start_time} - ${slot.end_time}</span>
            </div>
            <div class="slot-price">
                <span class="currency">${slot.currency_symbol || slot.currency}</span>
                <span class="amount">${slot.price}</span>
            </div>
            <div class="slot-capacity">
                <i class="fas fa-users"></i>
                <span class="text-gray-300">Max ${slot.max_bookings} booking(s)</span>
            </div>
            ${slot.duration_hours ? `
                <div class="slot-duration">
                    <i class="fas fa-hourglass-half"></i>
                    <span class="text-gray-300">${slot.duration_hours}h duration</span>
                </div>
            ` : ''}
        </div>
    `).join('');
    
    // Show today's slots and hide no-slots message
    todayContainer.classList.add('active');
    noSlotsContainer.classList.add('hidden');
    gridContainer.classList.remove('hidden');
}

function renderCustomSlots(data) {
    const gridContainer = document.getElementById('custom-slots-grid');
    const noSlotsContainer = document.getElementById('custom-no-slots');
    const customContainer = document.getElementById('custom-slots');
    
    if (!gridContainer) return;
    
    const customSlots = data.custom_slots || [];
    
    if (customSlots.length === 0) {
        showCustomNoSlots();
        return;
    }
    
    gridContainer.innerHTML = customSlots.map(slot => `
        <div class="custom-slot-card" data-slot-id="${slot.id}">
            <div class="pass-header">
                <span class="pass-name">${slot.slot_type.toUpperCase()} SLOT</span>
                <span class="pass-type badge-premium">Premium</span>
            </div>
            <div class="flex justify-between items-center mb-2">
                <span class="slot-day text-purple-200">${slot.day}</span>
                <span class="slot-status available">Available</span>
            </div>
            <div class="slot-time">
                <i class="fas fa-clock text-purple-400"></i>
                <span class="time-display text-white">${slot.start_time} - ${slot.end_time}</span>
            </div>
            <div class="slot-price">
                <span class="currency text-purple-300">${slot.currency}</span>
                <span class="amount text-green-400">${slot.price}</span>
            </div>
            <div class="slot-capacity">
                <i class="fas fa-users text-purple-400"></i>
                <span class="text-purple-200">Max ${slot.max_capacity} players</span>
            </div>
            ${slot.duration_hours ? `
                <div class="slot-duration">
                    <i class="fas fa-hourglass-half text-purple-400"></i>
                    <span class="text-purple-200">${slot.duration_hours}h duration</span>
                </div>
            ` : ''}
            ${slot.description ? `
                <div class="pass-description mt-2">
                    ${slot.description}
                </div>
            ` : ''}
            ${slot.features && slot.features.length > 0 ? `
                <div class="pass-features mt-2">
                    ${slot.features.map(feature => `<span class="feature-tag">${feature}</span>`).join('')}
                </div>
            ` : ''}
            <div class="pass-access mt-3">
                <i class="fas fa-crown text-yellow-400"></i>
                <span class="text-purple-200">Premium Access</span>
            </div>
        </div>
    `).join('');
    
    // Update currency for custom slots and membership passes
    updateAllCurrency(data);
    
    // Show custom slots and hide no-slots message
    customContainer.classList.add('active');
    noSlotsContainer.classList.add('hidden');
    gridContainer.classList.remove('hidden');
}

function showTodayNoSlots() {
    const gridContainer = document.getElementById('today-slots-grid');
    const noSlotsContainer = document.getElementById('today-no-slots');
    const todayContainer = document.getElementById('today-slots');
    
    if (gridContainer) gridContainer.classList.add('hidden');
    if (noSlotsContainer) noSlotsContainer.classList.remove('hidden');
    if (todayContainer) todayContainer.classList.add('active');
}

function showCustomNoSlots() {
    const gridContainer = document.getElementById('custom-slots-grid');
    const noSlotsContainer = document.getElementById('custom-no-slots');
    const customContainer = document.getElementById('custom-slots');
    
    if (gridContainer) gridContainer.classList.add('hidden');
    if (noSlotsContainer) noSlotsContainer.classList.remove('hidden');
    if (customContainer) customContainer.classList.add('active');
}

function showLoading() {
    const loadingElement = document.getElementById('slots-loading');
    if (loadingElement) {
        loadingElement.classList.remove('hidden');
    }
}

function hideLoading() {
    const loadingElement = document.getElementById('slots-loading');
    if (loadingElement) {
        loadingElement.classList.add('hidden');
    }
}

// Day filter functionality for regular slots
function filterSlotsByDay(day) {
    const slots = document.querySelectorAll('.time-slot-card[data-day]');
    const filterButtons = document.querySelectorAll('.day-filter-btn');
    
    // Update filter button active state
    filterButtons.forEach(btn => {
        btn.classList.remove('active');
        if (btn.getAttribute('data-day') === day) {
            btn.classList.add('active');
        }
    });
    
    // Show/hide slots based on day filter
    slots.forEach(slot => {
        if (day === 'all' || slot.getAttribute('data-day') === day) {
            slot.style.display = 'block';
        } else {
            slot.style.display = 'none';
        }
    });
}

function showAmenityType(type) {
    // Hide all amenity contents
    const contents = document.querySelectorAll('.amenity-content');
    contents.forEach(content => content.classList.remove('active'));
    
    // Remove active class from all tab buttons
    const tabButtons = document.querySelectorAll('.amenity-tabs .tab-button');
    tabButtons.forEach(button => button.classList.remove('active'));
    
    // Show selected content
    const targetContent = document.getElementById(type + '-amenities');
    if (targetContent) {
        targetContent.classList.add('active');
    }
    
    // Add active class to clicked button
    event.target.classList.add('active');
}

// === DYNAMIC CURRENCY FUNCTIONALITY ===
async function detectAndSetCurrency() {
    console.log('Starting currency detection...');
    try {
        // Get playground ID from URL
        const playgroundId = window.location.pathname.split('/').slice(-2, -1)[0];
        console.log('Playground ID:', playgroundId);
        
        // Make API call with playground ID for accurate currency detection
        const response = await fetch(`/api/currency/detect/?playground_id=${playgroundId}`, {
            method: 'GET',
            headers: {
                'Accept': 'application/json',
                'X-Requested-With': 'XMLHttpRequest',
            }
        });
        
        console.log('Currency API response status:', response.status);
        
        if (response.ok) {
            const data = await response.json();
            console.log('Currency API response data:', data);
            
            if (data.success && data.currency) {
                userCurrency = {
                    symbol: data.currency.symbol,
                    code: data.currency.code,
                    rate: data.currency.rate || 1
                };
                console.log('User currency set to:', userCurrency);
                updatePricesWithCurrency();
            } else {
                console.log('Currency detection failed, using default USD');
                userCurrency = { symbol: '$', code: 'USD', rate: 1 };
                updatePricesWithCurrency();
            }
        } else {
            console.log('Currency API request failed');
            userCurrency = { symbol: '$', code: 'USD', rate: 1 };
            updatePricesWithCurrency();
        }
    } catch (error) {
        console.error('Currency detection error:', error);
        userCurrency = { symbol: '$', code: 'USD', rate: 1 };
        updatePricesWithCurrency();
    }
}

async function updatePricesWithCurrency() {
    console.log('Updating prices with currency:', userCurrency);
    try {
        // Get playground's base prices
        const basePricePerHour = parseFloat("{{ playground.price_per_hour }}");
        {% if playground.price_per_day %}const basePricePerDay = parseFloat("{{ playground.price_per_day }}");{% endif %}
        
        console.log('Base prices - Hour:', basePricePerHour);
        {% if playground.price_per_day %}
        console.log('Base prices - Day:', basePricePerDay);
        {% endif %}
        
        // Convert prices if different currency
        let convertedPricePerHour = basePricePerHour;
        {% if playground.price_per_day %}
        let convertedPricePerDay = basePricePerDay;
        {% endif %}
        
        if (userCurrency.code !== 'USD' && userCurrency.rate) {
            convertedPricePerHour = (basePricePerHour * userCurrency.rate).toFixed(2);
            {% if playground.price_per_day %}
            convertedPricePerDay = (basePricePerDay * userCurrency.rate).toFixed(2);
            {% endif %}
            console.log('Converted prices - Hour:', convertedPricePerHour);
            {% if playground.price_per_day %}
            console.log('Converted prices - Day:', convertedPricePerDay);
            {% endif %}
        }
        
        // Update price displays
        const currencySymbol = userCurrency.symbol;
        console.log('Currency symbol:', currencySymbol);
        
        // Update main price display
        const priceElement = document.getElementById('price-value');
        const currencyElement = document.getElementById('currency-symbol');
        console.log('Price elements found:', !!priceElement, !!currencyElement);
        
        if (priceElement) {
            priceElement.textContent = convertedPricePerHour;
            console.log('Updated price-value to:', convertedPricePerHour);
        }
        if (currencyElement) {
            currencyElement.textContent = currencySymbol;
            console.log('Updated currency-symbol to:', currencySymbol);
        }
        
        // Update pricing section
        const hourlyRateAmount = document.getElementById('hourly-rate-amount');
        const hourlyRateCurrency = document.getElementById('hourly-rate-currency');
        console.log('Hourly rate elements found:', !!hourlyRateAmount, !!hourlyRateCurrency);
        
        if (hourlyRateAmount) {
            hourlyRateAmount.textContent = convertedPricePerHour;
            console.log('Updated hourly-rate-amount to:', convertedPricePerHour);
        }
        if (hourlyRateCurrency) {
            hourlyRateCurrency.textContent = currencySymbol;
            console.log('Updated hourly-rate-currency to:', currencySymbol);
        }
        
        {% if playground.price_per_day %}
        const dailyRateAmount = document.getElementById('daily-rate-amount');
        const dailyRateCurrency = document.getElementById('daily-rate-currency');
        if (dailyRateAmount) dailyRateAmount.textContent = convertedPricePerDay;
        if (dailyRateCurrency) dailyRateCurrency.textContent = currencySymbol;
        {% endif %}
        
        // Update slot prices
        const slotCurrencyElements = document.querySelectorAll('.slot-currency');
        const slotPriceElements = document.querySelectorAll('.slot-price');
        console.log('Found slot elements:', slotCurrencyElements.length, slotPriceElements.length);
        
        slotCurrencyElements.forEach(element => {
            element.textContent = currencySymbol;
            console.log('Updated slot currency element to:', currencySymbol);
        });
        
        slotPriceElements.forEach(element => {
            const originalPrice = parseFloat(element.textContent);
            if (!isNaN(originalPrice) && userCurrency.code !== 'USD' && userCurrency.rate) {
                const convertedPrice = (originalPrice * userCurrency.rate).toFixed(2);
                element.textContent = convertedPrice;
                console.log('Updated slot price from', originalPrice, 'to', convertedPrice);
            }
        });
        
        console.log('Currency update completed successfully');
        
    } catch (error) {
        console.error('Error updating prices:', error);
    }
}

// === FORCE CURRENCY UPDATE FUNCTION ===
function forceCurrencyUpdate() {
    console.log('Force updating currency display...');
    
    // Ensure all currency symbols are updated immediately
    const currencySymbol = userCurrency.symbol || '$';
    
    // Update all currency display elements
    const currencyElements = [
        document.getElementById('currency-symbol'),
        document.getElementById('hourly-rate-currency'),
        document.getElementById('daily-rate-currency'),
        ...document.querySelectorAll('.slot-currency')
    ];
    
    currencyElements.forEach(element => {
        if (element) {
            element.textContent = currencySymbol;
            console.log('Force updated currency element to:', currencySymbol);
        }
    });
    
    // Also update prices if conversion rate is available
    if (userCurrency.rate && userCurrency.rate !== 1) {
        updatePricesWithCurrency();
    }
}

// === PLAYGROUND TYPE API INTEGRATION ===
async function loadPlaygroundTypeFromAPI() {
    try {
        console.log('Loading playground type from API...');
        
        // Try multiple API endpoints in order of preference
        const apiEndpoints = [
            '/api/dynamic/playground-types/',
            '/playgrounds/api/playground-types/',
            '/api/playground-types/'
        ];
        
        let data = null;
        let response = null;
        
        for (const endpoint of apiEndpoints) {
            try {
                console.log('Trying endpoint:', endpoint);
                response = await fetch(endpoint, {
                    method: 'GET',
                    headers: {
                        'X-Requested-With': 'XMLHttpRequest',
                        'Accept': 'application/json',
                    }
                });
                
                if (response.ok) {
                    data = await response.json();
                    console.log('Successfully got data from:', endpoint, data);
                    if (data.success && data.playground_types) {
                        break;
                    }
                }
            } catch (endpointError) {
                console.log('Endpoint failed:', endpoint, endpointError);
                continue;
            }
        }
        
        if (data && data.success && data.playground_types) {
            // Find the playground type that matches current playground
            const currentTypeId = '{{ playground.playground_type|default:"" }}';
            const typeDisplay = document.getElementById('playground-type-display');
            
            console.log('Current playground type ID:', currentTypeId);
            console.log('Available types:', data.playground_types);
            
            if (typeDisplay && currentTypeId && currentTypeId !== '') {
                // Find the type by ID or name - playground_type can be ID or string like 'outdoor'
                const matchedType = data.playground_types.find(type => 
                    String(type.id) === String(currentTypeId) || 
                    type.name.toLowerCase() === currentTypeId.toLowerCase()
                );
                

                if (matchedType) {
                    const displayText = matchedType.icon ? 
                        matchedType.icon + ' ' + matchedType.name : 
                        matchedType.name;
                    typeDisplay.textContent = displayText;
                    console.log('Playground type loaded successfully:', displayText);
                } else {
                    console.log('No matching type found for ID:', currentTypeId);
                    typeDisplay.textContent = 'Sports Facility';
                }
            } else if (typeDisplay) {
                // Fallback when no ID
                typeDisplay.textContent = 'Sports Facility';
                console.log('No type ID found, showing generic fallback');
            }
        } else {
            console.log('No valid API response, showing generic fallback');
            const typeDisplay = document.getElementById('playground-type-display');
            if (typeDisplay) {
                typeDisplay.textContent = 'Sports Facility';
            }
        }
    } catch (error) {
        console.error('Error loading playground types:', error);
        const typeDisplay = document.getElementById('playground-type-display');
        if (typeDisplay) {
            typeDisplay.textContent = 'Sports Facility';
        }
    }
}

// === GOOGLE MAPS INTEGRATION ===
function initializeGoogleMaps() {
    console.log('Initializing Google Maps...');
    const playgroundName = "{{ playground.name|escapejs }}";
    const playgroundAddress = "{{ playground.address|escapejs }}";
    const cityName = "{{ playground.city.name|escapejs }}";
    const stateName = "{{ playground.city.state.name|escapejs }}";
    const countryName = "{{ playground.city.state.country.name|escapejs }}";
    
    {% if playground.latitude and playground.longitude and playground.latitude != 0 and playground.longitude != 0 %}
    // Use exact coordinates when available
    const lat = {{ playground.latitude }};
    const lng = {{ playground.longitude }};
    console.log('Using exact coordinates:', lat, lng);
    
    // Create Google Maps embed URL with coordinates
    const simpleEmbedUrl = `https://www.google.com/maps?q=${lat},${lng}&z=15&output=embed`;
    const googleMapsUrl = `https://www.google.com/maps?q=${lat},${lng}`;
    const directionsUrl = `https://www.google.com/maps/dir/?api=1&destination=${lat},${lng}`;
    
    // Show coordinates status
    const coordinatesStatus = document.getElementById('coordinates-status');
    const fallbackStatus = document.getElementById('fallback-status');
    if (coordinatesStatus) coordinatesStatus.classList.remove('hidden');
    if (fallbackStatus) fallbackStatus.style.display = 'none';
    
    {% else %}
    // Use city/address search when exact coordinates are not available
    console.log('Using address-based search');
    const searchQuery = `${playgroundName}, ${playgroundAddress}, ${cityName}, ${stateName}, ${countryName}`;
    const encodedQuery = encodeURIComponent(searchQuery);
    console.log('Search query:', searchQuery);
    
    // Create Google Maps embed URL with address search
    const simpleEmbedUrl = `https://www.google.com/maps?q=${encodedQuery}&z=14&output=embed`;
    const googleMapsUrl = `https://www.google.com/maps?q=${encodedQuery}`;
    const directionsUrl = `https://www.google.com/maps/dir/?api=1&destination=${encodedQuery}`;
    
    // Show fallback status
    const coordinatesStatus = document.getElementById('coordinates-status');
    const fallbackStatus = document.getElementById('fallback-status');
    if (coordinatesStatus) coordinatesStatus.classList.add('hidden');
    if (fallbackStatus) fallbackStatus.style.display = 'block';
    
    {% endif %}
    
    // Update map iframe
    const mapIframe = document.getElementById('google-map');
    const mapLoading = document.getElementById('map-loading');
    const googleMapsLink = document.getElementById('google-maps-link');
    
    console.log('Setting up map iframe with URL:', simpleEmbedUrl);
    
    if (mapIframe) {
        mapIframe.src = simpleEmbedUrl;
        mapIframe.onload = function() {
            console.log('Map loaded successfully');
            if (mapLoading) mapLoading.style.display = 'none';
            mapIframe.style.display = 'block';
        };
        mapIframe.onerror = function() {
            console.error('Map failed to load');
            if (mapLoading) {
                mapLoading.innerHTML = `
                    <div class="text-center">
                        <svg class="w-8 h-8 text-red-500 mx-auto mb-3" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                        </svg>
                        <span class="text-red-600 text-sm">Map failed to load</span>
                    </div>
                `;
            }
        };
    }
    
    if (googleMapsLink) {
        googleMapsLink.href = googleMapsUrl;
    }
    
    // Set up directions functionality
    window.getDirections = function() {
        console.log('Opening directions to:', directionsUrl);
        window.open(directionsUrl, '_blank');
    };
    
    // Set up location sharing
    window.shareLocation = function() {
        const shareData = {
            title: `Location of ${playgroundName}`,
            text: `Check out ${playgroundName} at this location`,
            url: googleMapsUrl
        };
        
        if (navigator.share) {
            navigator.share(shareData).catch(console.error);
        } else {
            // Fallback: copy to clipboard
            navigator.clipboard.writeText(googleMapsUrl).then(() => {
                alert('Location link copied to clipboard!');
            }).catch(() => {
                // Final fallback: open in new tab
                window.open(googleMapsUrl, '_blank');
            });
        }
    };
}

// === IMAGE MODAL INITIALIZATION ===
function initializeImageModal() {
    console.log('Initializing image modal...');
    
    // Ensure modal is hidden on initialization
    const modal = document.getElementById('imageModal');
    if (modal) {
        modal.classList.add('hidden');
        modal.style.display = 'none';
        console.log('Modal properly hidden on initialization');
    }
    
    // Set up modal click prevention
    const modalContainer = document.querySelector('#imageModal > div');
    if (modalContainer) {
        modalContainer.addEventListener('click', function(e) {
            e.stopPropagation();
        });
    }
    
    // Set up cover image click handlers
    const coverSlides = document.querySelectorAll('.cover-slider .slide');
    coverSlides.forEach((slide, index) => {
        slide.addEventListener('click', function(e) {
            e.preventDefault();
            console.log('Cover slide clicked:', index);
            
            // Find the corresponding image in playgroundImages array
            const slideImg = slide.querySelector('img');
            if (slideImg && slideImg.src) {
                const imageUrl = slideImg.src;
                console.log('Opening modal for cover image:', imageUrl);
                openImageModal(imageUrl, 'Cover Image');
            }
        });
    });
    
    // Set up gallery image click handlers
    const galleryImages = document.querySelectorAll('.enhanced-gallery-grid .gallery-image');
    galleryImages.forEach((img, index) => {
        img.parentElement.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            console.log('Enhanced gallery image clicked:', index, img.src);
            openImageModal(img.src, img.alt || 'Playground Image', index);
        });
    });
    
    // Update total images count in modal
    const totalImagesElement = document.getElementById('totalImages');
    if (totalImagesElement) {
        totalImagesElement.textContent = playgroundImages.length;
    }
    
    console.log('Image modal initialized with', playgroundImages.length, 'images');
}

// === IMAGE GALLERY FUNCTIONALITY ===
function startSlideshow() {
    if (playgroundImages.length > 0) {
        currentImageIndex = 0;
        showImageInModal(currentImageIndex);
        openModal();
    }
}

function openImageModal(imageUrl, caption, imageIndex = null) {
    console.log('Opening image modal:', imageUrl, caption, imageIndex);
    
    if (!imageUrl) {
        console.error('No image URL provided');
        return;
    }
    
    // If imageIndex is provided, use it directly
    if (imageIndex !== null && imageIndex >= 0 && imageIndex < playgroundImages.length) {
        currentImageIndex = imageIndex;
    } else {
        // Find image in the playground images array
        currentImageIndex = playgroundImages.findIndex(img => img.url === imageUrl);
        if (currentImageIndex === -1) {
            // If not found in array, add it temporarily
            console.log('Image not found in array, adding temporarily');
            playgroundImages.push({
                url: imageUrl,
                caption: caption || 'Playground Image',
                type: 'temp'
            });
            currentImageIndex = playgroundImages.length - 1;
        }
    }
    
    console.log('Current image index:', currentImageIndex, 'Total images:', playgroundImages.length);
    
    showImageInModal(currentImageIndex);
    openModal();
}

function openModal() {
    const modal = document.getElementById('imageModal');
    const loader = document.getElementById('imageLoader');
    
    if (modal) {
        console.log('Opening modal');
        
        // Show loading indicator first
        if (loader) {
            loader.style.display = 'flex';
            loader.style.opacity = '1';
        }
        
        // Show the modal properly
        modal.classList.remove('hidden');
        modal.style.display = 'flex';
        modal.style.visibility = 'visible';
        modal.style.pointerEvents = 'auto';
        modal.style.zIndex = '9999';
        modal.style.opacity = '1';
        
        document.body.style.overflow = 'hidden';
        
        // Show navigation buttons based on image count
        updateNavigationButtons();
        
        // Focus management for accessibility
        modal.focus();
        
        console.log('Modal opened successfully');
    } else {
        console.error('Modal element not found');
    }
}

function showImageInModal(index) {
    if (playgroundImages.length === 0) {
        console.log('No images available');
        return;
    }
    
    // Ensure index is within bounds
    currentImageIndex = Math.max(0, Math.min(index, playgroundImages.length - 1));
    const image = playgroundImages[currentImageIndex];
    
    console.log('Showing image in modal:', currentImageIndex + 1, 'of', playgroundImages.length);
    
    // Show loading state with smooth animation
    const loader = document.getElementById('imageLoader');
    if (loader) {
        loader.style.display = 'flex';
        loader.style.opacity = '1';
    }
    
    // Update modal elements
    const modalImage = document.getElementById('modalImage');
    const modalCaption = document.getElementById('modalCaption');
    const modalTitle = document.getElementById('modalTitle');
    const currentIndexElement = document.getElementById('currentImageIndex');
    const totalImagesElement = document.getElementById('totalImages');
    
    if (modalImage) {
        // Reset zoom and position
        resetZoom();
        
        // Add loading state with smooth transitions
        modalImage.style.opacity = '0.3';
        modalImage.style.filter = 'blur(3px)';
        modalImage.style.transform = 'scale(0.95)';
        
        // Set up event handlers properly
        modalImage.onload = function() {
            // Smooth transition to loaded state
            modalImage.style.opacity = '1';
            modalImage.style.filter = 'none';
            modalImage.style.transform = 'scale(1)';
            imageLoaded();
        };
        
        modalImage.onerror = function() {
            modalImage.style.opacity = '1';
            modalImage.style.filter = 'none';
            imageError();
        };
        
        modalImage.src = image.url;
        modalImage.alt = image.caption;
    }
    
    if (modalCaption) {
        modalCaption.textContent = image.caption || 'Playground Image';
    }
    
    if (modalTitle) {
        modalTitle.textContent = 'Playground Gallery';
    }
    
    if (currentIndexElement) {
        currentIndexElement.textContent = currentImageIndex + 1;
    }
    
    if (totalImagesElement) {
        totalImagesElement.textContent = playgroundImages.length;
    }
    
    // Update navigation buttons visibility
    updateNavigationButtons();
    
    // Update thumbnails
    setTimeout(() => generateThumbnails(), 100);
}

function updateNavigationButtons() {
    const prevButton = document.getElementById('prevImage');
    const nextButton = document.getElementById('nextImage');
    const thumbnailStrip = document.getElementById('thumbnailStrip');
    
    console.log('Updating navigation buttons. Image count:', playgroundImages.length);
    
    // Show/hide navigation buttons based on image count
    if (playgroundImages.length <= 1) {
        if (prevButton) {
            prevButton.style.display = 'none';
            prevButton.classList.remove('show');
        }
        if (nextButton) {
            nextButton.style.display = 'none';
            nextButton.classList.remove('show');
        }
        if (thumbnailStrip) {
            thumbnailStrip.style.display = 'none';
        }
    } else {
        if (prevButton) {
            prevButton.style.display = 'flex';
            prevButton.classList.add('show');
        }
        if (nextButton) {
            nextButton.style.display = 'flex';
            nextButton.classList.add('show');
        }
        if (thumbnailStrip) {
            thumbnailStrip.style.display = 'flex';
        }
    }
    
    // Update button states for first/last image
    if (prevButton && playgroundImages.length > 1) {
        if (currentImageIndex === 0) {
            prevButton.style.opacity = '0.4';
            prevButton.style.cursor = 'not-allowed';
        } else {
            prevButton.style.opacity = '0.8';
            prevButton.style.cursor = 'pointer';
        }
    }
    
    if (nextButton && playgroundImages.length > 1) {
        if (currentImageIndex === playgroundImages.length - 1) {
            nextButton.style.opacity = '0.4';
            nextButton.style.cursor = 'not-allowed';
        } else {
            nextButton.style.opacity = '0.8';
            nextButton.style.cursor = 'pointer';
        }
    }
}

function closeImageModal() {
    const modal = document.getElementById('imageModal');
    if (modal) {
        // Stop any ongoing slideshow
        if (slideshowInterval) {
            clearInterval(slideshowInterval);
            slideshowInterval = null;
        }
        
        // Exit fullscreen if active
        if (document.fullscreenElement) {
            document.exitFullscreen();
        }
        
        // Immediate hide for safety
        modal.classList.add('hidden');
        modal.style.display = 'none';
        modal.style.opacity = '0';
        modal.style.visibility = 'hidden';
        modal.style.pointerEvents = 'none';
        modal.style.zIndex = '-1';
        
        document.body.style.overflow = 'auto';
        
        // Reset zoom and position
        resetZoom();
        
        console.log('Modal closed and hidden');
    }
}

function previousImage() {
    if (playgroundImages.length === 0) return;
    
    // Don't go beyond first image
    if (currentImageIndex > 0) {
        currentImageIndex = currentImageIndex - 1;
        showImageInModal(currentImageIndex);
    }
}

function nextImage() {
    if (playgroundImages.length === 0) return;
    
    // Don't go beyond last image
    if (currentImageIndex < playgroundImages.length - 1) {
        currentImageIndex = currentImageIndex + 1;
        showImageInModal(currentImageIndex);
    }
}

function showAllImages() {
    if (playgroundImages.length > 0) {
        startSlideshow();
    }
}

// === ADVANCED MODAL FUNCTIONALITY ===
function generateThumbnails() {
    const thumbnailStrip = document.getElementById('thumbnailStrip');
    if (!thumbnailStrip || playgroundImages.length <= 1) return;
    
    thumbnailStrip.innerHTML = '';
    
    playgroundImages.forEach((image, index) => {
        const thumb = document.createElement('div');
        thumb.className = `thumbnail-item ${index === currentImageIndex ? 'active' : ''}`;
        thumb.onclick = () => jumpToImage(index);
        
        const img = document.createElement('img');
        img.src = image.url;
        img.alt = image.caption;
        
        thumb.appendChild(img);
        thumbnailStrip.appendChild(thumb);
    });
}

function jumpToImage(index) {
    currentImageIndex = index;
    showImageInModal(currentImageIndex);
    generateThumbnails(); // Update active thumbnail
}

function toggleImageZoom() {
    const modalImage = document.getElementById('modalImage');
    if (!modalImage) return;
    
    if (currentZoom === 1) {
        zoomIn();
    } else {
        resetZoom();
    }
}

function zoomIn() {
    const modalImage = document.getElementById('modalImage');
    const zoomLevel = document.getElementById('zoomLevel');
    
    currentZoom = Math.min(currentZoom * 1.5, 3);
    
    if (modalImage) {
        modalImage.style.transform = `scale(${currentZoom}) translate(${translateX}px, ${translateY}px)`;
        modalImage.style.cursor = 'grab';
        modalImage.classList.add('zoomed-in');
        modalImage.classList.remove('zoomed-out');
    }
    
    if (zoomLevel) {
        zoomLevel.textContent = `${Math.round(currentZoom * 100)}%`;
    }
}

function zoomOut() {
    const modalImage = document.getElementById('modalImage');
    const zoomLevel = document.getElementById('zoomLevel');
    
    currentZoom = Math.max(currentZoom / 1.5, 0.5);
    
    if (modalImage) {
        modalImage.style.transform = `scale(${currentZoom}) translate(${translateX}px, ${translateY}px)`;
        modalImage.style.cursor = 'grab';
        
        if (currentZoom <= 1) {
            modalImage.classList.add('zoomed-out');
            modalImage.classList.remove('zoomed-in');
        }
    }
    
    if (zoomLevel) {
        zoomLevel.textContent = `${Math.round(currentZoom * 100)}%`;
    }
}

function resetZoom() {
    const modalImage = document.getElementById('modalImage');
    const zoomLevel = document.getElementById('zoomLevel');
    
    currentZoom = 1;
    translateX = 0;
    translateY = 0;
    
    if (modalImage) {
        modalImage.style.transform = 'scale(1) translate(0px, 0px)';
        modalImage.style.cursor = 'zoom-in';
        modalImage.classList.remove('zoomed-in');
        modalImage.classList.add('zoomed-out');
    }
    
    if (zoomLevel) {
        zoomLevel.textContent = '100%';
    }
}

function toggleFullscreen() {
    if (!document.fullscreenElement) {
        document.getElementById('imageModal').requestFullscreen().catch(err => {
            console.log(`Error attempting to enable fullscreen: ${err.message}`);
        });
        isFullscreen = true;
    } else {
        document.exitFullscreen();
        isFullscreen = false;
    }
}

function downloadImage() {
    const modalImage = document.getElementById('modalImage');
    if (!modalImage || !modalImage.src) return;
    
    const link = document.createElement('a');
    link.href = modalImage.src;
    link.download = `playground-image-${currentImageIndex + 1}.jpg`;
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
}

function shareImage() {
    const modalImage = document.getElementById('modalImage');
    const modalCaption = document.getElementById('modalCaption');
    
    if (!modalImage || !modalImage.src) return;
    
    const shareData = {
        title: 'Playground Image',
        text: modalCaption ? modalCaption.textContent : 'Check out this playground image!',
        url: modalImage.src
    };
    
    if (navigator.share) {
        navigator.share(shareData).catch(console.error);
    } else {
        // Fallback: copy to clipboard
        navigator.clipboard.writeText(modalImage.src).then(() => {
            showNotification('Image URL copied to clipboard!');
        }).catch(() => {
            // Final fallback: open in new tab
            window.open(modalImage.src, '_blank');
        });
    }
}

function toggleSlideshow() {
    const slideshowBtn = document.getElementById('slideshowBtn');
    
    if (slideshowInterval) {
        clearInterval(slideshowInterval);
        slideshowInterval = null;
        if (slideshowBtn) {
            slideshowBtn.innerHTML = `
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.828 14.828a4 4 0 01-5.656 0M9 10h1m4 0h1m-6 4h8m2-10h.01M5 20h.01M17 20h.01M10 4h4l-2-2z"></path>
                </svg>
            `;
            slideshowBtn.title = 'Start Slideshow';
        }
    } else {
        if (playgroundImages.length > 1) {
            slideshowInterval = setInterval(() => {
                nextImage();
            }, 3000);
            
            if (slideshowBtn) {
                slideshowBtn.innerHTML = `
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                `;
                slideshowBtn.title = 'Stop Slideshow';
            }
        }
    }
}

// Enhanced drag functionality for zoomed images
document.addEventListener('DOMContentLoaded', function() {
    const modalImage = document.getElementById('modalImage');
    
    if (modalImage) {
        modalImage.addEventListener('mousedown', startDrag);
        document.addEventListener('mousemove', drag);
        document.addEventListener('mouseup', endDrag);
        
        // Touch events for mobile
        modalImage.addEventListener('touchstart', startDrag);
        document.addEventListener('touchmove', drag);
        document.addEventListener('touchend', endDrag);
    }
});

function startDrag(e) {
    if (currentZoom <= 1) return;
    
    isDragging = true;
    startX = e.type === 'mousedown' ? e.clientX : e.touches[0].clientX;
    startY = e.type === 'mousedown' ? e.clientY : e.touches[0].clientY;
    
    document.body.style.cursor = 'grabbing';
}

function drag(e) {
    if (!isDragging || currentZoom <= 1) return;
    
    e.preventDefault();
    const clientX = e.type === 'mousemove' ? e.clientX : e.touches[0].clientX;
    const clientY = e.type === 'mousemove' ? e.clientY : e.touches[0].clientY;
    
    translateX += (clientX - startX) / currentZoom;
    translateY += (clientY - startY) / currentZoom;
    
    const modalImage = document.getElementById('modalImage');
    if (modalImage) {
        modalImage.style.transform = `scale(${currentZoom}) translate(${translateX}px, ${translateY}px)`;
    }
    
    startX = clientX;
    startY = clientY;
}

function endDrag() {
    isDragging = false;
    document.body.style.cursor = 'default';
}

// === ENHANCED KEYBOARD NAVIGATION ===
document.addEventListener('keydown', function(e) {
    const modal = document.getElementById('imageModal');
    if (!modal.classList.contains('hidden')) {
        e.preventDefault(); // Prevent default browser behavior
        
        switch(e.key) {
            case 'Escape':
                closeImageModal();
                break;
            case 'ArrowLeft':
            case 'a':
            case 'A':
                previousImage();
                break;
            case 'ArrowRight':
            case 'd':
            case 'D':
                nextImage();
                break;
            case '+':
            case '=':
                zoomIn();
                break;
            case '-':
            case '_':
                zoomOut();
                break;
            case '0':
                resetZoom();
                break;
            case 'f':
            case 'F':
                toggleFullscreen();
                break;
            case ' ':
                toggleSlideshow();
                break;
            case 's':
            case 'S':
                downloadImage();
                break;
            case 'r':
            case 'R':
                shareImage();
                break;
            case '1':
            case '2':
            case '3':
            case '4':
            case '5':
            case '6':
            case '7':
            case '8':
            case '9':
                const imageIndex = parseInt(e.key) - 1;
                if (imageIndex < playgroundImages.length) {
                    jumpToImage(imageIndex);
                }
                break;
        }
        
        // Show keyboard hints briefly
        showKeyboardHints();
    }
});

function showKeyboardHints() {
    let hintsElement = document.getElementById('keyboardHints');
    
    if (!hintsElement) {
        hintsElement = document.createElement('div');
        hintsElement.id = 'keyboardHints';
        hintsElement.className = 'keyboard-hint';
        hintsElement.innerHTML = `
            <div class="font-bold mb-2">Keyboard Shortcuts:</div>
            <div>  : Navigate images</div>
            <div>+ - : Zoom in/out</div>
            <div>0 : Reset zoom</div>
            <div>F : Fullscreen</div>
            <div>Space : Slideshow</div>
            <div>S : Download</div>
            <div>R : Share</div>
            <div>ESC : Close</div>
        `;
        document.body.appendChild(hintsElement);
    }
    
    hintsElement.classList.add('show');
    
    setTimeout(() => {
        hintsElement.classList.remove('show');
    }, 3000);
}

// Prevent modal from closing when clicking on image
document.addEventListener('DOMContentLoaded', function() {
    const modalImage = document.getElementById('modalImage');
    if (modalImage) {
        modalImage.addEventListener('click', function(e) {
            e.stopPropagation();
        });
    }
});

// === RESPONSIVE DESIGN HELPERS ===
function adjustForMobile() {
    if (window.innerWidth <= 768) {
        const cards = document.querySelectorAll('.info-card');
        cards.forEach(card => {
            card.style.padding = '1rem';
        });
    }
}

// === MAP INTERACTION FUNCTIONS ===
function shareLocation() {
    const lat = parseFloat("{{ playground.latitude|default:0 }}");
    const lng = parseFloat("{{ playground.longitude|default:0 }}");
    const playgroundName = "{{ playground.name|escapejs }}";
    
    if (lat && lng) {
        const locationUrl = `https://www.google.com/maps?q=${lat},${lng}`;
        const shareText = `Check out ${playgroundName} at this location: ${locationUrl}`;
        
        if (navigator.share) {
            navigator.share({
                title: `Location of ${playgroundName}`,
                text: shareText,
                url: locationUrl
            }).catch(console.error);
        } else {
            // Fallback: copy to clipboard
            navigator.clipboard.writeText(locationUrl).then(() => {
                showNotification('Location link copied to clipboard!', 'success');
            }).catch(() => {
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = locationUrl;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                showNotification('Location link copied to clipboard!', 'success');
            });
        }
    } else {
        showNotification('Location coordinates not available', 'error');
    }
}

function requestLocationUpdate() {
    showNotification('Location update request sent to the playground owner. They will be notified to provide precise coordinates.', 'info');
}

// === RESPONSIVE DESIGN HELPERS CONTINUED ===

// === DYNAMIC DATA LOADING ===

async function loadTotalBookings() {
    try {
        const playgroundId = {{ playground.id }};
        console.log('Loading total bookings for playground ID:', playgroundId);
        
        // Try to fetch from dashboard API which should have booking statistics
        const response = await fetch(`/api/dashboard/playground-stats/${playgroundId}/`, {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]')?.value || '',
            }
        });
        
        if (response.ok) {
            const data = await response.json();
            console.log('Booking stats response:', data);
            
            const totalBookingsElement = document.getElementById('total-bookings-count');
            if (totalBookingsElement && data.total_bookings !== undefined) {
                const totalBookings = data.total_bookings || 0;
                totalBookingsElement.textContent = `${totalBookings} booking${totalBookings !== 1 ? 's' : ''}`;
                totalBookingsElement.className = 'text-blue-600 font-semibold';
            }
        } else {
            throw new Error(`HTTP ${response.status}`);
        }
    } catch (error) {
        console.log('Error loading booking stats, using fallback:', error);
        
        // Fallback: Try direct calculation from available information
        const totalBookingsElement = document.getElementById('total-bookings-count');
        if (totalBookingsElement) {
            // For now, show loading state and let it be updated via separate API call
            totalBookingsElement.textContent = 'Loading...';
            totalBookingsElement.className = 'text-gray-500 text-sm';
            
            // Alternative: Try a simpler endpoint
            fetch(`/api/bookings/count/${playgroundId}/`)
                .then(response => response.json())
                .then(data => {
                    if (data.count !== undefined) {
                        totalBookingsElement.textContent = `${data.count} booking${data.count !== 1 ? 's' : ''}`;
                        totalBookingsElement.className = 'text-blue-600 font-semibold';
                    }
                })
                .catch(() => {
                    // Final fallback: Show a reasonable message
                    totalBookingsElement.textContent = 'Available for booking';
                    totalBookingsElement.className = 'text-green-600 font-medium';
                });
        }
    }
}

// Adjust on resize
window.addEventListener('resize', adjustForMobile);

// Load dynamic data when page loads
document.addEventListener('DOMContentLoaded', function() {
    // Immediately set playground type with generic fallback
    const typeDisplay = document.getElementById('playground-type-display');
    if (typeDisplay) {
        const currentTypeId = '{{ playground.playground_type|default:"" }}';
        if (currentTypeId && currentTypeId !== '') {
            typeDisplay.textContent = 'Loading playground type...';
        } else {
            typeDisplay.textContent = 'Sports Facility';
        }
        console.log('Set initial loading state for playground type ID:', currentTypeId);
    }
    
    // Then try to load from API for more accurate data
    loadPlaygroundTypeFromAPI();
    loadTotalBookings();
});

// === ADDITIONAL FUNCTIONALITY ===
function openChat() {
    console.log('Opening chat functionality...');
    // Implement chat functionality here
    alert('Chat functionality coming soon! Please use email contact for now.');
}

function reportPlayground() {
    console.log('Opening report functionality...');
    const playgroundId = window.location.pathname.split('/').slice(-2, -1)[0];
    const reportReason = prompt('Please describe the issue you want to report:');
    if (reportReason && reportReason.trim()) {
        // Here you would send the report to the backend
        alert('Thank you for your report. We will review it and take appropriate action.');
        console.log('Report submitted for playground', playgroundId, ':', reportReason);
    }
}

// === ENHANCED GALLERY FUNCTIONS ===
function downloadAllImages() {
    if (playgroundImages.length === 0) {
        alert('No images available to download.');
        return;
    }
    
    console.log('Starting download of all images...');
    playgroundImages.forEach((image, index) => {
        setTimeout(() => {
            downloadImageByUrl(image.url, `playground-image-${index + 1}`);
        }, index * 500); // Stagger downloads by 500ms
    });
    
    alert(`Starting download of ${playgroundImages.length} images. Check your downloads folder.`);
}

function downloadImageByUrl(imageUrl, filename) {
    try {
        const link = document.createElement('a');
        link.href = imageUrl;
        link.download = filename || 'playground-image';
        link.target = '_blank';
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    } catch (error) {
        console.error('Error downloading image:', error);
    }
}

function contactOwner() {
    const playgroundName = "{{ playground.name|escapejs }}";
    const playgroundId = window.location.pathname.split('/').slice(-2, -1)[0];
    
    // Try to scroll to contact information
    const contactSection = document.querySelector('h2:contains("Contact")') || 
                          document.querySelector('[class*="contact"]') ||
                          document.querySelector('a[href^="tel:"]') ||
                          document.querySelector('a[href^="mailto:"]');
    
    if (contactSection) {
        contactSection.scrollIntoView({ behavior: 'smooth', block: 'center' });
        // Highlight the contact section
        contactSection.style.backgroundColor = 'rgba(59, 130, 246, 0.1)';
        contactSection.style.borderRadius = '8px';
        contactSection.style.padding = '16px';
        setTimeout(() => {
            contactSection.style.backgroundColor = '';
            contactSection.style.borderRadius = '';
            contactSection.style.padding = '';
        }, 3000);
    } else {
        // If no contact info found, show generic message
        alert(`To contact the owner of ${playgroundName}, please use the contact information provided on this page or look for the "Chat with Owner" button.`);
    }
}

function requestPhotos() {
    const playgroundName = "{{ playground.name|escapejs }}";
    const message = `Hi! I'm interested in ${playgroundName} but noticed there are no photos available. Could you please share some images of the facility? This would help me make a booking decision. Thank you!`;
    
    // Try to find contact methods and auto-populate message
    const whatsappLink = document.querySelector('a[href*="wa.me"]');
    const emailLink = document.querySelector('a[href^="mailto:"]');
    
    if (whatsappLink) {
        const whatsappUrl = whatsappLink.href + '&text=' + encodeURIComponent(message);
        window.open(whatsappUrl, '_blank');
    } else if (emailLink) {
        const emailUrl = emailLink.href + '&subject=' + encodeURIComponent(`Photo Request for ${playgroundName}`) + '&body=' + encodeURIComponent(message);
        window.open(emailUrl, '_blank');
    } else {
        // Copy message to clipboard
        navigator.clipboard.writeText(message).then(() => {
            alert('Photo request message copied to clipboard! Please paste it when contacting the owner.');
        }).catch(() => {
            alert('Please contact the owner and request photos for this playground.');
        });
    }
}

function toggleImageView() {
    const gallery = document.querySelector('.enhanced-gallery-grid');
    if (!gallery) return;
    
    const isListView = gallery.classList.contains('list-view');
    
    if (isListView) {
        // Switch to grid view
        gallery.classList.remove('list-view');
        gallery.style.gridTemplateColumns = 'repeat(auto-fit, minmax(280px, 1fr))';
    } else {
        // Switch to list view
        gallery.classList.add('list-view');
        gallery.style.gridTemplateColumns = '1fr';
    }
}

function preloadImages() {
    // Preload images for faster modal viewing
    if (!playgroundImages || playgroundImages.length === 0) {
        console.log('No images to preload');
        return;
    }
    
    playgroundImages.forEach((image, index) => {
        if (!image || !image.url) {
            console.warn(`Image ${index} has no URL, skipping preload`);
            return;
        }
        
        const img = new Image();
        img.onload = function() {
            console.log(`Preloaded image ${index + 1}/${playgroundImages.length}: ${image.url}`);
        };
        img.onerror = function() {
            console.warn(`Failed to preload image ${index + 1}: ${image.url}`);
        };
        img.src = image.url;
    });
}

// Initialize enhanced gallery when DOM is loaded
document.addEventListener('DOMContentLoaded', function() {
    preloadImages();
    
    // Add loading states to gallery images
    const galleryImages = document.querySelectorAll('.gallery-image');
    galleryImages.forEach(img => {
        img.addEventListener('load', function() {
            this.classList.remove('image-loading');
        });
        
        img.addEventListener('error', function() {
            this.classList.remove('image-loading');
            this.style.opacity = '0.5';
            this.alt = 'Failed to load image';
        });
        
        // Add loading class initially
        img.classList.add('image-loading');
    });
});

// === CURRENCY UPDATE FOR MEMBERSHIP PASSES ===
function updateMembershipPassesCurrency() {
    // Update currency for all membership passes to match playground currency
    if (currentCurrency && currencySymbol) {
        // Update currency display elements in membership passes
        const currencyElements = document.querySelectorAll('.pass-price .currency, .per-day-currency');
        currencyElements.forEach(element => {
            const originalCurrency = element.getAttribute('data-currency') || element.textContent.trim();
            // Only update if different from current
            if (originalCurrency !== currencySymbol) {
                element.textContent = currencySymbol;
            }
        });
        
        console.log(`Updated membership passes currency to: ${currencySymbol}`);
    }
}

// Update amenities currency
function updateAmenitiesCurrency() {
    if (currentCurrency && currencySymbol) {
        // Update dynamic currency elements in amenities
        const amenityPrices = document.querySelectorAll('.dynamic-currency');
        amenityPrices.forEach(element => {
            const price = element.getAttribute('data-price');
            if (price) {
                element.textContent = `${currencySymbol} ${price}`;
            }
        });
        
        console.log(`Updated amenities currency to: ${currencySymbol}`);
    }
}

// Update membership passes currency when slots are loaded
function updateAllCurrency(data) {
    if (data.currency && data.currency_symbol) {
        currentCurrency = data.currency;
        currencySymbol = data.currency_symbol;
        updateMembershipPassesCurrency();
        updateAmenitiesCurrency();
    }
}

// === CLEANUP ===
window.addEventListener('beforeunload', function() {
    stopAutoSlider();
});

// === FINAL SAFETY CHECK ===
window.addEventListener('load', function() {
    // Final check to ensure modal is hidden
    const modal = document.getElementById('imageModal');
    if (modal && !modal.classList.contains('hidden')) {
        console.log('Final safety: hiding modal on window load');
        closeImageModal();
    }
});

// === GOOGLE MAPS INTEGRATION ===
function getDirections() {
    {% if playground.latitude and playground.longitude %}
    const lat = {{ playground.latitude }};
    const lng = {{ playground.longitude }};
    
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(function(position) {
            const userLat = position.coords.latitude;
            const userLng = position.coords.longitude;
            const directionsUrl = `https://www.google.com/maps/dir/${userLat},${userLng}/${lat},${lng}`;
            window.open(directionsUrl, '_blank');
        }, function(error) {
            // Fallback if geolocation fails
            const directionsUrl = `https://www.google.com/maps/dir/?api=1&destination=${lat},${lng}`;
            window.open(directionsUrl, '_blank');
        });
    } else {
        // Fallback if geolocation is not supported
        const directionsUrl = `https://www.google.com/maps/dir/?api=1&destination=${lat},${lng}`;
        window.open(directionsUrl, '_blank');
    }
    {% else %}
    alert('Location coordinates are not available for this playground.');
    {% endif %}
}

function shareLocation() {
    {% if playground.latitude and playground.longitude %}
    const lat = {{ playground.latitude }};
    const lng = {{ playground.longitude }};
    const playgroundName = "{{ playground.name|escapejs }}";
    const shareUrl = `https://www.google.com/maps/search/?api=1&query=${lat},${lng}`;
    const shareText = `Check out ${playgroundName} location: ${shareUrl}`;
    
    if (navigator.share) {
        navigator.share({
            title: `${playgroundName} Location`,
            text: shareText,
            url: shareUrl
        });
    } else {
        // Fallback: copy to clipboard
        navigator.clipboard.writeText(shareText).then(function() {
            alert('Location link copied to clipboard!');
        }, function() {
            // Further fallback: show the URL
            prompt('Copy this location link:', shareUrl);
        });
    }
    {% else %}
    alert('Location coordinates are not available for this playground.');
    {% endif %}
}

function requestLocationUpdate() {
    alert('Location update request feature coming soon! Please contact the playground owner directly.');
}

// Contact Owner Function
async function contactOwner() {
    const playgroundId = {{ playground.id }};
    const playgroundName = "{{ playground.name|escapejs }}";
    
    // Show loading
    const btn = event.target.closest('button');
    const originalHTML = btn.innerHTML;
    btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Starting conversation...';
    btn.disabled = true;
    
    try {
        // Start conversation
        const response = await fetch('/messages/api/conversations/start/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': getCookie('csrftoken'),
            },
            body: JSON.stringify({
                playground_id: playgroundId,
                subject: `Inquiry about ${playgroundName}`,
                message: `Hi, I'm interested in booking ${playgroundName}. Could you please provide more information?`
            })
        });
        
        const result = await response.json();
        
        if (result.success) {
            // Redirect to messages page
            window.location.href = '/messages/';
        } else {
            alert(result.error || 'Failed to start conversation. Please try again.');
            btn.innerHTML = originalHTML;
            btn.disabled = false;
        }
    } catch (error) {
        console.error('Error starting conversation:', error);
        alert('Failed to contact owner. Please try again.');
        btn.innerHTML = originalHTML;
        btn.disabled = false;
    }
}

// Helper function to get CSRF token
function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}
</script>
{% endblock %}
